import{s as Sa,k as An,n as Ei,r as bo,o as Ta,e as ka}from"../chunks/scheduler.CtbWrGNo.js";import{S as Oa,i as Da,e as at,s as Dt,t as zs,c as ht,h as bt,g as Xt,a as Et,j as Ws,f as pt,b as nt,q as Ea,d as tr,k as J,z as Aa,A as $e,B as Mn,C as Yt,l as Ma,D as Pn,E as Pa,F as ja}from"../chunks/index.DZXQfm36.js";function os(h){return(h==null?void 0:h.length)!==void 0?h:Array.from(h)}function O(h,t,e){return(t=function(r){var s=function(i,n){if(typeof i!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var a=o.call(i,n||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}(r,"string");return typeof s=="symbol"?s:s+""}(t))in h?Object.defineProperty(h,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):h[t]=e,h}function jn(h,t){var e=Object.keys(h);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(h);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(h,s).enumerable})),e.push.apply(e,r)}return e}function D(h){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?jn(Object(e),!0).forEach(function(r){O(h,r,e[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(e)):jn(Object(e)).forEach(function(r){Object.defineProperty(h,r,Object.getOwnPropertyDescriptor(e,r))})}return h}function At(h,t){if(h==null)return{};var e,r,s=function(n,o){if(n==null)return{};var a={};for(var l in n)if({}.hasOwnProperty.call(n,l)){if(o.indexOf(l)>=0)continue;a[l]=n[l]}return a}(h,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(h);for(r=0;r<i.length;r++)e=i[r],t.indexOf(e)>=0||{}.propertyIsEnumerable.call(h,e)&&(s[e]=h[e])}return s}function He(h,t){return t||(t=h.slice(0)),Object.freeze(Object.defineProperties(h,{raw:{value:Object.freeze(t)}}))}class Fn{constructor(){O(this,"browserShadowBlurConstant",1),O(this,"DPI",96),O(this,"devicePixelRatio",typeof window<"u"?window.devicePixelRatio:1),O(this,"perfLimitSizeTotal",2097152),O(this,"maxCacheSideLimit",4096),O(this,"minCacheSideLimit",256),O(this,"disableStyleCopyPaste",!1),O(this,"enableGLFiltering",!0),O(this,"textureSize",4096),O(this,"forceGLPutImageData",!1),O(this,"cachesBoundsOfCurve",!1),O(this,"fontPaths",{}),O(this,"NUM_FRACTION_DIGITS",4)}}const xt=new class extends Fn{constructor(h){super(),this.configure(h)}configure(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.assign(this,h)}addFonts(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fontPaths=D(D({},this.fontPaths),h)}removeFonts(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(h=>{delete this.fontPaths[h]})}clearFonts(){this.fontPaths={}}restoreDefaults(h){const t=new Fn,e=(h==null?void 0:h.reduce((r,s)=>(r[s]=t[s],r),{}))||t;this.configure(e)}},Ye=function(h){for(var t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];return console[h]("fabric",...e)};class Se extends Error{constructor(t,e){super("fabric: ".concat(t),e)}}class Fa extends Se{constructor(t){super("".concat(t," 'options.signal' is in 'aborted' state"))}}class La{}class Ia extends La{testPrecision(t,e){const r="precision ".concat(e,` float;
void main(){}`),s=t.createShader(t.FRAGMENT_SHADER);return!!s&&(t.shaderSource(s,r),t.compileShader(s),!!t.getShaderParameter(s,t.COMPILE_STATUS))}queryWebGL(t){const e=t.getContext("webgl");e&&(this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find(r=>this.testPrecision(e,r)),e.getExtension("WEBGL_lose_context").loseContext(),Ye("log","WebGL: max texture size ".concat(this.maxTextureSize)))}isSupported(t){return!!this.maxTextureSize&&this.maxTextureSize>=t}}const Ra={};let Ln;const Te=()=>Ln||(Ln={document,window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new Ia,dispose(){},copyPasteData:Ra}),Mr=()=>Te().document,Xi=()=>Te().window,xo=()=>{var h;return Math.max((h=xt.devicePixelRatio)!==null&&h!==void 0?h:Xi().devicePixelRatio,1)},Nr=new class{constructor(){O(this,"charWidthsCache",{}),O(this,"boundsOfCurveCache",{})}getFontCache(h){let{fontFamily:t,fontStyle:e,fontWeight:r}=h;t=t.toLowerCase(),this.charWidthsCache[t]||(this.charWidthsCache[t]={});const s=this.charWidthsCache[t],i="".concat(e.toLowerCase(),"_").concat((r+"").toLowerCase());return s[i]||(s[i]={}),s[i]}clearFontCache(h){(h=(h||"").toLowerCase())?this.charWidthsCache[h]&&delete this.charWidthsCache[h]:this.charWidthsCache={}}limitDimsByArea(h){const{perfLimitSizeTotal:t}=xt,e=Math.sqrt(t*h);return[Math.floor(e),Math.floor(t/e)]}},Ai="6.4.3";function Fs(){}const Kr=Math.PI/2,Ns=2*Math.PI,Yi=Math.PI/180,Kt=Object.freeze([1,0,0,1,0,0]),Vi=16,Ue=.4477152502,yt="center",kt="left",$t="top",Mi="bottom",Ft="right",te="none",Hi=/\r?\n/,wo="moving",ti="scaling",Co="rotating",Gi="rotate",So="skewing",Vr="resizing",Ba="modifyPoly",za="modifyPath",Us="changed",ei="scale",re="scaleX",ue="scaleY",Pr="skewX",jr="skewY",Rt="fill",ee="stroke",Xs="modified",xr="json",mi="svg",rt=new class{constructor(){this[xr]=new Map,this[mi]=new Map}has(h){return this[xr].has(h)}getClass(h){const t=this[xr].get(h);if(!t)throw new Se("No class registered for ".concat(h));return t}setClass(h,t){t?this[xr].set(t,h):(this[xr].set(h.type,h),this[xr].set(h.type.toLowerCase(),h))}getSVGClass(h){return this[mi].get(h)}setSVGClass(h,t){this[mi].set(t??h.type.toLowerCase(),h)}},Ys=new class extends Array{remove(h){const t=this.indexOf(h);t>-1&&this.splice(t,1)}cancelAll(){const h=this.splice(0);return h.forEach(t=>t.abort()),h}cancelByCanvas(h){if(!h)return[];const t=this.filter(e=>{var r;return e.target===h||typeof e.target=="object"&&((r=e.target)===null||r===void 0?void 0:r.canvas)===h});return t.forEach(e=>e.abort()),t}cancelByTarget(h){if(!h)return[];const t=this.filter(e=>e.target===h);return t.forEach(e=>e.abort()),t}};class Wa{constructor(){O(this,"__eventListeners",{})}on(t,e){if(this.__eventListeners||(this.__eventListeners={}),typeof t=="object")return Object.entries(t).forEach(r=>{let[s,i]=r;this.on(s,i)}),()=>this.off(t);if(e){const r=t;return this.__eventListeners[r]||(this.__eventListeners[r]=[]),this.__eventListeners[r].push(e),()=>this.off(r,e)}return()=>!1}once(t,e){if(typeof t=="object"){const r=[];return Object.entries(t).forEach(s=>{let[i,n]=s;r.push(this.once(i,n))}),()=>r.forEach(s=>s())}if(e){const r=this.on(t,function(){for(var s=arguments.length,i=new Array(s),n=0;n<s;n++)i[n]=arguments[n];e.call(this,...i),r()});return r}return()=>!1}_removeEventListener(t,e){if(this.__eventListeners[t])if(e){const r=this.__eventListeners[t],s=r.indexOf(e);s>-1&&r.splice(s,1)}else this.__eventListeners[t]=[]}off(t,e){if(this.__eventListeners)if(t===void 0)for(const r in this.__eventListeners)this._removeEventListener(r);else typeof t=="object"?Object.entries(t).forEach(r=>{let[s,i]=r;this._removeEventListener(s,i)}):this._removeEventListener(t,e)}fire(t,e){var r;if(!this.__eventListeners)return;const s=(r=this.__eventListeners[t])===null||r===void 0?void 0:r.concat();if(s)for(let i=0;i<s.length;i++)s[i].call(this,e||{})}}const Cr=(h,t)=>{const e=h.indexOf(t);return e!==-1&&h.splice(e,1),h},je=h=>{if(h===0)return 1;switch(Math.abs(h)/Kr){case 1:case 3:return 0;case 2:return-1}return Math.cos(h)},Fe=h=>{if(h===0)return 0;const t=h/Kr,e=Math.sign(h);switch(t){case 1:return e;case 2:return 0;case 3:return-e}return Math.sin(h)};class z{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;typeof t=="object"?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}add(t){return new z(this.x+t.x,this.y+t.y)}addEquals(t){return this.x+=t.x,this.y+=t.y,this}scalarAdd(t){return new z(this.x+t,this.y+t)}scalarAddEquals(t){return this.x+=t,this.y+=t,this}subtract(t){return new z(this.x-t.x,this.y-t.y)}subtractEquals(t){return this.x-=t.x,this.y-=t.y,this}scalarSubtract(t){return new z(this.x-t,this.y-t)}scalarSubtractEquals(t){return this.x-=t,this.y-=t,this}multiply(t){return new z(this.x*t.x,this.y*t.y)}scalarMultiply(t){return new z(this.x*t,this.y*t)}scalarMultiplyEquals(t){return this.x*=t,this.y*=t,this}divide(t){return new z(this.x/t.x,this.y/t.y)}scalarDivide(t){return new z(this.x/t,this.y/t)}scalarDivideEquals(t){return this.x/=t,this.y/=t,this}eq(t){return this.x===t.x&&this.y===t.y}lt(t){return this.x<t.x&&this.y<t.y}lte(t){return this.x<=t.x&&this.y<=t.y}gt(t){return this.x>t.x&&this.y>t.y}gte(t){return this.x>=t.x&&this.y>=t.y}lerp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5;return e=Math.max(Math.min(1,e),0),new z(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)}distanceFrom(t){const e=this.x-t.x,r=this.y-t.y;return Math.sqrt(e*e+r*r)}midPointFrom(t){return this.lerp(t)}min(t){return new z(Math.min(this.x,t.x),Math.min(this.y,t.y))}max(t){return new z(Math.max(this.x,t.x),Math.max(this.y,t.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(t,e){return this.x=t,this.y=e,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setFromPoint(t){return this.x=t.x,this.y=t.y,this}swap(t){const e=this.x,r=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=r}clone(){return new z(this.x,this.y)}rotate(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qi;const r=Fe(t),s=je(t),i=this.subtract(e);return new z(i.x*s-i.y*r,i.x*r+i.y*s).add(e)}transform(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new z(t[0]*this.x+t[2]*this.y+(e?0:t[4]),t[1]*this.x+t[3]*this.y+(e?0:t[5]))}}const qi=new z(0,0),Ls=h=>!!h&&Array.isArray(h._objects);function To(h){class t extends h{constructor(){super(...arguments),O(this,"_objects",[])}_onObjectAdded(r){}_onObjectRemoved(r){}_onStackOrderChanged(r){}add(){for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];const n=this._objects.push(...s);return s.forEach(o=>this._onObjectAdded(o)),n}insertAt(r){for(var s=arguments.length,i=new Array(s>1?s-1:0),n=1;n<s;n++)i[n-1]=arguments[n];return this._objects.splice(r,0,...i),i.forEach(o=>this._onObjectAdded(o)),this._objects.length}remove(){const r=this._objects,s=[];for(var i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return n.forEach(a=>{const l=r.indexOf(a);l!==-1&&(r.splice(l,1),s.push(a),this._onObjectRemoved(a))}),s}forEachObject(r){this.getObjects().forEach((s,i,n)=>r(s,i,n))}getObjects(){for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return s.length===0?[...this._objects]:this._objects.filter(n=>n.isType(...s))}item(r){return this._objects[r]}isEmpty(){return this._objects.length===0}size(){return this._objects.length}contains(r,s){return!!this._objects.includes(r)||!!s&&this._objects.some(i=>i instanceof t&&i.contains(r,!0))}complexity(){return this._objects.reduce((r,s)=>r+=s.complexity?s.complexity():0,0)}sendObjectToBack(r){return!(!r||r===this._objects[0])&&(Cr(this._objects,r),this._objects.unshift(r),this._onStackOrderChanged(r),!0)}bringObjectToFront(r){return!(!r||r===this._objects[this._objects.length-1])&&(Cr(this._objects,r),this._objects.push(r),this._onStackOrderChanged(r),!0)}sendObjectBackwards(r,s){if(!r)return!1;const i=this._objects.indexOf(r);if(i!==0){const n=this.findNewLowerIndex(r,i,s);return Cr(this._objects,r),this._objects.splice(n,0,r),this._onStackOrderChanged(r),!0}return!1}bringObjectForward(r,s){if(!r)return!1;const i=this._objects.indexOf(r);if(i!==this._objects.length-1){const n=this.findNewUpperIndex(r,i,s);return Cr(this._objects,r),this._objects.splice(n,0,r),this._onStackOrderChanged(r),!0}return!1}moveObjectTo(r,s){return r!==this._objects[s]&&(Cr(this._objects,r),this._objects.splice(s,0,r),this._onStackOrderChanged(r),!0)}findNewLowerIndex(r,s,i){let n;if(i){n=s;for(let o=s-1;o>=0;--o)if(r.isOverlapping(this._objects[o])){n=o;break}}else n=s-1;return n}findNewUpperIndex(r,s,i){let n;if(i){n=s;for(let o=s+1;o<this._objects.length;++o)if(r.isOverlapping(this._objects[o])){n=o;break}}else n=s+1;return n}collectObjects(r){let{left:s,top:i,width:n,height:o}=r,{includeIntersecting:a=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const l=[],c=new z(s,i),u=c.add(new z(n,o));for(let f=this._objects.length-1;f>=0;f--){const d=this._objects[f];d.selectable&&d.visible&&(a&&d.intersectsWithRect(c,u)||d.isContainedWithinRect(c,u)||a&&d.containsPoint(c)||a&&d.containsPoint(u))&&l.push(d)}return l}}return t}class ko extends Wa{_setOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};for(const e in t)this.set(e,t[e])}_setObject(t){for(const e in t)this._set(e,t[e])}set(t,e){return typeof t=="object"?this._setObject(t):this._set(t,e),this}_set(t,e){this[t]=e}toggle(t){const e=this.get(t);return typeof e=="boolean"&&this.set(t,!e),this}get(t){return this[t]}}function Is(h){return Xi().requestAnimationFrame(h)}function Na(h){return Xi().cancelAnimationFrame(h)}let Ua=0;const Ve=()=>Ua++,zt=()=>{const h=Mr().createElement("canvas");if(!h||h.getContext===void 0)throw new Se("Failed to create `canvas` element");return h},Xa=()=>Mr().createElement("img"),Oo=(h,t,e)=>h.toDataURL("image/".concat(t),e),Lt=h=>h*Yi,hr=h=>h/Yi,Ya=h=>h.every((t,e)=>t===Kt[e]),Qt=(h,t,e)=>new z(h).transform(t,e),ye=h=>{const t=1/(h[0]*h[3]-h[1]*h[2]),e=[t*h[3],-t*h[1],-t*h[2],t*h[0],0,0],{x:r,y:s}=new z(h[4],h[5]).transform(e,!0);return e[4]=-r,e[5]=-s,e},Vt=(h,t,e)=>[h[0]*t[0]+h[2]*t[1],h[1]*t[0]+h[3]*t[1],h[0]*t[2]+h[2]*t[3],h[1]*t[2]+h[3]*t[3],e?0:h[0]*t[4]+h[2]*t[5]+h[4],e?0:h[1]*t[4]+h[3]*t[5]+h[5]],Zi=(h,t)=>h.reduceRight((e,r)=>r&&e?Vt(r,e,t):r||e,void 0)||Kt.concat(),Do=h=>{let[t,e]=h;return Math.atan2(e,t)},Vs=h=>{const t=Do(h),e=Math.pow(h[0],2)+Math.pow(h[1],2),r=Math.sqrt(e),s=(h[0]*h[3]-h[2]*h[1])/r,i=Math.atan2(h[0]*h[2]+h[1]*h[3],e);return{angle:hr(t),scaleX:r,scaleY:s,skewX:hr(i),skewY:0,translateX:h[4]||0,translateY:h[5]||0}},Jr=function(h){return[1,0,0,1,h,arguments.length>1&&arguments[1]!==void 0?arguments[1]:0]};function Qr(){let{angle:h=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{x:t=0,y:e=0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=Lt(h),s=je(r),i=Fe(r);return[s,i,-i,s,t?t-(s*t-i*e):0,e?e-(i*t+s*e):0]}const Ki=function(h){return[h,0,0,arguments.length>1&&arguments[1]!==void 0?arguments[1]:h,0,0]},Eo=h=>Math.tan(Lt(h)),Ao=h=>[1,0,Eo(h),1,0,0],Mo=h=>[1,Eo(h),0,1,0,0],ri=h=>{let{scaleX:t=1,scaleY:e=1,flipX:r=!1,flipY:s=!1,skewX:i=0,skewY:n=0}=h,o=Ki(r?-t:t,s?-e:e);return i&&(o=Vt(o,Ao(i),!0)),n&&(o=Vt(o,Mo(n),!0)),o},Va=h=>{const{translateX:t=0,translateY:e=0,angle:r=0}=h;let s=Jr(t,e);r&&(s=Vt(s,Qr({angle:r})));const i=ri(h);return Ya(i)||(s=Vt(s,i)),s},Rs=function(h){let{signal:t,crossOrigin:e=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(function(r,s){if(t&&t.aborted)return s(new Fa("loadImage"));const i=Xa();let n;t&&(n=function(a){i.src="",s(a)},t.addEventListener("abort",n,{once:!0}));const o=function(){i.onload=i.onerror=null,n&&(t==null||t.removeEventListener("abort",n)),r(i)};h?(i.onload=o,i.onerror=function(){n&&(t==null||t.removeEventListener("abort",n)),s(new Se("Error loading ".concat(i.src)))},e&&(i.crossOrigin=e),i.src=h):o()})},Hr=function(h){let{signal:t,reviver:e=Fs}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((r,s)=>{const i=[];t&&t.addEventListener("abort",s,{once:!0}),Promise.all(h.map(n=>rt.getClass(n.type).fromObject(n,{signal:t}).then(o=>(e(n,o),i.push(o),o)))).then(r).catch(n=>{i.forEach(o=>{o.dispose&&o.dispose()}),s(n)}).finally(()=>{t&&t.removeEventListener("abort",s)})})},si=function(h){let{signal:t}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((e,r)=>{const s=[];t&&t.addEventListener("abort",r,{once:!0});const i=Object.values(h).map(o=>o&&o.type&&rt.has(o.type)?Hr([o],{signal:t}).then(a=>{let[l]=a;return s.push(l),l}):o),n=Object.keys(h);Promise.all(i).then(o=>o.reduce((a,l,c)=>(a[n[c]]=l,a),{})).then(e).catch(o=>{s.forEach(a=>{a.dispose&&a.dispose()}),r(o)}).finally(()=>{t&&t.removeEventListener("abort",r)})})},Fr=function(h){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:[]).reduce((t,e)=>(e in h&&(t[e]=h[e]),t),{})},Ji=(h,t)=>Object.keys(h).reduce((e,r)=>(t(h[r],r,h)&&(e[r]=h[r]),e),{}),In={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},_i=(h,t,e)=>(e<0&&(e+=1),e>1&&(e-=1),e<1/6?h+6*(t-h)*e:e<.5?t:e<2/3?h+(t-h)*(2/3-e)*6:h),Rn=(h,t,e,r)=>{h/=255,t/=255,e/=255;const s=Math.max(h,t,e),i=Math.min(h,t,e);let n,o;const a=(s+i)/2;if(s===i)n=o=0;else{const l=s-i;switch(o=a>.5?l/(2-s-i):l/(s+i),s){case h:n=(t-e)/l+(t<e?6:0);break;case t:n=(e-h)/l+2;break;case e:n=(h-t)/l+4}n/=6}return[Math.round(360*n),Math.round(100*o),Math.round(100*a),r]},Bn=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"1";return parseFloat(h)/(h.endsWith("%")?100:1)},as=h=>Math.min(Math.round(h),255).toString(16).toUpperCase().padStart(2,"0"),zn=h=>{let[t,e,r,s=1]=h;const i=Math.round(.3*t+.59*e+.11*r);return[i,i,i,s]};class Ot{constructor(t){if(O(this,"isUnrecognised",!1),t)if(t instanceof Ot)this.setSource([...t._source]);else if(Array.isArray(t)){const[e,r,s,i=1]=t;this.setSource([e,r,s,i])}else this.setSource(this._tryParsingColor(t));else this.setSource([0,0,0,1])}_tryParsingColor(t){return t in In&&(t=In[t]),t==="transparent"?[255,255,255,0]:Ot.sourceFromHex(t)||Ot.sourceFromRgb(t)||Ot.sourceFromHsl(t)||(this.isUnrecognised=!0)&&[0,0,0,1]}getSource(){return this._source}setSource(t){this._source=t}toRgb(){const[t,e,r]=this.getSource();return"rgb(".concat(t,",").concat(e,",").concat(r,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){const[t,e,r]=Rn(...this.getSource());return"hsl(".concat(t,",").concat(e,"%,").concat(r,"%)")}toHsla(){const[t,e,r,s]=Rn(...this.getSource());return"hsla(".concat(t,",").concat(e,"%,").concat(r,"%,").concat(s,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){const[t,e,r,s]=this.getSource();return"".concat(as(t)).concat(as(e)).concat(as(r)).concat(as(Math.round(255*s)))}getAlpha(){return this.getSource()[3]}setAlpha(t){return this._source[3]=t,this}toGrayscale(){return this.setSource(zn(this.getSource())),this}toBlackWhite(t){const[e,,,r]=zn(this.getSource()),s=e<(t||127)?0:255;return this.setSource([s,s,s,r]),this}overlayWith(t){t instanceof Ot||(t=new Ot(t));const e=this.getSource(),r=t.getSource(),[s,i,n]=e.map((o,a)=>Math.round(.5*o+.5*r[a]));return this.setSource([s,i,n,e[3]]),this}static fromRgb(t){return Ot.fromRgba(t)}static fromRgba(t){return new Ot(Ot.sourceFromRgb(t))}static sourceFromRgb(t){const e=t.match(/^rgba?\(\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d{0,3}(?:\.\d+)?%?)\s*)?\)$/i);if(e){const[r,s,i]=e.slice(1,4).map(n=>{const o=parseFloat(n);return n.endsWith("%")?Math.round(2.55*o):o});return[r,s,i,Bn(e[4])]}}static fromHsl(t){return Ot.fromHsla(t)}static fromHsla(t){return new Ot(Ot.sourceFromHsl(t))}static sourceFromHsl(t){const e=t.match(/^hsla?\(\s*([+-]?\d{0,3}(?:\.\d+)?(?:deg|turn|rad)?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d*(?:\.\d+)?%?)\s*)?\)$/i);if(!e)return;const r=(Ot.parseAngletoDegrees(e[1])%360+360)%360/360,s=parseFloat(e[2])/100,i=parseFloat(e[3])/100;let n,o,a;if(s===0)n=o=a=i;else{const l=i<=.5?i*(s+1):i+s-i*s,c=2*i-l;n=_i(c,l,r+1/3),o=_i(c,l,r),a=_i(c,l,r-1/3)}return[Math.round(255*n),Math.round(255*o),Math.round(255*a),Bn(e[4])]}static fromHex(t){return new Ot(Ot.sourceFromHex(t))}static sourceFromHex(t){if(t.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){const e=t.slice(t.indexOf("#")+1);let r;r=e.length<=4?e.split("").map(a=>a+a):e.match(/.{2}/g);const[s,i,n,o=255]=r.map(a=>parseInt(a,16));return[s,i,n,o/255]}}static parseAngletoDegrees(t){const e=t.toLowerCase(),r=parseFloat(e);return e.includes("rad")?hr(r):e.includes("turn")?360*r:r}}const Pt=(h,t)=>parseFloat(Number(h).toFixed(t)),Or=function(h){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Vi;const e=/\D{0,2}$/.exec(h),r=parseFloat(h),s=xt.DPI;switch(e==null?void 0:e[0]){case"mm":return r*s/25.4;case"cm":return r*s/2.54;case"in":return r*s;case"pt":return r*s/72;case"pc":return r*s/72*12;case"em":return r*t;default:return r}},Ha=h=>{const[t,e]=h.trim().split(" "),[r,s]=(i=t)&&i!==te?[i.slice(1,4),i.slice(5,8)]:i===te?[i,i]:["Mid","Mid"];var i;return{meetOrSlice:e||"meet",alignX:r,alignY:s}},Hs=h=>"matrix("+h.map(t=>Pt(t,xt.NUM_FRACTION_DIGITS)).join(" ")+")",Gr=function(h,t){let e,r,s=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];if(t)if(t.toLive)e="url(#SVGID_".concat(t.id,")");else{const i=new Ot(t),n=i.getAlpha();e=i.toRgb(),n!==1&&(r=n.toString())}else e="none";return s?"".concat(h,": ").concat(e,"; ").concat(r?"".concat(h,"-opacity: ").concat(r,"; "):""):"".concat(h,'="').concat(e,'" ').concat(r?"".concat(h,'-opacity="').concat(r,'" '):"")},ce=h=>!!h&&h.toLive!==void 0,Wn=h=>!!h&&typeof h.toObject=="function",Nn=h=>!!h&&h.offsetX!==void 0&&"source"in h,Po=h=>!!h&&typeof h._renderText=="function",er=h=>!!h&&"multiSelectionStacking"in h;function jo(h){const t=h&&ve(h);let e=0,r=0;if(!h||!t)return{left:e,top:r};let s=h;const i=t.documentElement,n=t.body||{scrollLeft:0,scrollTop:0};for(;s&&(s.parentNode||s.host)&&(s=s.parentNode||s.host,s===t?(e=n.scrollLeft||i.scrollLeft||0,r=n.scrollTop||i.scrollTop||0):(e+=s.scrollLeft||0,r+=s.scrollTop||0),s.nodeType!==1||s.style.position!=="fixed"););return{left:e,top:r}}const ve=h=>h.ownerDocument||null,Fo=h=>{var t;return((t=h.ownerDocument)===null||t===void 0?void 0:t.defaultView)||null},Lo=function(h,t,e){let{width:r,height:s}=e,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;h.width=r,h.height=s,i>1&&(h.setAttribute("width",(r*i).toString()),h.setAttribute("height",(s*i).toString()),t.scale(i,i))},Pi=(h,t)=>{let{width:e,height:r}=t;e&&(h.style.width=typeof e=="number"?"".concat(e,"px"):e),r&&(h.style.height=typeof r=="number"?"".concat(r,"px"):r)};function Un(h){return h.onselectstart!==void 0&&(h.onselectstart=()=>!1),h.style.userSelect=te,h}class Io{constructor(t){O(this,"_originalCanvasStyle",void 0),O(this,"lower",void 0);const e=this.createLowerCanvas(t);this.lower={el:e,ctx:e.getContext("2d")}}createLowerCanvas(t){const e=(r=t)&&r.getContext!==void 0?t:t&&Mr().getElementById(t)||zt();var r;if(e.hasAttribute("data-fabric"))throw new Se("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=e.style.cssText,e.setAttribute("data-fabric","main"),e.classList.add("lower-canvas"),e}cleanupDOM(t){let{width:e,height:r}=t;const{el:s}=this.lower;s.classList.remove("lower-canvas"),s.removeAttribute("data-fabric"),s.setAttribute("width","".concat(e)),s.setAttribute("height","".concat(r)),s.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(t,e){const{el:r,ctx:s}=this.lower;Lo(r,s,t,e)}setCSSDimensions(t){Pi(this.lower.el,t)}calcOffset(){return function(t){var e;const r=t&&ve(t),s={left:0,top:0};if(!r)return s;const i=((e=Fo(t))===null||e===void 0?void 0:e.getComputedStyle(t,null))||{};s.left+=parseInt(i.borderLeftWidth,10)||0,s.top+=parseInt(i.borderTopWidth,10)||0,s.left+=parseInt(i.paddingLeft,10)||0,s.top+=parseInt(i.paddingTop,10)||0;let n={left:0,top:0};const o=r.documentElement;t.getBoundingClientRect!==void 0&&(n=t.getBoundingClientRect());const a=jo(t);return{left:n.left+a.left-(o.clientLeft||0)+s.left,top:n.top+a.top-(o.clientTop||0)+s.top}}(this.lower.el)}dispose(){Te().dispose(this.lower.el),delete this.lower}}const Ga={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...Kt]};class $r extends To(ko){get lowerCanvasEl(){var t;return(t=this.elements.lower)===null||t===void 0?void 0:t.el}get contextContainer(){var t;return(t=this.elements.lower)===null||t===void 0?void 0:t.ctx}static getDefaults(){return $r.ownDefaults}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(e),this.initElements(t),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(t){this.elements=new Io(t)}add(){const t=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}insertAt(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),s=1;s<e;s++)r[s-1]=arguments[s];const i=super.insertAt(t,...r);return r.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),i}remove(){const t=super.remove(...arguments);return t.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}_onObjectAdded(t){t.canvas&&t.canvas!==this&&(Ye("warn",`Canvas is trying to add an object that belongs to a different canvas.
Resulting to default behavior: removing object from previous canvas and adding to new canvas`),t.canvas.remove(t)),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t){t._set("canvas",void 0),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?xo():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(t,e){return this.setDimensions({width:t},e)}setHeight(t,e){return this.setDimensions({height:t},e)}_setDimensionsImpl(t){let{cssOnly:e=!1,backstoreOnly:r=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!e){const s=D({width:this.width,height:this.height},t);this.elements.setDimensions(s,this.getRetinaScaling()),this.hasLostContext=!0,this.width=s.width,this.height=s.height}r||this.elements.setCSSDimensions(t),this.calcOffset()}setDimensions(t,e){this._setDimensionsImpl(t,e),e&&e.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(t){this.viewportTransform=t,this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(t,e){const r=t,s=[...this.viewportTransform],i=Qt(t,ye(s));s[0]=e,s[3]=e;const n=Qt(i,s);s[4]+=r.x-n.x,s[5]+=r.y-n.y,this.setViewportTransform(s)}setZoom(t){this.zoomToPoint(new z(0,0),t)}absolutePan(t){const e=[...this.viewportTransform];return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)}relativePan(t){return this.absolutePan(new z(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(t){t.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=Is(()=>this.renderAndReset()))}calcViewportBoundaries(){const t=this.width,e=this.height,r=ye(this.viewportTransform),s=Qt({x:0,y:0},r),i=Qt({x:t,y:e},r),n=s.min(i),o=s.max(i);return this.vptCoords={tl:n,tr:new z(o.x,n.y),bl:new z(n.x,o.y),br:o}}cancelRequestedRender(){this.nextRenderHandle&&(Na(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(t){}renderCanvas(t,e){if(this.destroyed)return;const r=this.viewportTransform,s=this.clipPath;this.calcViewportBoundaries(),this.clearContext(t),t.imageSmoothingEnabled=this.imageSmoothingEnabled,t.patternQuality="best",this.fire("before:render",{ctx:t}),this._renderBackground(t),t.save(),t.transform(r[0],r[1],r[2],r[3],r[4],r[5]),this._renderObjects(t,e),t.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(t),s&&(s._set("canvas",this),s.shouldCache(),s._transformDone=!0,s.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(t,s)),this._renderOverlay(t),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(t),this.fire("after:render",{ctx:t}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(t,e){const r=this.viewportTransform;t.save(),t.transform(...r),t.globalCompositeOperation="destination-in",e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore()}_renderObjects(t,e){for(let r=0,s=e.length;r<s;++r)e[r]&&e[r].render(t)}_renderBackgroundOrOverlay(t,e){const r=this["".concat(e,"Color")],s=this["".concat(e,"Image")],i=this.viewportTransform,n=this["".concat(e,"Vpt")];if(!r&&!s)return;const o=ce(r);if(r){if(t.save(),t.beginPath(),t.moveTo(0,0),t.lineTo(this.width,0),t.lineTo(this.width,this.height),t.lineTo(0,this.height),t.closePath(),t.fillStyle=o?r.toLive(t):r,n&&t.transform(...i),o){t.transform(1,0,0,1,r.offsetX||0,r.offsetY||0);const a=r.gradientTransform||r.patternTransform;a&&t.transform(...a)}t.fill(),t.restore()}if(s){t.save();const{skipOffscreen:a}=this;this.skipOffscreen=n,n&&t.transform(...i),s.render(t),this.skipOffscreen=a,t.restore()}}_renderBackground(t){this._renderBackgroundOrOverlay(t,"background")}_renderOverlay(t){this._renderBackgroundOrOverlay(t,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new z(this.width/2,this.height/2)}centerObjectH(t){return this._centerObject(t,new z(this.getCenterPoint().x,t.getCenterPoint().y))}centerObjectV(t){return this._centerObject(t,new z(t.getCenterPoint().x,this.getCenterPoint().y))}centerObject(t){return this._centerObject(t,this.getCenterPoint())}viewportCenterObject(t){return this._centerObject(t,this.getVpCenter())}viewportCenterObjectH(t){return this._centerObject(t,new z(this.getVpCenter().x,t.getCenterPoint().y))}viewportCenterObjectV(t){return this._centerObject(t,new z(t.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return Qt(this.getCenterPoint(),ye(this.viewportTransform))}_centerObject(t,e){t.setXY(e,yt,yt),t.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(t){return this.toDatalessObject(t)}toObject(t){return this._toObjectMethod("toObject",t)}toJSON(){return this.toObject()}toDatalessObject(t){return this._toObjectMethod("toDatalessObject",t)}_toObjectMethod(t,e){const r=this.clipPath,s=r&&!r.excludeFromExport?this._toObject(r,t,e):null;return D(D(D({version:Ai},Fr(this,e)),{},{objects:this._objects.filter(i=>!i.excludeFromExport).map(i=>this._toObject(i,t,e))},this.__serializeBgOverlay(t,e)),s?{clipPath:s}:null)}_toObject(t,e,r){let s;this.includeDefaultValues||(s=t.includeDefaultValues,t.includeDefaultValues=!1);const i=t[e](r);return this.includeDefaultValues||(t.includeDefaultValues=!!s),i}__serializeBgOverlay(t,e){const r={},s=this.backgroundImage,i=this.overlayImage,n=this.backgroundColor,o=this.overlayColor;return ce(n)?n.excludeFromExport||(r.background=n.toObject(e)):n&&(r.background=n),ce(o)?o.excludeFromExport||(r.overlay=o.toObject(e)):o&&(r.overlay=o),s&&!s.excludeFromExport&&(r.backgroundImage=this._toObject(s,t,e)),i&&!i.excludeFromExport&&(r.overlayImage=this._toObject(i,t,e)),r}toSVG(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;t.reviver=e;const r=[];return this._setSVGPreamble(r,t),this._setSVGHeader(r,t),this.clipPath&&r.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,`)" >
`)),this._setSVGBgOverlayColor(r,"background"),this._setSVGBgOverlayImage(r,"backgroundImage",e),this._setSVGObjects(r,e),this.clipPath&&r.push(`</g>
`),this._setSVGBgOverlayColor(r,"overlay"),this._setSVGBgOverlayImage(r,"overlayImage",e),r.push("</svg>"),r.join("")}_setSVGPreamble(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)}_setSVGHeader(t,e){const r=e.width||"".concat(this.width),s=e.height||"".concat(this.height),i=xt.NUM_FRACTION_DIGITS,n=e.viewBox;let o;if(n)o='viewBox="'.concat(n.x," ").concat(n.y," ").concat(n.width," ").concat(n.height,'" ');else if(this.svgViewportTransformation){const a=this.viewportTransform;o='viewBox="'.concat(Pt(-a[4]/a[0],i)," ").concat(Pt(-a[5]/a[3],i)," ").concat(Pt(this.width/a[0],i)," ").concat(Pt(this.height/a[3],i),'" ')}else o='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',r,'" ','height="',s,'" ',o,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",Ai,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(e),`</defs>
`)}createSVGClipPathMarkup(t){const e=this.clipPath;return e?(e.clipPathId="CLIPPATH_".concat(Ve()),'<clipPath id="'.concat(e.clipPathId,`" >
`).concat(e.toClipPathSVG(t.reviver),`</clipPath>
`)):""}createSVGRefElementsMarkup(){return["background","overlay"].map(t=>{const e=this["".concat(t,"Color")];if(ce(e)){const r=this["".concat(t,"Vpt")],s=this.viewportTransform,i={isType:()=>!1,width:this.width/(r?s[0]:1),height:this.height/(r?s[3]:1)};return e.toSVG(i,{additionalTransform:r?Hs(s):""})}}).join("")}createSVGFontFacesMarkup(){const t=[],e={},r=xt.fontPaths;this._objects.forEach(function i(n){t.push(n),Ls(n)&&n._objects.forEach(i)}),t.forEach(i=>{if(!Po(i))return;const{styles:n,fontFamily:o}=i;!e[o]&&r[o]&&(e[o]=!0,n&&Object.values(n).forEach(a=>{Object.values(a).forEach(l=>{let{fontFamily:c=""}=l;!e[c]&&r[c]&&(e[c]=!0)})}))});const s=Object.keys(e).map(i=>`		@font-face {
			font-family: '`.concat(i,`';
			src: url('`).concat(r[i],`');
		}
`)).join("");return s?`	<style type="text/css"><![CDATA[
`.concat(s,`]]></style>
`):""}_setSVGObjects(t,e){this.forEachObject(r=>{r.excludeFromExport||this._setSVGObject(t,r,e)})}_setSVGObject(t,e,r){t.push(e.toSVG(r))}_setSVGBgOverlayImage(t,e,r){const s=this[e];s&&!s.excludeFromExport&&s.toSVG&&t.push(s.toSVG(r))}_setSVGBgOverlayColor(t,e){const r=this["".concat(e,"Color")];if(r)if(ce(r)){const s=r.repeat||"",i=this.width,n=this.height,o=this["".concat(e,"Vpt")]?Hs(ye(this.viewportTransform)):"";t.push('<rect transform="'.concat(o," translate(").concat(i/2,",").concat(n/2,')" x="').concat(r.offsetX-i/2,'" y="').concat(r.offsetY-n/2,'" width="').concat(s!=="repeat-y"&&s!=="no-repeat"||!Nn(r)?i:r.source.width,'" height="').concat(s!=="repeat-x"&&s!=="no-repeat"||!Nn(r)?n:r.source.height,'" fill="url(#SVGID_').concat(r.id,`)"></rect>
`))}else t.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',r,'"',`></rect>
`)}loadFromJSON(t,e){let{signal:r}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!t)return Promise.reject(new Se("`json` is undefined"));const s=typeof t=="string"?JSON.parse(t):t,{objects:i=[],backgroundImage:n,background:o,overlayImage:a,overlay:l,clipPath:c}=s,u=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([Hr(i,{reviver:e,signal:r}),si({backgroundImage:n,backgroundColor:o,overlayImage:a,overlayColor:l,clipPath:c},{signal:r})]).then(f=>{let[d,m]=f;return this.clear(),this.add(...d),this.set(s),this.set(m),this.renderOnAddRemove=u,this})}clone(t){const e=this.toObject(t);return this.cloneWithoutData().loadFromJSON(e)}cloneWithoutData(){const t=zt();return t.width=this.width,t.height=this.height,new this.constructor(t)}toDataURL(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:e="png",quality:r=1,multiplier:s=1,enableRetinaScaling:i=!1}=t,n=s*(i?this.getRetinaScaling():1);return Oo(this.toCanvasElement(n,t),e,r)}toCanvasElement(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,{width:e,height:r,left:s,top:i,filter:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o=(e||this.width)*t,a=(r||this.height)*t,l=this.getZoom(),c=this.width,u=this.height,f=this.skipControlsDrawing,d=l*t,m=this.viewportTransform,p=[d,0,0,d,(m[4]-(s||0))*t,(m[5]-(i||0))*t],v=this.enableRetinaScaling,_=zt(),b=n?this._objects.filter(C=>n(C)):this._objects;return _.width=o,_.height=a,this.enableRetinaScaling=!1,this.viewportTransform=p,this.width=o,this.height=a,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(_.getContext("2d"),b),this.viewportTransform=m,this.width=c,this.height=u,this.calcViewportBoundaries(),this.enableRetinaScaling=v,this.skipControlsDrawing=f,_}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),Ys.cancelByCanvas(this),this.disposed=!0,new Promise((t,e)=>{const r=()=>{this.destroy(),t(!0)};r.kill=e,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?t(!1):this.nextRenderHandle?this.__cleanupTask=r:r()})}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject(t=>t.dispose()),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}}O($r,"ownDefaults",Ga);const qa=["touchstart","touchmove","touchend"],Za=h=>{const t=jo(h.target),e=function(r){const s=r.changedTouches;return s&&s[0]?s[0]:r}(h);return new z(e.clientX+t.left,e.clientY+t.top)},ji=h=>qa.includes(h.type)||h.pointerType==="touch",Fi=h=>{h.preventDefault(),h.stopPropagation()},Me=h=>{let t=0,e=0,r=0,s=0;for(let i=0,n=h.length;i<n;i++){const{x:o,y:a}=h[i];(o>r||!i)&&(r=o),(o<t||!i)&&(t=o),(a>s||!i)&&(s=a),(a<e||!i)&&(e=a)}return{left:t,top:e,width:r-t,height:s-e}},Ka=["translateX","translateY","scaleX","scaleY"],Ja=(h,t)=>Gs(h,Vt(t,h.calcOwnMatrix())),Gs=(h,t)=>{const e=Vs(t),{translateX:r,translateY:s,scaleX:i,scaleY:n}=e,o=At(e,Ka),a=new z(r,s);h.flipX=!1,h.flipY=!1,Object.assign(h,o),h.set({scaleX:i,scaleY:n}),h.setPositionByOrigin(a,yt,yt)},Qa=h=>{h.scaleX=1,h.scaleY=1,h.skewX=0,h.skewY=0,h.flipX=!1,h.flipY=!1,h.rotate(0)},Ro=h=>({scaleX:h.scaleX,scaleY:h.scaleY,skewX:h.skewX,skewY:h.skewY,angle:h.angle,left:h.left,flipX:h.flipX,flipY:h.flipY,top:h.top}),Qi=(h,t,e)=>{const r=h/2,s=t/2,i=[new z(-r,-s),new z(r,-s),new z(-r,s),new z(r,s)].map(o=>o.transform(e)),n=Me(i);return new z(n.width,n.height)},ii=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Kt;return Vt(ye(arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kt),h)},Dr=function(h){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kt,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Kt;return h.transform(ii(t,e))},$a=function(h){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kt,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Kt;return h.transform(ii(t,e),!0)},th=(h,t,e)=>{const r=ii(t,e);return Gs(h,Vt(r,h.calcOwnMatrix())),r},Bo=(h,t)=>{var e;const{transform:{target:r}}=t;(e=r.canvas)===null||e===void 0||e.fire("object:".concat(h),D(D({},t),{},{target:r})),r.fire(h,t)},eh={left:-.5,top:-.5,center:0,bottom:.5,right:.5},It=h=>typeof h=="string"?eh[h]:h-.5,qs="not-allowed";function zo(h){return It(h.originX)===It(yt)&&It(h.originY)===It(yt)}function Xn(h){return .5-It(h)}const be=(h,t)=>h[t],Wo=(h,t,e,r)=>({e:h,transform:t,pointer:new z(e,r)});function No(h,t){const e=h.getTotalAngle()+hr(Math.atan2(t.y,t.x))+360;return Math.round(e%360/45)}function $i(h,t,e,r,s){var i;let{target:n,corner:o}=h;const a=n.controls[o],l=((i=n.canvas)===null||i===void 0?void 0:i.getZoom())||1,c=n.padding/l,u=function(f,d,m,p){const v=f.getRelativeCenterPoint(),_=m!==void 0&&p!==void 0?f.translateToGivenOrigin(v,yt,yt,m,p):new z(f.left,f.top);return(f.angle?d.rotate(-Lt(f.angle),v):d).subtract(_)}(n,new z(r,s),t,e);return u.x>=c&&(u.x-=c),u.x<=-c&&(u.x+=c),u.y>=c&&(u.y-=c),u.y<=c&&(u.y+=c),u.x-=a.offsetX,u.y-=a.offsetY,u}const rh=(h,t,e,r)=>{const{target:s,offsetX:i,offsetY:n}=t,o=e-i,a=r-n,l=!be(s,"lockMovementX")&&s.left!==o,c=!be(s,"lockMovementY")&&s.top!==a;return l&&s.set(kt,o),c&&s.set($t,a),(l||c)&&Bo(wo,Wo(h,t,e,r)),l||c};class Uo{getSvgStyles(t){const e=this.fillRule?this.fillRule:"nonzero",r=this.strokeWidth?this.strokeWidth:"0",s=this.strokeDashArray?this.strokeDashArray.join(" "):te,i=this.strokeDashOffset?this.strokeDashOffset:"0",n=this.strokeLineCap?this.strokeLineCap:"butt",o=this.strokeLineJoin?this.strokeLineJoin:"miter",a=this.strokeMiterLimit?this.strokeMiterLimit:"4",l=this.opacity!==void 0?this.opacity:"1",c=this.visible?"":" visibility: hidden;",u=t?"":this.getSvgFilter(),f=Gr(Rt,this.fill);return[Gr(ee,this.stroke),"stroke-width: ",r,"; ","stroke-dasharray: ",s,"; ","stroke-linecap: ",n,"; ","stroke-dashoffset: ",i,"; ","stroke-linejoin: ",o,"; ","stroke-miterlimit: ",a,"; ",f,"fill-rule: ",e,"; ","opacity: ",l,";",u,c].join("")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=t?this.calcTransformMatrix():this.calcOwnMatrix(),s='transform="'.concat(Hs(r));return"".concat(s).concat(e,'" ')}_toSVG(t){return[""]}toSVG(t){return this._createBaseSVGMarkup(this._toSVG(t),{reviver:t})}toClipPathSVG(t){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(t),{reviver:t})}_createBaseClipPathSVGMarkup(t){let{reviver:e,additionalTransform:r=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=[this.getSvgTransform(!0,r),this.getSvgCommons()].join(""),i=t.indexOf("COMMON_PARTS");return t[i]=s,e?e(t.join("")):t.join("")}_createBaseSVGMarkup(t){let{noStyle:e,reviver:r,withShadow:s,additionalTransform:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e?"":'style="'.concat(this.getSvgStyles(),'" '),o=s?'style="'.concat(this.getSvgFilter(),'" '):"",a=this.clipPath,l=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",c=a&&a.absolutePositioned,u=this.stroke,f=this.fill,d=this.shadow,m=[],p=t.indexOf("COMMON_PARTS");let v;a&&(a.clipPathId="CLIPPATH_".concat(Ve()),v='<clipPath id="'.concat(a.clipPathId,`" >
`).concat(a.toClipPathSVG(r),`</clipPath>
`)),c&&m.push("<g ",o,this.getSvgCommons(),` >
`),m.push("<g ",this.getSvgTransform(!1),c?"":o+this.getSvgCommons(),` >
`);const _=[n,l,e?"":this.addPaintOrder()," ",i?'transform="'.concat(i,'" '):""].join("");return t[p]=_,ce(f)&&m.push(f.toSVG(this)),ce(u)&&m.push(u.toSVG(this)),d&&m.push(d.toSVG(this)),a&&m.push(v),m.push(t.join("")),m.push(`</g>
`),c&&m.push(`</g>
`),r?r(m.join("")):m.join("")}addPaintOrder(){return this.paintFirst!==Rt?' paint-order="'.concat(this.paintFirst,'" '):""}}function ni(h){return new RegExp("^("+h.join("|")+")\\b","i")}var Yn;const lr=String.raw(Yn||(Yn=He(["(?:[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?)"],["(?:[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?)"]))),sh=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+lr+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+lr+"))?\\s+(.*)"),ih={cx:kt,x:kt,r:"radius",cy:$t,y:$t,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},vi="font-size",yi="clip-path";ni(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]);ni(["symbol","image","marker","pattern","view","svg"]);const Vn=ni(["symbol","g","a","svg","clipPath","defs"]),nh=new z(1,0),Xo=new z,Yo=(h,t)=>h.rotate(t),Li=(h,t)=>new z(t).subtract(h),Ii=h=>h.distanceFrom(Xo),Ri=(h,t)=>Math.atan2(Ur(h,t),ah(h,t)),oh=h=>Ri(nh,h),tn=h=>h.eq(Xo)?h:h.scalarDivide(Ii(h)),Vo=function(h){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return tn(new z(-h.y,h.x).scalarMultiply(t?1:-1))},Ur=(h,t)=>h.x*t.y-h.y*t.x,ah=(h,t)=>h.x*t.x+h.y*t.y,Hn=(h,t,e)=>{if(h.eq(t)||h.eq(e))return!0;const r=Ur(t,e),s=Ur(t,h),i=Ur(e,h);return r>=0?s>=0&&i<=0:!(s<=0&&i>=0)},Gn="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",qn=new RegExp("(?:\\s|^)"+Gn+Gn+"("+lr+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class Pe{constructor(t){const e=typeof t=="string"?Pe.parseShadow(t):t;Object.assign(this,Pe.ownDefaults,e),this.id=Ve()}static parseShadow(t){const e=t.trim(),[,r=0,s=0,i=0]=(qn.exec(e)||[]).map(n=>parseFloat(n)||0);return{color:(e.replace(qn,"")||"rgb(0,0,0)").trim(),offsetX:r,offsetY:s,blur:i}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(t){const e=Yo(new z(this.offsetX,this.offsetY),Lt(-t.angle)),r=new Ot(this.color);let s=40,i=40;return t.width&&t.height&&(s=100*Pt((Math.abs(e.x)+this.blur)/t.width,xt.NUM_FRACTION_DIGITS)+20,i=100*Pt((Math.abs(e.y)+this.blur)/t.height,xt.NUM_FRACTION_DIGITS)+20),t.flipX&&(e.x*=-1),t.flipY&&(e.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(i,'%" height="').concat(100+2*i,'%" x="-').concat(s,'%" width="').concat(100+2*s,`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`).concat(Pt(this.blur?this.blur/2:0,xt.NUM_FRACTION_DIGITS),`"></feGaussianBlur>
	<feOffset dx="`).concat(Pt(e.x,xt.NUM_FRACTION_DIGITS),'" dy="').concat(Pt(e.y,xt.NUM_FRACTION_DIGITS),`" result="oBlur" ></feOffset>
	<feFlood flood-color="`).concat(r.toRgb(),'" flood-opacity="').concat(r.getAlpha(),`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`)}toObject(){const t={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},e=Pe.ownDefaults;return this.includeDefaultValues?t:Ji(t,(r,s)=>r!==e[s])}static async fromObject(t){return new this(t)}}O(Pe,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),O(Pe,"type","shadow"),rt.setClass(Pe,"shadow");const Ar=(h,t,e)=>Math.max(h,Math.min(t,e)),hh=[$t,kt,re,ue,"flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible",Pr,jr],Le=[Rt,ee,"strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],lh={top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:kt,originY:$t,strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:Rt,fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0},ch=(h,t,e,r)=>-e*Math.cos(h/r*Kr)+e+t,uh=()=>!1;class en{constructor(t){let{startValue:e,byValue:r,duration:s=500,delay:i=0,easing:n=ch,onStart:o=Fs,onChange:a=Fs,onComplete:l=Fs,abort:c=uh,target:u}=t;O(this,"_state","pending"),O(this,"durationProgress",0),O(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=s,this.delay=i,this.easing=n,this._onStart=o,this._onChange=a,this._onComplete=l,this._abort=c,this.target=u,this.startValue=e,this.byValue=r,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return this._state==="aborted"||this._state==="completed"}start(){const t=e=>{this._state==="pending"&&(this.startTime=e||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout(()=>Is(t),this.delay):Is(t)}tick(t){const e=(t||+new Date)-this.startTime,r=Math.min(e,this.duration);this.durationProgress=r/this.duration;const{value:s,valueProgress:i}=this.calculate(r);this.value=Object.freeze(s),this.valueProgress=i,this._state!=="aborted"&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):e>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),Is(this.tick)))}register(){Ys.push(this)}unregister(){Ys.remove(this)}abort(){this._state="aborted",this.unregister()}}const dh=["startValue","endValue"];class fh extends en{constructor(t){let{startValue:e=0,endValue:r=100}=t;super(D(D({},At(t,dh)),{},{startValue:e,byValue:r-e}))}calculate(t){const e=this.easing(t,this.startValue,this.byValue,this.duration);return{value:e,valueProgress:Math.abs((e-this.startValue)/this.byValue)}}}const gh=["startValue","endValue"];class ph extends en{constructor(t){let{startValue:e=[0],endValue:r=[100]}=t;super(D(D({},At(t,gh)),{},{startValue:e,byValue:r.map((s,i)=>s-e[i])}))}calculate(t){const e=this.startValue.map((r,s)=>this.easing(t,r,this.byValue[s],this.duration,s));return{value:e,valueProgress:Math.abs((e[0]-this.startValue[0])/this.byValue[0])}}}const mh=["startValue","endValue","easing","onChange","onComplete","abort"],_h=(h,t,e,r)=>t+e*(1-Math.cos(h/r*Kr)),bi=h=>h&&((t,e,r)=>h(new Ot(t).toRgba(),e,r));class vh extends en{constructor(t){let{startValue:e,endValue:r,easing:s=_h,onChange:i,onComplete:n,abort:o}=t,a=At(t,mh);const l=new Ot(e).getSource(),c=new Ot(r).getSource();super(D(D({},a),{},{startValue:l,byValue:c.map((u,f)=>u-l[f]),easing:s,onChange:bi(i),onComplete:bi(n),abort:bi(o)}))}calculate(t){const[e,r,s,i]=this.startValue.map((o,a)=>this.easing(t,o,this.byValue[a],this.duration,a)),n=[...[e,r,s].map(Math.round),Ar(0,i,1)];return{value:n,valueProgress:n.map((o,a)=>this.byValue[a]!==0?Math.abs((o-this.startValue[a])/this.byValue[a]):0).find(o=>o!==0)||0}}}function Ho(h){const t=(e=>Array.isArray(e.startValue)||Array.isArray(e.endValue))(h)?new ph(h):new fh(h);return t.start(),t}function yh(h){const t=new vh(h);return t.start(),t}class Mt{constructor(t){this.status=t,this.points=[]}includes(t){return this.points.some(e=>e.eq(t))}append(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.points=this.points.concat(e.filter(s=>!this.includes(s))),this}static isPointContained(t,e,r){let s=arguments.length>3&&arguments[3]!==void 0&&arguments[3];if(e.eq(r))return t.eq(e);if(e.x===r.x)return t.x===e.x&&(s||t.y>=Math.min(e.y,r.y)&&t.y<=Math.max(e.y,r.y));if(e.y===r.y)return t.y===e.y&&(s||t.x>=Math.min(e.x,r.x)&&t.x<=Math.max(e.x,r.x));{const i=Li(e,r),n=Li(e,t).divide(i);return s?Math.abs(n.x)===Math.abs(n.y):n.x===n.y&&n.x>=0&&n.x<=1}}static isPointInPolygon(t,e){const r=new z(t).setX(Math.min(t.x-1,...e.map(i=>i.x)));let s=0;for(let i=0;i<e.length;i++){const n=this.intersectSegmentSegment(e[i],e[(i+1)%e.length],t,r);if(n.includes(t))return!0;s+=+(n.status==="Intersection")}return s%2==1}static intersectLineLine(t,e,r,s){let i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4],n=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5];const o=e.x-t.x,a=e.y-t.y,l=s.x-r.x,c=s.y-r.y,u=t.x-r.x,f=t.y-r.y,d=l*f-c*u,m=o*f-a*u,p=c*o-l*a;if(p!==0){const v=d/p,_=m/p;return(i||0<=v&&v<=1)&&(n||0<=_&&_<=1)?new Mt("Intersection").append(new z(t.x+v*o,t.y+v*a)):new Mt}if(d===0||m===0){const v=i||n||Mt.isPointContained(t,r,s)||Mt.isPointContained(e,r,s)||Mt.isPointContained(r,t,e)||Mt.isPointContained(s,t,e);return new Mt(v?"Coincident":void 0)}return new Mt("Parallel")}static intersectSegmentLine(t,e,r,s){return Mt.intersectLineLine(t,e,r,s,!1,!0)}static intersectSegmentSegment(t,e,r,s){return Mt.intersectLineLine(t,e,r,s,!1,!1)}static intersectLinePolygon(t,e,r){let s=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];const i=new Mt,n=r.length;for(let o,a,l,c=0;c<n;c++){if(o=r[c],a=r[(c+1)%n],l=Mt.intersectLineLine(t,e,o,a,s,!1),l.status==="Coincident")return l;i.append(...l.points)}return i.points.length>0&&(i.status="Intersection"),i}static intersectSegmentPolygon(t,e,r){return Mt.intersectLinePolygon(t,e,r,!1)}static intersectPolygonPolygon(t,e){const r=new Mt,s=t.length,i=[];for(let n=0;n<s;n++){const o=t[n],a=t[(n+1)%s],l=Mt.intersectSegmentPolygon(o,a,e);l.status==="Coincident"?(i.push(l),r.append(o,a)):r.append(...l.points)}return i.length>0&&i.length===t.length?new Mt("Coincident"):(r.points.length>0&&(r.status="Intersection"),r)}static intersectPolygonRectangle(t,e,r){const s=e.min(r),i=e.max(r),n=new z(i.x,s.y),o=new z(s.x,i.y);return Mt.intersectPolygonPolygon(t,[s,n,i,o])}}class bh extends ko{getX(){return this.getXY().x}setX(t){this.setXY(this.getXY().setX(t))}getY(){return this.getXY().y}setY(t){this.setXY(this.getXY().setY(t))}getRelativeX(){return this.left}setRelativeX(t){this.left=t}getRelativeY(){return this.top}setRelativeY(t){this.top=t}getXY(){const t=this.getRelativeXY();return this.group?Qt(t,this.group.calcTransformMatrix()):t}setXY(t,e,r){this.group&&(t=Qt(t,ye(this.group.calcTransformMatrix()))),this.setRelativeXY(t,e,r)}getRelativeXY(){return new z(this.left,this.top)}setRelativeXY(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.originX,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.originY;this.setPositionByOrigin(t,e,r)}isStrokeAccountedForInDimensions(){return!1}getCoords(){const{tl:t,tr:e,br:r,bl:s}=this.aCoords||(this.aCoords=this.calcACoords()),i=[t,e,r,s];if(this.group){const n=this.group.calcTransformMatrix();return i.map(o=>Qt(o,n))}return i}intersectsWithRect(t,e){return Mt.intersectPolygonRectangle(this.getCoords(),t,e).status==="Intersection"}intersectsWithObject(t){const e=Mt.intersectPolygonPolygon(this.getCoords(),t.getCoords());return e.status==="Intersection"||e.status==="Coincident"||t.isContainedWithinObject(this)||this.isContainedWithinObject(t)}isContainedWithinObject(t){return this.getCoords().every(e=>t.containsPoint(e))}isContainedWithinRect(t,e){const{left:r,top:s,width:i,height:n}=this.getBoundingRect();return r>=t.x&&r+i<=e.x&&s>=t.y&&s+n<=e.y}isOverlapping(t){return this.intersectsWithObject(t)||this.isContainedWithinObject(t)||t.isContainedWithinObject(this)}containsPoint(t){return Mt.isPointInPolygon(t,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;const{tl:t,br:e}=this.canvas.vptCoords;return!!this.getCoords().some(r=>r.x<=e.x&&r.x>=t.x&&r.y<=e.y&&r.y>=t.y)||!!this.intersectsWithRect(t,e)||this.containsPoint(t.midPointFrom(e))}isPartiallyOnScreen(){if(!this.canvas)return!1;const{tl:t,br:e}=this.canvas.vptCoords;return this.intersectsWithRect(t,e)?!0:this.getCoords().every(r=>(r.x>=e.x||r.x<=t.x)&&(r.y>=e.y||r.y<=t.y))&&this.containsPoint(t.midPointFrom(e))}getBoundingRect(){return Me(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(t){this._set(re,t),this._set(ue,t),this.setCoords()}scaleToWidth(t){const e=this.getBoundingRect().width/this.getScaledWidth();return this.scale(t/this.width/e)}scaleToHeight(t){const e=this.getBoundingRect().height/this.getScaledHeight();return this.scale(t/this.height/e)}getCanvasRetinaScaling(){var t;return((t=this.canvas)===null||t===void 0?void 0:t.getRetinaScaling())||1}getTotalAngle(){return this.group?hr(Do(this.calcTransformMatrix())):this.angle}getViewportTransform(){var t;return((t=this.canvas)===null||t===void 0?void 0:t.viewportTransform)||Kt.concat()}calcACoords(){const t=Qr({angle:this.angle}),{x:e,y:r}=this.getRelativeCenterPoint(),s=Jr(e,r),i=Vt(s,t),n=this._getTransformedDimensions(),o=n.x/2,a=n.y/2;return{tl:Qt({x:-o,y:-a},i),tr:Qt({x:o,y:-a},i),bl:Qt({x:-o,y:a},i),br:Qt({x:o,y:a},i)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],e=[];return!t&&this.group&&(e=this.group.transformMatrixKey(t)),e.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,It(this.originX),It(this.originY)),e}calcTransformMatrix(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],e=this.calcOwnMatrix();if(t||!this.group)return e;const r=this.transformMatrixKey(t),s=this.matrixCache;return s&&s.key.every((i,n)=>i===r[n])?s.value:(this.group&&(e=Vt(this.group.calcTransformMatrix(!1),e)),this.matrixCache={key:r,value:e},e)}calcOwnMatrix(){const t=this.transformMatrixKey(!0),e=this.ownMatrixCache;if(e&&e.key===t)return e.value;const r=this.getRelativeCenterPoint(),s={angle:this.angle,translateX:r.x,translateY:r.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},i=Va(s);return this.ownMatrixCache={key:t,value:i},i}_getNonTransformedDimensions(){return new z(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(t){return this._getTransformedDimensions(t).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}_getTransformedDimensions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=D({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},t),r=e.strokeWidth;let s=r,i=0;this.strokeUniform&&(s=0,i=r);const n=e.width+s,o=e.height+s;let a;return a=e.skewX===0&&e.skewY===0?new z(n*e.scaleX,o*e.scaleY):Qi(n,o,ri(e)),a.scalarAdd(i)}translateToGivenOrigin(t,e,r,s,i){let n=t.x,o=t.y;const a=It(s)-It(e),l=It(i)-It(r);if(a||l){const c=this._getTransformedDimensions();n+=a*c.x,o+=l*c.y}return new z(n,o)}translateToCenterPoint(t,e,r){if(e===yt&&r===yt)return t;const s=this.translateToGivenOrigin(t,e,r,yt,yt);return this.angle?s.rotate(Lt(this.angle),t):s}translateToOriginPoint(t,e,r){const s=this.translateToGivenOrigin(t,yt,yt,e,r);return this.angle?s.rotate(Lt(this.angle),t):s}getCenterPoint(){const t=this.getRelativeCenterPoint();return this.group?Qt(t,this.group.calcTransformMatrix()):t}getRelativeCenterPoint(){return this.translateToCenterPoint(new z(this.left,this.top),this.originX,this.originY)}getPointByOrigin(t,e){return this.translateToOriginPoint(this.getRelativeCenterPoint(),t,e)}setPositionByOrigin(t,e,r){const s=this.translateToCenterPoint(t,e,r),i=this.translateToOriginPoint(s,this.originX,this.originY);this.set({left:i.x,top:i.y})}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),kt,$t)}}const xh=["type"],wh=["extraParam"];let Oe=class Bs extends bh{static getDefaults(){return Bs.ownDefaults}get type(){const t=this.constructor.type;return t==="FabricObject"?"object":t.toLowerCase()}set type(t){Ye("warn","Setting type has no effect",t)}constructor(t){super(),O(this,"_cacheContext",null),Object.assign(this,Bs.ownDefaults),this.setOptions(t)}_createCacheCanvas(){this._cacheCanvas=zt(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(t){const e=t.width,r=t.height,s=xt.maxCacheSideLimit,i=xt.minCacheSideLimit;if(e<=s&&r<=s&&e*r<=xt.perfLimitSizeTotal)return e<i&&(t.width=i),r<i&&(t.height=i),t;const n=e/r,[o,a]=Nr.limitDimsByArea(n),l=Ar(i,o,s),c=Ar(i,a,s);return e>l&&(t.zoomX/=e/l,t.width=l,t.capped=!0),r>c&&(t.zoomY/=r/c,t.height=c,t.capped=!0),t}_getCacheCanvasDimensions(){const t=this.getTotalObjectScaling(),e=this._getTransformedDimensions({skewX:0,skewY:0}),r=e.x*t.x/this.scaleX,s=e.y*t.y/this.scaleY;return{width:r+2,height:s+2,zoomX:t.x,zoomY:t.y,x:r,y:s}}_updateCacheCanvas(){const t=this._cacheCanvas,e=this._cacheContext,r=this._limitCacheSize(this._getCacheCanvasDimensions()),s=xt.minCacheSideLimit,i=r.width,n=r.height,o=r.zoomX,a=r.zoomY,l=i!==t.width||n!==t.height,c=this.zoomX!==o||this.zoomY!==a;if(!t||!e)return!1;let u,f,d=l||c,m=0,p=0,v=!1;if(l){const _=this._cacheCanvas.width,b=this._cacheCanvas.height,C=i>_||n>b;v=C||(i<.9*_||n<.9*b)&&_>s&&b>s,C&&!r.capped&&(i>s||n>s)&&(m=.1*i,p=.1*n)}return Po(this)&&this.path&&(d=!0,v=!0,m+=this.getHeightOfLine(0)*this.zoomX,p+=this.getHeightOfLine(0)*this.zoomY),!!d&&(v?(t.width=Math.ceil(i+m),t.height=Math.ceil(n+p)):(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height)),u=r.x/2,f=r.y/2,this.cacheTranslationX=Math.round(t.width/2-u)+u,this.cacheTranslationY=Math.round(t.height/2-f)+f,e.translate(this.cacheTranslationX,this.cacheTranslationY),e.scale(o,a),this.zoomX=o,this.zoomY=a,!0)}setOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setOptions(t)}transform(t){const e=this.group&&!this.group._transformDone||this.group&&this.canvas&&t===this.canvas.contextTop,r=this.calcTransformMatrix(!e);t.transform(r[0],r[1],r[2],r[3],r[4],r[5])}getObjectScaling(){if(!this.group)return new z(Math.abs(this.scaleX),Math.abs(this.scaleY));const t=Vs(this.calcTransformMatrix());return new z(Math.abs(t.scaleX),Math.abs(t.scaleY))}getTotalObjectScaling(){const t=this.getObjectScaling();if(this.canvas){const e=this.canvas.getZoom(),r=this.getCanvasRetinaScaling();return t.scalarMultiply(e*r)}return t}getObjectOpacity(){let t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t}_constrainScale(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:t===0?1e-4:t}_set(t,e){t!==re&&t!==ue||(e=this._constrainScale(e)),t===re&&e<0?(this.flipX=!this.flipX,e*=-1):t==="scaleY"&&e<0?(this.flipY=!this.flipY,e*=-1):t!=="shadow"||!e||e instanceof Pe||(e=new Pe(e));const r=this[t]!==e;return this[t]=e,r&&this.constructor.cacheProperties.includes(t)&&(this.dirty=!0),this.parent&&(this.dirty||r&&this.constructor.stateProperties.includes(t))&&this.parent._set("dirty",!0),this}isNotVisible(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible}render(t){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(t)):(this._removeCacheCanvas(),this.drawObject(t),this.dirty=!1),t.restore())}drawSelectionBackground(t){}renderCache(t){t=t||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext&&(this.drawObject(this._cacheContext,t.forClipping),this.dirty=!1)}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null}hasStroke(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0}hasFill(){return this.fill&&this.fill!=="transparent"}needsItsOwnCache(){return!!(this.paintFirst===ee&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.parent||!this.parent.isOnACache()),this.ownCaching}willDrawShadow(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)}drawClipPathOnCache(t,e){if(t.save(),e.inverted?t.globalCompositeOperation="destination-out":t.globalCompositeOperation="destination-in",e.absolutePositioned){const r=ye(this.calcTransformMatrix());t.transform(r[0],r[1],r[2],r[3],r[4],r[5])}e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore()}drawObject(t,e){const r=this.fill,s=this.stroke;e?(this.fill="black",this.stroke="",this._setClippingProperties(t)):this._renderBackground(t),this._render(t),this._drawClipPath(t,this.clipPath),this.fill=r,this.stroke=s}_drawClipPath(t,e){e&&(e._set("canvas",this.canvas),e.shouldCache(),e._transformDone=!0,e.renderCache({forClipping:!0}),this.drawClipPathOnCache(t,e))}drawCacheOnCanvas(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(this.isNotVisible())return!1;const e=this._cacheCanvas,r=this._cacheContext;return!(!e||!r||t||!this._updateCacheCanvas())||!!(this.dirty||this.clipPath&&this.clipPath.absolutePositioned)&&(e&&r&&!t&&(r.save(),r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,e.width,e.height),r.restore()),!0)}_renderBackground(t){if(!this.backgroundColor)return;const e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}_setOpacity(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity}_setStrokeStyles(t,e){const r=e.stroke;r&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineDashOffset=e.strokeDashOffset,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,ce(r)?r.gradientUnits==="percentage"||r.gradientTransform||r.patternTransform?this._applyPatternForTransformedGradient(t,r):(t.strokeStyle=r.toLive(t),this._applyPatternGradientTransform(t,r)):t.strokeStyle=e.stroke)}_setFillStyles(t,e){let{fill:r}=e;r&&(ce(r)?(t.fillStyle=r.toLive(t),this._applyPatternGradientTransform(t,r)):t.fillStyle=r)}_setClippingProperties(t){t.globalAlpha=1,t.strokeStyle="transparent",t.fillStyle="#000000"}_setLineDash(t,e){e&&e.length!==0&&(1&e.length&&e.push(...e),t.setLineDash(e))}_setShadow(t){if(!this.shadow)return;const e=this.shadow,r=this.canvas,s=this.getCanvasRetinaScaling(),[i,,,n]=(r==null?void 0:r.viewportTransform)||Kt,o=i*s,a=n*s,l=e.nonScaling?new z(1,1):this.getObjectScaling();t.shadowColor=e.color,t.shadowBlur=e.blur*xt.browserShadowBlurConstant*(o+a)*(l.x+l.y)/4,t.shadowOffsetX=e.offsetX*o*l.x,t.shadowOffsetY=e.offsetY*a*l.y}_removeShadow(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)}_applyPatternGradientTransform(t,e){if(!ce(e))return{offsetX:0,offsetY:0};const r=e.gradientTransform||e.patternTransform,s=-this.width/2+e.offsetX||0,i=-this.height/2+e.offsetY||0;return e.gradientUnits==="percentage"?t.transform(this.width,0,0,this.height,s,i):t.transform(1,0,0,1,s,i),r&&t.transform(r[0],r[1],r[2],r[3],r[4],r[5]),{offsetX:s,offsetY:i}}_renderPaintInOrder(t){this.paintFirst===ee?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t))}_render(t){}_renderFill(t){this.fill&&(t.save(),this._setFillStyles(t,this),this.fillRule==="evenodd"?t.fill("evenodd"):t.fill(),t.restore())}_renderStroke(t){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this.strokeUniform){const e=this.getObjectScaling();t.scale(1/e.x,1/e.y)}this._setLineDash(t,this.strokeDashArray),this._setStrokeStyles(t,this),t.stroke(),t.restore()}}_applyPatternForTransformedGradient(t,e){var r;const s=this._limitCacheSize(this._getCacheCanvasDimensions()),i=zt(),n=this.getCanvasRetinaScaling(),o=s.x/this.scaleX/n,a=s.y/this.scaleY/n;i.width=Math.ceil(o),i.height=Math.ceil(a);const l=i.getContext("2d");l&&(l.beginPath(),l.moveTo(0,0),l.lineTo(o,0),l.lineTo(o,a),l.lineTo(0,a),l.closePath(),l.translate(o/2,a/2),l.scale(s.zoomX/this.scaleX/n,s.zoomY/this.scaleY/n),this._applyPatternGradientTransform(l,e),l.fillStyle=e.toLive(t),l.fill(),t.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),t.scale(n*this.scaleX/s.zoomX,n*this.scaleY/s.zoomY),t.strokeStyle=(r=l.createPattern(i,"no-repeat"))!==null&&r!==void 0?r:"")}_findCenterFromElement(){return new z(this.left+this.width/2,this.top+this.height/2)}clone(t){const e=this.toObject(t);return this.constructor.fromObject(e)}cloneAsImage(t){const e=this.toCanvasElement(t);return new(rt.getClass("image"))(e)}toCanvasElement(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Ro(this),r=this.group,s=this.shadow,i=Math.abs,n=t.enableRetinaScaling?xo():1,o=(t.multiplier||1)*n,a=t.canvasProvider||(b=>new $r(b,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,t.withoutTransform&&Qa(this),t.withoutShadow&&(this.shadow=null),t.viewportTransform&&th(this,this.getViewportTransform()),this.setCoords();const l=zt(),c=this.getBoundingRect(),u=this.shadow,f=new z;if(u){const b=u.blur,C=u.nonScaling?new z(1,1):this.getObjectScaling();f.x=2*Math.round(i(u.offsetX)+b)*i(C.x),f.y=2*Math.round(i(u.offsetY)+b)*i(C.y)}const d=c.width+f.x,m=c.height+f.y;l.width=Math.ceil(d),l.height=Math.ceil(m);const p=a(l);t.format==="jpeg"&&(p.backgroundColor="#fff"),this.setPositionByOrigin(new z(p.width/2,p.height/2),yt,yt);const v=this.canvas;p._objects=[this],this.set("canvas",p),this.setCoords();const _=p.toCanvasElement(o||1,t);return this.set("canvas",v),this.shadow=s,r&&(this.group=r),this.set(e),this.setCoords(),p._objects=[],p.destroy(),_}toDataURL(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Oo(this.toCanvasElement(t),t.format||"png",t.quality||1)}isType(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.includes(this.constructor.type)||e.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(t){const{centeredRotation:e,originX:r,originY:s}=this;if(e){const{x:i,y:n}=this.getRelativeCenterPoint();this.originX=yt,this.originY=yt,this.left=i,this.top=n}if(this.set("angle",t),e){const{x:i,y:n}=this.translateToOriginPoint(this.getRelativeCenterPoint(),r,s);this.left=i,this.top=n,this.originX=r,this.originY=s}}setOnGroup(){}_setupCompositeOperation(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}dispose(){Ys.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&Te().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}animate(t,e){return Object.entries(t).reduce((r,s)=>{let[i,n]=s;return r[i]=this._animate(i,n,e),r},{})}_animate(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=t.split("."),i=this.constructor.colorProperties.includes(s[s.length-1]),{abort:n,startValue:o,onChange:a,onComplete:l}=r,c=D(D({},r),{},{target:this,startValue:o??s.reduce((u,f)=>u[f],this),endValue:e,abort:n==null?void 0:n.bind(this),onChange:(u,f,d)=>{s.reduce((m,p,v)=>(v===s.length-1&&(m[p]=u),m[p]),this),a&&a(u,f,d)},onComplete:(u,f,d)=>{this.setCoords(),l&&l(u,f,d)}});return i?yh(c):Ho(c)}isDescendantOf(t){const{parent:e,group:r}=this;return e===t||r===t||!!e&&e.isDescendantOf(t)||!!r&&r!==e&&r.isDescendantOf(t)}getAncestors(){const t=[];let e=this;do e=e.parent,e&&t.push(e);while(e);return t}findCommonAncestors(t){if(this===t)return{fork:[],otherFork:[],common:[this,...this.getAncestors()]};const e=this.getAncestors(),r=t.getAncestors();if(e.length===0&&r.length>0&&this===r[r.length-1])return{fork:[],otherFork:[t,...r.slice(0,r.length-1)],common:[this]};for(let s,i=0;i<e.length;i++){if(s=e[i],s===t)return{fork:[this,...e.slice(0,i)],otherFork:[],common:e.slice(i)};for(let n=0;n<r.length;n++){if(this===r[n])return{fork:[],otherFork:[t,...r.slice(0,n)],common:[this,...e]};if(s===r[n])return{fork:[this,...e.slice(0,i)],otherFork:[t,...r.slice(0,n)],common:e.slice(i)}}}return{fork:[this,...e],otherFork:[t,...r],common:[]}}hasCommonAncestors(t){const e=this.findCommonAncestors(t);return e&&!!e.common.length}isInFrontOf(t){if(this===t)return;const e=this.findCommonAncestors(t);if(e.fork.includes(t))return!0;if(e.otherFork.includes(this))return!1;const r=e.common[0]||this.canvas;if(!r)return;const s=e.fork.pop(),i=e.otherFork.pop(),n=r._objects.indexOf(s),o=r._objects.indexOf(i);return n>-1&&n>o}toObject(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).concat(Bs.customProperties,this.constructor.customProperties||[]);let e;const r=xt.NUM_FRACTION_DIGITS,{clipPath:s,fill:i,stroke:n,shadow:o,strokeDashArray:a,left:l,top:c,originX:u,originY:f,width:d,height:m,strokeWidth:p,strokeLineCap:v,strokeDashOffset:_,strokeLineJoin:b,strokeUniform:C,strokeMiterLimit:k,scaleX:T,scaleY:P,angle:A,flipX:I,flipY:j,opacity:U,visible:$,backgroundColor:S,fillRule:F,paintFirst:y,globalCompositeOperation:W,skewX:tt,skewY:X}=this;s&&!s.excludeFromExport&&(e=s.toObject(t.concat("inverted","absolutePositioned")));const st=it=>Pt(it,r),H=D(D({},Fr(this,t)),{},{type:this.constructor.type,version:Ai,originX:u,originY:f,left:st(l),top:st(c),width:st(d),height:st(m),fill:Wn(i)?i.toObject():i,stroke:Wn(n)?n.toObject():n,strokeWidth:st(p),strokeDashArray:a&&a.concat(),strokeLineCap:v,strokeDashOffset:_,strokeLineJoin:b,strokeUniform:C,strokeMiterLimit:st(k),scaleX:st(T),scaleY:st(P),angle:st(A),flipX:I,flipY:j,opacity:st(U),shadow:o&&o.toObject(),visible:$,backgroundColor:S,fillRule:F,paintFirst:y,globalCompositeOperation:W,skewX:st(tt),skewY:st(X)},e?{clipPath:e}:null);return this.includeDefaultValues?H:this._removeDefaultValues(H)}toDatalessObject(t){return this.toObject(t)}_removeDefaultValues(t){const e=this.constructor.getDefaults(),r=Object.keys(e).length>0?e:Object.getPrototypeOf(this);return Ji(t,(s,i)=>{if(i===kt||i===$t||i==="type")return!0;const n=r[i];return s!==n&&!(Array.isArray(s)&&Array.isArray(n)&&s.length===0&&n.length===0)})}toString(){return"#<".concat(this.constructor.type,">")}static _fromObject(t){let e=At(t,xh),r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{extraParam:s}=r,i=At(r,wh);return si(e,i).then(n=>s?(delete n[s],new this(e[s],n)):new this(n))}static fromObject(t,e){return this._fromObject(t,e)}};O(Oe,"stateProperties",hh),O(Oe,"cacheProperties",Le),O(Oe,"ownDefaults",lh),O(Oe,"type","FabricObject"),O(Oe,"colorProperties",[Rt,ee,"backgroundColor"]),O(Oe,"customProperties",[]),rt.setClass(Oe),rt.setClass(Oe,"object");const Lr=(h,t,e)=>(r,s,i,n)=>{const o=t(r,s,i,n);return o&&Bo(h,D(D({},Wo(r,s,i,n)),e)),o};function Ir(h){return(t,e,r,s)=>{const{target:i,originX:n,originY:o}=e,a=i.getRelativeCenterPoint(),l=i.translateToOriginPoint(a,n,o),c=h(t,e,r,s);return i.setPositionByOrigin(l,e.originX,e.originY),c}}const Zn=Lr(Vr,Ir((h,t,e,r)=>{const s=$i(t,t.originX,t.originY,e,r);if(It(t.originX)===It(yt)||It(t.originX)===It(Ft)&&s.x<0||It(t.originX)===It(kt)&&s.x>0){const{target:i}=t,n=i.strokeWidth/(i.strokeUniform?i.scaleX:1),o=zo(t)?2:1,a=i.width,l=Math.abs(s.x*o/i.scaleX)-n;return i.set("width",Math.max(l,1)),a!==i.width}return!1}));function Ch(h,t,e,r,s){r=r||{};const i=this.sizeX||r.cornerSize||s.cornerSize,n=this.sizeY||r.cornerSize||s.cornerSize,o=r.transparentCorners!==void 0?r.transparentCorners:s.transparentCorners,a=o?ee:Rt,l=!o&&(r.cornerStrokeColor||s.cornerStrokeColor);let c,u=t,f=e;h.save(),h.fillStyle=r.cornerColor||s.cornerColor||"",h.strokeStyle=r.cornerStrokeColor||s.cornerStrokeColor||"",i>n?(c=i,h.scale(1,n/i),f=e*i/n):n>i?(c=n,h.scale(i/n,1),u=t*n/i):c=i,h.lineWidth=1,h.beginPath(),h.arc(u,f,c/2,0,Ns,!1),h[a](),l&&h.stroke(),h.restore()}function Sh(h,t,e,r,s){r=r||{};const i=this.sizeX||r.cornerSize||s.cornerSize,n=this.sizeY||r.cornerSize||s.cornerSize,o=r.transparentCorners!==void 0?r.transparentCorners:s.transparentCorners,a=o?ee:Rt,l=!o&&(r.cornerStrokeColor||s.cornerStrokeColor),c=i/2,u=n/2;h.save(),h.fillStyle=r.cornerColor||s.cornerColor||"",h.strokeStyle=r.cornerStrokeColor||s.cornerStrokeColor||"",h.lineWidth=1,h.translate(t,e);const f=s.getTotalAngle();h.rotate(Lt(f)),h["".concat(a,"Rect")](-c,-u,i,n),l&&h.strokeRect(-c,-u,i,n),h.restore()}class pe{constructor(t){O(this,"visible",!0),O(this,"actionName",ei),O(this,"angle",0),O(this,"x",0),O(this,"y",0),O(this,"offsetX",0),O(this,"offsetY",0),O(this,"sizeX",0),O(this,"sizeY",0),O(this,"touchSizeX",0),O(this,"touchSizeY",0),O(this,"cursorStyle","crosshair"),O(this,"withConnection",!1),Object.assign(this,t)}shouldActivate(t,e,r,s){var i;let{tl:n,tr:o,br:a,bl:l}=s;return((i=e.canvas)===null||i===void 0?void 0:i.getActiveObject())===e&&e.isControlVisible(t)&&Mt.isPointInPolygon(r,[n,o,a,l])}getActionHandler(t,e,r){return this.actionHandler}getMouseDownHandler(t,e,r){return this.mouseDownHandler}getMouseUpHandler(t,e,r){return this.mouseUpHandler}cursorStyleHandler(t,e,r){return e.cursorStyle}getActionName(t,e,r){return e.actionName}getVisibility(t,e){var r,s;return(r=(s=t._controlsVisibility)===null||s===void 0?void 0:s[e])!==null&&r!==void 0?r:this.visible}setVisibility(t,e,r){this.visible=t}positionHandler(t,e,r,s){return new z(this.x*t.x+this.offsetX,this.y*t.y+this.offsetY).transform(e)}calcCornerCoords(t,e,r,s,i,n){const o=Zi([Jr(r,s),Qr({angle:t}),Ki((i?this.touchSizeX:this.sizeX)||e,(i?this.touchSizeY:this.sizeY)||e)]);return{tl:new z(-.5,-.5).transform(o),tr:new z(.5,-.5).transform(o),br:new z(.5,.5).transform(o),bl:new z(-.5,.5).transform(o)}}render(t,e,r,s,i){((s=s||{}).cornerStyle||i.cornerStyle)==="circle"?Ch.call(this,t,e,r,s,i):Sh.call(this,t,e,r,s,i)}}const Th=(h,t,e)=>e.lockRotation?qs:t.cursorStyle,kh=Lr(Co,Ir((h,t,e,r)=>{let{target:s,ex:i,ey:n,theta:o,originX:a,originY:l}=t;const c=s.translateToOriginPoint(s.getRelativeCenterPoint(),a,l);if(be(s,"lockRotation"))return!1;const u=Math.atan2(n-c.y,i-c.x),f=Math.atan2(r-c.y,e-c.x);let d=hr(f-u+o);if(s.snapAngle&&s.snapAngle>0){const p=s.snapAngle,v=s.snapThreshold||p,_=Math.ceil(d/p)*p,b=Math.floor(d/p)*p;Math.abs(d-b)<v?d=b:Math.abs(d-_)<v&&(d=_)}d<0&&(d=360+d),d%=360;const m=s.angle!==d;return s.angle=d,m}));function Go(h,t){const e=t.canvas,r=h[e.uniScaleKey];return e.uniformScaling&&!r||!e.uniformScaling&&r}function qo(h,t,e){const r=be(h,"lockScalingX"),s=be(h,"lockScalingY");if(r&&s||!t&&(r||s)&&e||r&&t==="x"||s&&t==="y")return!0;const{width:i,height:n,strokeWidth:o}=h;return i===0&&o===0&&t!=="y"||n===0&&o===0&&t!=="x"}const Oh=["e","se","s","sw","w","nw","n","ne","e"],Wr=(h,t,e)=>{const r=Go(h,e);if(qo(e,t.x!==0&&t.y===0?"x":t.x===0&&t.y!==0?"y":"",r))return qs;const s=No(e,t);return"".concat(Oh[s],"-resize")};function rn(h,t,e,r){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};const i=t.target,n=s.by,o=Go(h,i);let a,l,c,u,f,d;if(qo(i,n,o))return!1;if(t.gestureScale)l=t.scaleX*t.gestureScale,c=t.scaleY*t.gestureScale;else{if(a=$i(t,t.originX,t.originY,e,r),f=n!=="y"?Math.sign(a.x||t.signX||1):1,d=n!=="x"?Math.sign(a.y||t.signY||1):1,t.signX||(t.signX=f),t.signY||(t.signY=d),be(i,"lockScalingFlip")&&(t.signX!==f||t.signY!==d))return!1;if(u=i._getTransformedDimensions(),o&&!n){const v=Math.abs(a.x)+Math.abs(a.y),{original:_}=t,b=v/(Math.abs(u.x*_.scaleX/i.scaleX)+Math.abs(u.y*_.scaleY/i.scaleY));l=_.scaleX*b,c=_.scaleY*b}else l=Math.abs(a.x*i.scaleX/u.x),c=Math.abs(a.y*i.scaleY/u.y);zo(t)&&(l*=2,c*=2),t.signX!==f&&n!=="y"&&(t.originX=Xn(t.originX),l*=-1,t.signX=f),t.signY!==d&&n!=="x"&&(t.originY=Xn(t.originY),c*=-1,t.signY=d)}const m=i.scaleX,p=i.scaleY;return n?(n==="x"&&i.set(re,l),n==="y"&&i.set(ue,c)):(!be(i,"lockScalingX")&&i.set(re,l),!be(i,"lockScalingY")&&i.set(ue,c)),m!==i.scaleX||p!==i.scaleY}const hs=Lr(ti,Ir((h,t,e,r)=>rn(h,t,e,r))),Dh=Lr(ti,Ir((h,t,e,r)=>rn(h,t,e,r,{by:"x"}))),Eh=Lr(ti,Ir((h,t,e,r)=>rn(h,t,e,r,{by:"y"}))),Ah=["target","ex","ey","skewingSide"],xi={x:{counterAxis:"y",scale:re,skew:Pr,lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:ue,skew:jr,lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},Mh=["ns","nesw","ew","nwse"],Ph=(h,t,e)=>{if(t.x!==0&&be(e,"lockSkewingY")||t.y!==0&&be(e,"lockSkewingX"))return qs;const r=No(e,t)%4;return"".concat(Mh[r],"-resize")};function Zo(h,t,e,r,s){const{target:i}=e,{counterAxis:n,origin:o,lockSkewing:a,skew:l,flip:c}=xi[h];if(be(i,a))return!1;const{origin:u,flip:f}=xi[n],d=It(e[u])*(i[f]?-1:1),m=-Math.sign(d)*(i[c]?-1:1),p=.5*-((i[l]===0&&$i(e,yt,yt,r,s)[h]>0||i[l]>0?1:-1)*m)+.5;return Lr(So,Ir((_,b,C,k)=>function(T,P,A){let{target:I,ex:j,ey:U,skewingSide:$}=P,S=At(P,Ah);const{skew:F}=xi[T],y=A.subtract(new z(j,U)).divide(new z(I.scaleX,I.scaleY))[T],W=I[F],tt=S[F],X=Math.tan(Lt(tt)),st=T==="y"?I._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:I._getTransformedDimensions({scaleX:1,scaleY:1}).y,H=2*y*$/Math.max(st,1)+X,it=hr(Math.atan(H));I.set(F,it);const R=W!==I[F];if(R&&T==="y"){const{skewX:L,scaleX:ot}=I,Q=I._getTransformedDimensions({skewY:W}),G=I._getTransformedDimensions(),_t=L!==0?Q.x/G.x:1;_t!==1&&I.set(re,_t*ot)}return R}(h,b,new z(C,k))))(t,D(D({},e),{},{[o]:p,skewingSide:m}),r,s)}const jh=(h,t,e,r)=>Zo("x",h,t,e,r),Fh=(h,t,e,r)=>Zo("y",h,t,e,r);function oi(h,t){return h[t.canvas.altActionKey]}const ls=(h,t,e)=>{const r=oi(h,e);return t.x===0?r?Pr:ue:t.y===0?r?jr:re:""},Sr=(h,t,e)=>oi(h,e)?Ph(0,t,e):Wr(h,t,e),Kn=(h,t,e,r)=>oi(h,t.target)?Fh(h,t,e,r):Dh(h,t,e,r),Jn=(h,t,e,r)=>oi(h,t.target)?jh(h,t,e,r):Eh(h,t,e,r),Ko=()=>({ml:new pe({x:-.5,y:0,cursorStyleHandler:Sr,actionHandler:Kn,getActionName:ls}),mr:new pe({x:.5,y:0,cursorStyleHandler:Sr,actionHandler:Kn,getActionName:ls}),mb:new pe({x:0,y:.5,cursorStyleHandler:Sr,actionHandler:Jn,getActionName:ls}),mt:new pe({x:0,y:-.5,cursorStyleHandler:Sr,actionHandler:Jn,getActionName:ls}),tl:new pe({x:-.5,y:-.5,cursorStyleHandler:Wr,actionHandler:hs}),tr:new pe({x:.5,y:-.5,cursorStyleHandler:Wr,actionHandler:hs}),bl:new pe({x:-.5,y:.5,cursorStyleHandler:Wr,actionHandler:hs}),br:new pe({x:.5,y:.5,cursorStyleHandler:Wr,actionHandler:hs}),mtr:new pe({x:0,y:-.5,actionHandler:kh,cursorStyleHandler:Th,offsetY:-40,withConnection:!0,actionName:Gi})}),Lh=()=>({mr:new pe({x:.5,y:0,actionHandler:Zn,cursorStyleHandler:Sr,actionName:Vr}),ml:new pe({x:-.5,y:0,actionHandler:Zn,cursorStyleHandler:Sr,actionName:Vr})}),Ih=()=>D(D({},Ko()),Lh());class qr extends Oe{static getDefaults(){return D(D({},super.getDefaults()),qr.ownDefaults)}constructor(t){super(),Object.assign(this,this.constructor.createControls(),qr.ownDefaults),this.setOptions(t)}static createControls(){return{controls:Ko()}}_updateCacheCanvas(){const t=this.canvas;if(this.noScaleCache&&t&&t._currentTransform){const e=t._currentTransform,r=e.target,s=e.action;if(this===r&&s&&s.startsWith(ei))return!1}return super._updateCacheCanvas()}getActiveControl(){const t=this.__corner;return t?{key:t,control:this.controls[t],coord:this.oCoords[t]}:void 0}findControl(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;const r=Object.entries(this.oCoords);for(let s=r.length-1;s>=0;s--){const[i,n]=r[s],o=this.controls[i];if(o.shouldActivate(i,this,t,e?n.touchCorner:n.corner))return this.__corner=i,{key:i,control:o,coord:this.oCoords[i]}}}calcOCoords(){const t=this.getViewportTransform(),e=this.getCenterPoint(),r=Jr(e.x,e.y),s=Qr({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),i=Vt(r,s),n=Vt(t,i),o=Vt(n,[1/t[0],0,0,1/t[3],0,0]),a=this.group?Vs(this.calcTransformMatrix()):void 0;a&&(a.scaleX=Math.abs(a.scaleX),a.scaleY=Math.abs(a.scaleY));const l=this._calculateCurrentDimensions(a),c={};return this.forEachControl((u,f)=>{const d=u.positionHandler(l,o,this,u);c[f]=Object.assign(d,this._calcCornerCoords(u,d))}),c}_calcCornerCoords(t,e){const r=this.getTotalAngle();return{corner:t.calcCornerCoords(r,this.cornerSize,e.x,e.y,!1,this),touchCorner:t.calcCornerCoords(r,this.touchCornerSize,e.x,e.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(t){for(const e in this.controls)t(this.controls[e],e,this)}drawSelectionBackground(t){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;t.save();const e=this.getRelativeCenterPoint(),r=this._calculateCurrentDimensions(),s=this.getViewportTransform();t.translate(e.x,e.y),t.scale(1/s[0],1/s[3]),t.rotate(Lt(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-r.x/2,-r.y/2,r.x,r.y),t.restore()}strokeBorders(t,e){t.strokeRect(-e.x/2,-e.y/2,e.x,e.y)}_drawBorders(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=D({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},r);t.save(),t.strokeStyle=s.borderColor,this._setLineDash(t,s.borderDashArray),this.strokeBorders(t,e),s.hasControls&&this.drawControlsConnectingLines(t,e),t.restore()}_renderControls(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{hasBorders:r,hasControls:s}=this,i=D({hasBorders:r,hasControls:s},e),n=this.getViewportTransform(),o=i.hasBorders,a=i.hasControls,l=Vt(n,this.calcTransformMatrix()),c=Vs(l);t.save(),t.translate(c.translateX,c.translateY),t.lineWidth=1*this.borderScaleFactor,this.group===this.parent&&(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(c.angle-=180),t.rotate(Lt(this.group?c.angle:this.angle)),o&&this.drawBorders(t,c,e),a&&this.drawControls(t,e),t.restore()}drawBorders(t,e,r){let s;if(r&&r.forActiveSelection||this.group){const i=Qi(this.width,this.height,ri(e)),n=this.isStrokeAccountedForInDimensions()?qi:(this.strokeUniform?new z().scalarAdd(this.canvas?this.canvas.getZoom():1):new z(e.scaleX,e.scaleY)).scalarMultiply(this.strokeWidth);s=i.add(n).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else s=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(t,s,r)}drawControlsConnectingLines(t,e){let r=!1;t.beginPath(),this.forEachControl((s,i)=>{s.withConnection&&s.getVisibility(this,i)&&(r=!0,t.moveTo(s.x*e.x,s.y*e.y),t.lineTo(s.x*e.x+s.offsetX,s.y*e.y+s.offsetY))}),r&&t.stroke()}drawControls(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t.save();const r=this.getCanvasRetinaScaling(),{cornerStrokeColor:s,cornerDashArray:i,cornerColor:n}=this,o=D({cornerStrokeColor:s,cornerDashArray:i,cornerColor:n},e);t.setTransform(r,0,0,r,0,0),t.strokeStyle=t.fillStyle=o.cornerColor,this.transparentCorners||(t.strokeStyle=o.cornerStrokeColor),this._setLineDash(t,o.cornerDashArray),this.forEachControl((a,l)=>{if(a.getVisibility(this,l)){const c=this.oCoords[l];a.render(t,c.x,c.y,o,this)}}),t.restore()}isControlVisible(t){return this.controls[t]&&this.controls[t].getVisibility(this,t)}setControlVisible(t,e){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=e}setControlsVisibility(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.entries(t).forEach(e=>{let[r,s]=e;return this.setControlVisible(r,s)})}clearContextTop(t){if(!this.canvas)return;const e=this.canvas.contextTop;if(!e)return;const r=this.canvas.viewportTransform;e.save(),e.transform(r[0],r[1],r[2],r[3],r[4],r[5]),this.transform(e);const s=this.width+4,i=this.height+4;return e.clearRect(-s/2,-i/2,s,i),t||e.restore(),e}onDeselect(t){return!1}onSelect(t){return!1}shouldStartDragging(t){return!1}onDragStart(t){return!1}canDrop(t){return!1}renderDragSourceEffect(t){}renderDropTargetEffect(t){}}function Jo(h,t){return t.forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(r=>{r!=="constructor"&&Object.defineProperty(h.prototype,r,Object.getOwnPropertyDescriptor(e.prototype,r)||Object.create(null))})}),h}O(qr,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class Gt extends qr{}Jo(Gt,[Uo]),rt.setClass(Gt),rt.setClass(Gt,"object");const Rh=(h,t,e,r)=>{const s=2*(r=Math.round(r))+1,{data:i}=h.getImageData(t-r,e-r,s,s);for(let n=3;n<i.length;n+=4)if(i[n]>0)return!1;return!0};class Qo{constructor(t){this.options=t,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new z(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new z(1/this.options.scaleX,1/this.options.scaleY):new z(1,1)}createSideVector(t,e){const r=Li(t,e);return this.options.strokeUniform?r.multiply(this.scale):r}projectOrthogonally(t,e,r){return this.applySkew(t.add(this.calcOrthogonalProjection(t,e,r)))}isSkewed(){return this.options.skewX!==0||this.options.skewY!==0}applySkew(t){const e=new z(t);return e.y+=e.x*Math.tan(Lt(this.options.skewY)),e.x+=e.y*Math.tan(Lt(this.options.skewX)),e}scaleUnitVector(t,e){return t.multiply(this.strokeUniformScalar).scalarMultiply(e)}}const Bh=new z;class Er extends Qo{static getOrthogonalRotationFactor(t,e){const r=e?Ri(t,e):oh(t);return Math.abs(r)<Kr?-1:1}constructor(t,e,r,s){super(s),O(this,"AB",void 0),O(this,"AC",void 0),O(this,"alpha",void 0),O(this,"bisector",void 0),this.A=new z(t),this.B=new z(e),this.C=new z(r),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=Ri(this.AB,this.AC),this.bisector=tn(Yo(this.AB.eq(Bh)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const s=this.createSideVector(t,e),i=Vo(s),n=Er.getOrthogonalRotationFactor(i,this.bisector);return this.scaleUnitVector(i,r*n)}projectBevel(){const t=[];return(this.alpha%Ns==0?[this.B]:[this.B,this.C]).forEach(e=>{t.push(this.projectOrthogonally(this.A,e)),t.push(this.projectOrthogonally(this.A,e,-this.strokeProjectionMagnitude))}),t}projectMiter(){const t=[],e=Math.abs(this.alpha),r=1/Math.sin(e/2),s=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*r),i=this.options.strokeUniform?Ii(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return Ii(s)/this.strokeProjectionMagnitude<=i&&t.push(this.applySkew(this.A.add(s))),t.push(...this.projectBevel()),t}projectRoundNoSkew(t,e){const r=[],s=new z(Er.getOrthogonalRotationFactor(this.bisector),Er.getOrthogonalRotationFactor(new z(this.bisector.y,this.bisector.x)));return[new z(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(s),new z(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(s)].forEach(i=>{Hn(i,t,e)&&r.push(this.A.add(i))}),r}projectRoundWithSkew(t,e){const r=[],{skewX:s,skewY:i,scaleX:n,scaleY:o,strokeUniform:a}=this.options,l=new z(Math.tan(Lt(s)),Math.tan(Lt(i))),c=this.strokeProjectionMagnitude,u=a?c/o/Math.sqrt(1/o**2+1/n**2*l.y**2):c/Math.sqrt(1+l.y**2),f=new z(Math.sqrt(Math.max(c**2-u**2,0)),u),d=a?c/Math.sqrt(1+l.x**2*(1/o)**2/(1/n+1/n*l.x*l.y)**2):c/Math.sqrt(1+l.x**2/(1+l.x*l.y)**2),m=new z(d,Math.sqrt(Math.max(c**2-d**2,0)));return[m,m.scalarMultiply(-1),f,f.scalarMultiply(-1)].map(p=>this.applySkew(a?p.multiply(this.strokeUniformScalar):p)).forEach(p=>{Hn(p,t,e)&&r.push(this.applySkew(this.A).add(p))}),r}projectRound(){const t=[];t.push(...this.projectBevel());const e=this.alpha%Ns==0,r=this.applySkew(this.A),s=t[e?0:2].subtract(r),i=t[e?1:0].subtract(r),n=e?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)),o=Ur(s,n)>0,a=o?s:i,l=o?i:s;return this.isSkewed()?t.push(...this.projectRoundWithSkew(a,l)):t.push(...this.projectRoundNoSkew(a,l)),t}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map(t=>({originPoint:this.A,projectedPoint:t,angle:this.alpha,bisector:this.bisector}))}}class Qn extends Qo{constructor(t,e,r){super(r),this.A=new z(t),this.T=new z(e)}calcOrthogonalProjection(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const s=this.createSideVector(t,e);return this.scaleUnitVector(Vo(s),r)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){const t=[];if(!this.isSkewed()&&this.A.eq(this.T)){const e=new z(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.applySkew(this.A.add(e)),this.applySkew(this.A.subtract(e)))}else t.push(...new Er(this.A,this.T,this.T,this.options).projectRound());return t}projectSquare(){const t=[];if(this.A.eq(this.T)){const e=new z(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.A.add(e),this.A.subtract(e))}else{const e=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),r=this.scaleUnitVector(tn(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),s=this.A.add(r);t.push(s.add(e),s.subtract(e))}return t.map(e=>this.applySkew(e))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map(t=>({originPoint:this.A,projectedPoint:t}))}}const zh=function(h,t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const r=[];if(h.length===0)return r;const s=h.reduce((i,n)=>(i[i.length-1].eq(n)||i.push(new z(n)),i),[new z(h[0])]);if(s.length===1)e=!0;else if(!e){const i=s[0],n=((o,a)=>{for(let l=o.length-1;l>=0;l--)if(a(o[l],l,o))return l;return-1})(s,o=>!o.eq(i));s.splice(n+1)}return s.forEach((i,n,o)=>{let a,l;n===0?(l=o[1],a=e?i:o[o.length-1]):n===o.length-1?(a=o[n-1],l=e?i:o[0]):(a=o[n-1],l=o[n+1]),e&&o.length===1?r.push(...new Qn(i,i,t).project()):!e||n!==0&&n!==o.length-1?r.push(...new Er(i,a,l,t).project()):r.push(...new Qn(i,n===0?l:a,t).project())}),r},sn=h=>{const t={};return Object.keys(h).forEach(e=>{t[e]={},Object.keys(h[e]).forEach(r=>{t[e][r]=D({},h[e][r])})}),t},Wh=h=>h.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),nn=h=>{const t=[];for(let e,r=0;r<h.length;r++)(e=Nh(h,r))!==!1&&t.push(e);return t},Nh=(h,t)=>{const e=h.charCodeAt(t);if(isNaN(e))return"";if(e<55296||e>57343)return h.charAt(t);if(55296<=e&&e<=56319){if(h.length<=t+1)throw"High surrogate without following low surrogate";const s=h.charCodeAt(t+1);if(56320>s||s>57343)throw"High surrogate without following low surrogate";return h.charAt(t)+h.charAt(t+1)}if(t===0)throw"Low surrogate without preceding high surrogate";const r=h.charCodeAt(t-1);if(55296>r||r>56319)throw"Low surrogate without preceding high surrogate";return!1},on=function(h,t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return h.fill!==t.fill||h.stroke!==t.stroke||h.strokeWidth!==t.strokeWidth||h.fontSize!==t.fontSize||h.fontFamily!==t.fontFamily||h.fontWeight!==t.fontWeight||h.fontStyle!==t.fontStyle||h.textBackgroundColor!==t.textBackgroundColor||h.deltaY!==t.deltaY||e&&(h.overline!==t.overline||h.underline!==t.underline||h.linethrough!==t.linethrough)},Uh=(h,t)=>{const e=t.split(`
`),r=[];let s=-1,i={};h=sn(h);for(let n=0;n<e.length;n++){const o=nn(e[n]);if(h[n])for(let a=0;a<o.length;a++){s++;const l=h[n][a];l&&Object.keys(l).length>0&&(on(i,l,!0)?r.push({start:s,end:s+1,style:l}):r[r.length-1].end++),i=l||{}}else s+=o.length,i={}}return r},Xh=(h,t)=>{if(!Array.isArray(h))return sn(h);const e=t.split(Hi),r={};let s=-1,i=0;for(let n=0;n<e.length;n++){const o=nn(e[n]);for(let a=0;a<o.length;a++)s++,h[i]&&h[i].start<=s&&s<h[i].end&&(r[n]=r[n]||{},r[n][a]=D({},h[i].style),s===h[i].end-1&&i++)}return r},Ge=["display","transform",Rt,"fill-opacity","fill-rule","opacity",ee,"stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function $n(h,t){const e=h.nodeName,r=h.getAttribute("class"),s=h.getAttribute("id"),i="(?![a-zA-Z\\-]+)";let n;if(n=new RegExp("^"+e,"i"),t=t.replace(n,""),s&&t.length&&(n=new RegExp("#"+s+i,"i"),t=t.replace(n,"")),r&&t.length){const o=r.split(" ");for(let a=o.length;a--;)n=new RegExp("\\."+o[a]+i,"i"),t=t.replace(n,"")}return t.length===0}function Yh(h,t){let e=!0;const r=$n(h,t.pop());return r&&t.length&&(e=function(s,i){let n,o=!0;for(;s.parentElement&&s.parentElement.nodeType===1&&i.length;)o&&(n=i.pop()),o=$n(s=s.parentElement,n);return i.length===0}(h,t)),r&&e&&t.length===0}const Vh=h=>{var t;return(t=ih[h])!==null&&t!==void 0?t:h},Hh=new RegExp("(".concat(lr,")"),"gi"),Gh=h=>h.replace(Hh," $1 ").replace(/,/gi," ").replace(/\s+/gi," ");var to,eo,ro,so,io,no,oo;const Zt="(".concat(lr,")"),qh=String.raw(to||(to=He(["(skewX)(",")"],["(skewX)\\(","\\)"])),Zt),Zh=String.raw(eo||(eo=He(["(skewY)(",")"],["(skewY)\\(","\\)"])),Zt),Kh=String.raw(ro||(ro=He(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),Zt,Zt,Zt),Jh=String.raw(so||(so=He(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),Zt,Zt),Qh=String.raw(io||(io=He(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),Zt,Zt),$h=String.raw(no||(no=He(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),Zt,Zt,Zt,Zt,Zt,Zt),an="(?:".concat($h,"|").concat(Qh,"|").concat(Kh,"|").concat(Jh,"|").concat(qh,"|").concat(Zh,")"),tl="(?:".concat(an,"*)"),el=String.raw(oo||(oo=He(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),tl),rl=new RegExp(el),sl=new RegExp(an),il=new RegExp(an,"g");function Bi(h){const t=[];if(!(h=Gh(h).replace(/\s*([()])\s*/gi,"$1"))||h&&!rl.test(h))return[...Kt];for(const e of h.matchAll(il)){const r=sl.exec(e[0]);if(!r)continue;let s=Kt;const i=r.filter(m=>!!m),[,n,...o]=i,[a,l,c,u,f,d]=o.map(m=>parseFloat(m));switch(n){case"translate":s=Jr(a,l);break;case Gi:s=Qr({angle:a},{x:l,y:c});break;case ei:s=Ki(a,l);break;case Pr:s=Ao(a);break;case jr:s=Mo(a);break;case"matrix":s=[a,l,c,u,f,d]}t.push(s)}return Zi(t)}function nl(h,t,e,r){const s=Array.isArray(t);let i,n=t;if(h!==Rt&&h!==ee||t!==te){if(h==="strokeUniform")return t==="non-scaling-stroke";if(h==="strokeDashArray")n=t===te?null:t.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(h==="transformMatrix")n=e&&e.transformMatrix?Vt(e.transformMatrix,Bi(t)):Bi(t);else if(h==="visible")n=t!==te&&t!=="hidden",e&&e.visible===!1&&(n=!1);else if(h==="opacity")n=parseFloat(t),e&&e.opacity!==void 0&&(n*=e.opacity);else if(h==="textAnchor")n=t==="start"?kt:t==="end"?Ft:yt;else if(h==="charSpacing")i=Or(t,r)/r*1e3;else if(h==="paintFirst"){const o=t.indexOf(Rt),a=t.indexOf(ee);n=Rt,(o>-1&&a>-1&&a<o||o===-1&&a>-1)&&(n=ee)}else{if(h==="href"||h==="xlink:href"||h==="font"||h==="id")return t;if(h==="imageSmoothing")return t==="optimizeQuality";i=s?t.map(Or):Or(t,r)}}else n="";return!s&&isNaN(i)?n:i}function ol(h,t){const e=h.match(sh);if(!e)return;const r=e[1],s=e[3],i=e[4],n=e[5],o=e[6];r&&(t.fontStyle=r),s&&(t.fontWeight=isNaN(parseFloat(s))?s:parseFloat(s)),i&&(t.fontSize=Or(i)),o&&(t.fontFamily=o),n&&(t.lineHeight=n==="normal"?1:n)}function al(h,t){h.replace(/;\s*$/,"").split(";").forEach(e=>{if(!e)return;const[r,s]=e.split(":");t[r.trim().toLowerCase()]=s.trim()})}function hl(h){const t={},e=h.getAttribute("style");return e&&(typeof e=="string"?al(e,t):function(r,s){Object.entries(r).forEach(i=>{let[n,o]=i;o!==void 0&&(s[n.toLowerCase()]=o)})}(e,t)),t}const ll={stroke:"strokeOpacity",fill:"fillOpacity"};function Ie(h,t,e){if(!h)return{};let r,s={},i=Vi;h.parentNode&&Vn.test(h.parentNode.nodeName)&&(s=Ie(h.parentElement,t,e),s.fontSize&&(r=i=Or(s.fontSize)));const n=D(D(D({},t.reduce((l,c)=>{const u=h.getAttribute(c);return u&&(l[c]=u),l},{})),function(l){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u={};for(const f in c)Yh(l,f.split(" "))&&(u=D(D({},u),c[f]));return u}(h,e)),hl(h));n[yi]&&h.setAttribute(yi,n[yi]),n[vi]&&(r=Or(n[vi],i),n[vi]="".concat(r));const o={};for(const l in n){const c=Vh(l),u=nl(c,n[l],s,r);o[c]=u}o&&o.font&&ol(o.font,o);const a=D(D({},s),o);return Vn.test(h.nodeName)?a:function(l){const c=Gt.getDefaults();return Object.entries(ll).forEach(u=>{let[f,d]=u;if(l[d]===void 0||l[f]==="")return;if(l[f]===void 0){if(!c[f])return;l[f]=c[f]}if(l[f].indexOf("url(")===0)return;const m=new Ot(l[f]);l[f]=m.setAlpha(Pt(m.getAlpha()*l[d],2)).toRgba()}),l}(a)}const cl=["left","top","width","height","visible"],$o=["rx","ry"];class _e extends Gt{static getDefaults(){return D(D({},super.getDefaults()),_e.ownDefaults)}constructor(t){super(),Object.assign(this,_e.ownDefaults),this.setOptions(t),this._initRxRy()}_initRxRy(){const{rx:t,ry:e}=this;t&&!e?this.ry=t:e&&!t&&(this.rx=e)}_render(t){const{width:e,height:r}=this,s=-e/2,i=-r/2,n=this.rx?Math.min(this.rx,e/2):0,o=this.ry?Math.min(this.ry,r/2):0,a=n!==0||o!==0;t.beginPath(),t.moveTo(s+n,i),t.lineTo(s+e-n,i),a&&t.bezierCurveTo(s+e-Ue*n,i,s+e,i+Ue*o,s+e,i+o),t.lineTo(s+e,i+r-o),a&&t.bezierCurveTo(s+e,i+r-Ue*o,s+e-Ue*n,i+r,s+e-n,i+r),t.lineTo(s+n,i+r),a&&t.bezierCurveTo(s+Ue*n,i+r,s,i+r-Ue*o,s,i+r-o),t.lineTo(s,i+o),a&&t.bezierCurveTo(s,i+Ue*o,s+Ue*n,i,s+n,i),t.closePath(),this._renderPaintInOrder(t)}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...$o,...t])}_toSVG(){const{width:t,height:e,rx:r,ry:s}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-t/2,'" y="').concat(-e/2,'" rx="').concat(r,'" ry="').concat(s,'" width="').concat(t,'" height="').concat(e,`" />
`)]}static async fromElement(t,e,r){const s=Ie(t,this.ATTRIBUTE_NAMES,r),{left:i=0,top:n=0,width:o=0,height:a=0,visible:l=!0}=s,c=At(s,cl);return new this(D(D(D({},e),c),{},{left:i,top:n,width:o,height:a,visible:!!(l&&o&&a)}))}}O(_e,"type","Rect"),O(_e,"cacheProperties",[...Le,...$o]),O(_e,"ownDefaults",{rx:0,ry:0}),O(_e,"ATTRIBUTE_NAMES",[...Ge,"x","y","rx","ry","width","height"]),rt.setClass(_e),rt.setSVGClass(_e);const Ee="initialization",Zs="added",hn="removed",Ks="imperative",ta=(h,t)=>{const{strokeUniform:e,strokeWidth:r,width:s,height:i,group:n}=t,o=n&&n!==h?ii(n.calcTransformMatrix(),h.calcTransformMatrix()):null,a=o?t.getRelativeCenterPoint().transform(o):t.getRelativeCenterPoint(),l=!t.isStrokeAccountedForInDimensions(),c=e&&l?$a(new z(r,r),void 0,h.calcTransformMatrix()):qi,u=!e&&l?r:0,f=Qi(s+u,i+u,Zi([o,t.calcOwnMatrix()],!0)).add(c).scalarDivide(2);return[a.subtract(f),a.add(f)]};class ai{calcLayoutResult(t,e){if(this.shouldPerformLayout(t))return this.calcBoundingBox(e,t)}shouldPerformLayout(t){let{type:e,prevStrategy:r,strategy:s}=t;return e===Ee||e===Ks||!!r&&s!==r}shouldLayoutClipPath(t){let{type:e,target:{clipPath:r}}=t;return e!==Ee&&r&&!r.absolutePositioned}getInitialSize(t,e){return e.size}calcBoundingBox(t,e){const{type:r,target:s}=e;if(r===Ks&&e.overrides)return e.overrides;if(t.length===0)return;const{left:i,top:n,width:o,height:a}=Me(t.map(u=>ta(s,u)).reduce((u,f)=>u.concat(f),[])),l=new z(o,a),c=new z(i,n).add(l.scalarDivide(2));if(r===Ee){const u=this.getInitialSize(e,{size:l,center:c});return{center:c,relativeCorrection:new z(0,0),size:u}}return{center:c.transform(s.calcOwnMatrix()),size:l}}}O(ai,"type","strategy");class zi extends ai{shouldPerformLayout(t){return!0}}O(zi,"type","fit-content"),rt.setClass(zi);const ul=["strategy"],dl=["target","strategy","bubbles","prevStrategy"],ea="layoutManager";class Zr{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new zi;O(this,"strategy",void 0),this.strategy=t,this._subscriptions=new Map}performLayout(t){const e=D(D({bubbles:!0,strategy:this.strategy},t),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}});this.onBeforeLayout(e);const r=this.getLayoutResult(e);r&&this.commitLayout(e,r),this.onAfterLayout(e,r),this._prevLayoutStrategy=e.strategy}attachHandlers(t,e){const{target:r}=e;return[Xs,wo,Vr,Co,ti,So,Us,Ba,za].map(s=>t.on(s,i=>this.performLayout(s===Xs?{type:"object_modified",trigger:s,e:i,target:r}:{type:"object_modifying",trigger:s,e:i,target:r})))}subscribe(t,e){this.unsubscribe(t,e);const r=this.attachHandlers(t,e);this._subscriptions.set(t,r)}unsubscribe(t,e){(this._subscriptions.get(t)||[]).forEach(r=>r()),this._subscriptions.delete(t)}unsubscribeTargets(t){t.targets.forEach(e=>this.unsubscribe(e,t))}subscribeTargets(t){t.targets.forEach(e=>this.subscribe(e,t))}onBeforeLayout(t){const{target:e,type:r}=t,{canvas:s}=e;if(r===Ee||r===Zs?this.subscribeTargets(t):r===hn&&this.unsubscribeTargets(t),e.fire("layout:before",{context:t}),s&&s.fire("object:layout:before",{target:e,context:t}),r===Ks&&t.deep){const i=At(t,ul);e.forEachObject(n=>n.layoutManager&&n.layoutManager.performLayout(D(D({},i),{},{bubbles:!1,target:n})))}}getLayoutResult(t){const{target:e,strategy:r,type:s}=t,i=r.calcLayoutResult(t,e.getObjects());if(!i)return;const n=s===Ee?new z:e.getRelativeCenterPoint(),{center:o,correction:a=new z,relativeCorrection:l=new z}=i,c=n.subtract(o).add(a).transform(s===Ee?Kt:ye(e.calcOwnMatrix()),!0).add(l);return{result:i,prevCenter:n,nextCenter:o,offset:c}}commitLayout(t,e){const{target:r}=t,{result:{size:s},nextCenter:i}=e;var n,o;r.set({width:s.x,height:s.y}),this.layoutObjects(t,e),t.type===Ee?r.set({left:(n=t.x)!==null&&n!==void 0?n:i.x+s.x*It(r.originX),top:(o=t.y)!==null&&o!==void 0?o:i.y+s.y*It(r.originY)}):(r.setPositionByOrigin(i,yt,yt),r.setCoords(),r.set("dirty",!0))}layoutObjects(t,e){const{target:r}=t;r.forEachObject(s=>{s.group===r&&this.layoutObject(t,e,s)}),t.strategy.shouldLayoutClipPath(t)&&this.layoutObject(t,e,r.clipPath)}layoutObject(t,e,r){let{offset:s}=e;r.set({left:r.left+s.x,top:r.top+s.y})}onAfterLayout(t,e){const{target:r,strategy:s,bubbles:i,prevStrategy:n}=t,o=At(t,dl),{canvas:a}=r;r.fire("layout:after",{context:t,result:e}),a&&a.fire("object:layout:after",{context:t,result:e,target:r});const l=r.parent;i&&l!=null&&l.layoutManager&&((o.path||(o.path=[])).push(r),l.layoutManager.performLayout(D(D({},o),{},{target:l}))),r.set("dirty",!0)}dispose(){const{_subscriptions:t}=this;t.forEach(e=>e.forEach(r=>r())),t.clear()}toObject(){return{type:ea,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}}rt.setClass(Zr,ea);const fl=["type","objects","layoutManager"];class gl extends Zr{performLayout(){}}class ar extends To(Gt){static getDefaults(){return D(D({},super.getDefaults()),ar.ownDefaults)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),O(this,"_activeObjects",[]),O(this,"__objectSelectionTracker",void 0),O(this,"__objectSelectionDisposer",void 0),Object.assign(this,ar.ownDefaults),this.setOptions(e),this.groupInit(t,e)}groupInit(t,e){var r;this._objects=[...t],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject(s=>{this.enterGroup(s,!1)}),this.layoutManager=(r=e.layoutManager)!==null&&r!==void 0?r:new Zr,this.layoutManager.performLayout({type:Ee,target:this,targets:[...t],x:e.left,y:e.top})}canEnterGroup(t){return t===this||this.isDescendantOf(t)?(Ye("error","Group: circular object trees are not supported, this call has no effect"),!1):this._objects.indexOf(t)===-1||(Ye("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(t){return t.filter((e,r,s)=>this.canEnterGroup(e)&&s.indexOf(e)===r)}add(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];const s=this._filterObjectsBeforeEnteringGroup(e),i=super.add(...s);return this._onAfterObjectsChange(Zs,s),i}insertAt(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),s=1;s<e;s++)r[s-1]=arguments[s];const i=this._filterObjectsBeforeEnteringGroup(r),n=super.insertAt(t,...i);return this._onAfterObjectsChange(Zs,i),n}remove(){const t=super.remove(...arguments);return this._onAfterObjectsChange(hn,t),t}_onObjectAdded(t){this.enterGroup(t,!0),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t,e){this.exitGroup(t,e),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onAfterObjectsChange(t,e){this.layoutManager.performLayout({type:t,targets:e,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(t,e){const r=this[t];return super._set(t,e),t==="canvas"&&r!==e&&(this._objects||[]).forEach(s=>{s._set(t,e)}),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(t,e){let{target:r}=e;const s=this._activeObjects;if(t)s.push(r),this._set("dirty",!0);else if(s.length>0){const i=s.indexOf(r);i>-1&&(s.splice(i,1),this._set("dirty",!0))}}_watchObject(t,e){t&&this._watchObject(!1,e),t?(e.on("selected",this.__objectSelectionTracker),e.on("deselected",this.__objectSelectionDisposer)):(e.off("selected",this.__objectSelectionTracker),e.off("deselected",this.__objectSelectionDisposer))}enterGroup(t,e){t.group&&t.group.remove(t),t._set("parent",this),this._enterGroup(t,e)}_enterGroup(t,e){e&&Gs(t,Vt(ye(this.calcTransformMatrix()),t.calcTransformMatrix())),this._shouldSetNestedCoords()&&t.setCoords(),t._set("group",this),t._set("canvas",this.canvas),this._watchObject(!0,t);const r=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();r&&(r===t||t.isDescendantOf(r))&&this._activeObjects.push(t)}exitGroup(t,e){this._exitGroup(t,e),t._set("parent",void 0),t._set("canvas",void 0)}_exitGroup(t,e){t._set("group",void 0),e||(Gs(t,Vt(this.calcTransformMatrix(),t.calcTransformMatrix())),t.setCoords()),this._watchObject(!1,t);const r=this._activeObjects.length>0?this._activeObjects.indexOf(t):-1;r>-1&&this._activeObjects.splice(r,1)}shouldCache(){const t=Gt.prototype.shouldCache.call(this);if(t){for(let e=0;e<this._objects.length;e++)if(this._objects[e].willDrawShadow())return this.ownCaching=!1,!1}return t}willDrawShadow(){if(super.willDrawShadow())return!0;for(let t=0;t<this._objects.length;t++)if(this._objects[t].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(t){this._renderBackground(t);for(let r=0;r<this._objects.length;r++){var e;(e=this.canvas)!==null&&e!==void 0&&e.preserveObjectStacking&&this._objects[r].group!==this?(t.save(),t.transform(...ye(this.calcTransformMatrix())),this._objects[r].render(t),t.restore()):this._objects[r].group===this&&this._objects[r].render(t)}this._drawClipPath(t,this.clipPath)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject(t=>t.setCoords())}triggerLayout(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.layoutManager.performLayout(D({target:this,type:Ks},t))}render(t){this._transformDone=!0,super.render(t),this._transformDone=!1}__serializeObjects(t,e){const r=this.includeDefaultValues;return this._objects.filter(function(s){return!s.excludeFromExport}).map(function(s){const i=s.includeDefaultValues;s.includeDefaultValues=r;const n=s[t||"toObject"](e);return s.includeDefaultValues=i,n})}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=this.layoutManager.toObject();return D(D(D({},super.toObject(["subTargetCheck","interactive",...t])),e.strategy!=="fit-content"||this.includeDefaultValues?{layoutManager:e}:{}),{},{objects:this.__serializeObjects("toObject",t)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject(t=>{this._watchObject(!1,t),t.dispose()}),super.dispose()}_createSVGBgRect(t){if(!this.backgroundColor)return"";const e=_e.prototype._toSVG.call(this),r=e.indexOf("COMMON_PARTS");e[r]='for="group" ';const s=e.join("");return t?t(s):s}_toSVG(t){const e=["<g ","COMMON_PARTS",` >
`],r=this._createSVGBgRect(t);r&&e.push("		",r);for(let s=0;s<this._objects.length;s++)e.push("		",this._objects[s].toSVG(t));return e.push(`</g>
`),e}getSvgStyles(){const t=this.opacity!==void 0&&this.opacity!==1?"opacity: ".concat(this.opacity,";"):"",e=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),e].join("")}toClipPathSVG(t){const e=[],r=this._createSVGBgRect(t);r&&e.push("	",r);for(let s=0;s<this._objects.length;s++)e.push("	",this._objects[s].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(e,{reviver:t})}static fromObject(t,e){let{type:r,objects:s=[],layoutManager:i}=t,n=At(t,fl);return Promise.all([Hr(s,e),si(n,e)]).then(o=>{let[a,l]=o;const c=new this(a,D(D(D({},n),l),{},{layoutManager:new gl}));if(i){const u=rt.getClass(i.type),f=rt.getClass(i.strategy);c.layoutManager=new u(new f)}else c.layoutManager=new Zr;return c.layoutManager.subscribeTargets({type:Ee,target:c,targets:c.getObjects()}),c.setCoords(),c})}}O(ar,"type","Group"),O(ar,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),rt.setClass(ar);const pl=(h,t)=>Math.min(t.width/h.width,t.height/h.height),ml=(h,t)=>Math.max(t.width/h.width,t.height/h.height),Wi="\\s*,?\\s*",zr="".concat(Wi,"(").concat(lr,")"),_l="".concat(zr).concat(zr).concat(zr).concat(Wi,"([01])").concat(Wi,"([01])").concat(zr).concat(zr),vl={m:"l",M:"L"},yl=(h,t,e,r,s,i,n,o,a,l,c)=>{const u=je(h),f=Fe(h),d=je(t),m=Fe(t),p=e*s*d-r*i*m+n,v=r*s*d+e*i*m+o;return["C",l+a*(-e*s*f-r*i*u),c+a*(-r*s*f+e*i*u),p+a*(e*s*m+r*i*d),v+a*(r*s*m-e*i*d),p,v]},ao=(h,t,e,r)=>{const s=Math.atan2(t,h),i=Math.atan2(r,e);return i>=s?i-s:2*Math.PI-(s-i)};function ho(h,t,e,r,s,i,n,o){let a;if(xt.cachesBoundsOfCurve&&(a=[...arguments].join(),Nr.boundsOfCurveCache[a]))return Nr.boundsOfCurveCache[a];const l=Math.sqrt,c=Math.abs,u=[],f=[[0,0],[0,0]];let d=6*h-12*e+6*s,m=-3*h+9*e-9*s+3*n,p=3*e-3*h;for(let k=0;k<2;++k){if(k>0&&(d=6*t-12*r+6*i,m=-3*t+9*r-9*i+3*o,p=3*r-3*t),c(m)<1e-12){if(c(d)<1e-12)continue;const j=-p/d;0<j&&j<1&&u.push(j);continue}const T=d*d-4*p*m;if(T<0)continue;const P=l(T),A=(-d+P)/(2*m);0<A&&A<1&&u.push(A);const I=(-d-P)/(2*m);0<I&&I<1&&u.push(I)}let v=u.length;const _=v,b=ra(h,t,e,r,s,i,n,o);for(;v--;){const{x:k,y:T}=b(u[v]);f[0][v]=k,f[1][v]=T}f[0][_]=h,f[1][_]=t,f[0][_+1]=n,f[1][_+1]=o;const C=[new z(Math.min(...f[0]),Math.min(...f[1])),new z(Math.max(...f[0]),Math.max(...f[1]))];return xt.cachesBoundsOfCurve&&(Nr.boundsOfCurveCache[a]=C),C}const bl=(h,t,e)=>{let[r,s,i,n,o,a,l,c]=e;const u=((f,d,m,p,v,_,b)=>{if(m===0||p===0)return[];let C=0,k=0,T=0;const P=Math.PI,A=b*Yi,I=Fe(A),j=je(A),U=.5*(-j*f-I*d),$=.5*(-j*d+I*f),S=m**2,F=p**2,y=$**2,W=U**2,tt=S*F-S*y-F*W;let X=Math.abs(m),st=Math.abs(p);if(tt<0){const K=Math.sqrt(1-tt/(S*F));X*=K,st*=K}else T=(v===_?-1:1)*Math.sqrt(tt/(S*y+F*W));const H=T*X*$/st,it=-T*st*U/X,R=j*H-I*it+.5*f,L=I*H+j*it+.5*d;let ot=ao(1,0,(U-H)/X,($-it)/st),Q=ao((U-H)/X,($-it)/st,(-U-H)/X,(-$-it)/st);_===0&&Q>0?Q-=2*P:_===1&&Q<0&&(Q+=2*P);const G=Math.ceil(Math.abs(Q/P*2)),_t=[],wt=Q/G,mt=8/3*Math.sin(wt/4)*Math.sin(wt/4)/Math.sin(wt/2);let vt=ot+wt;for(let K=0;K<G;K++)_t[K]=yl(ot,vt,j,I,X,st,R,L,mt,C,k),C=_t[K][5],k=_t[K][6],ot=vt,vt+=wt;return _t})(l-h,c-t,s,i,o,a,n);for(let f=0,d=u.length;f<d;f++)u[f][1]+=h,u[f][2]+=t,u[f][3]+=h,u[f][4]+=t,u[f][5]+=h,u[f][6]+=t;return u},xl=h=>{let t=0,e=0,r=0,s=0;const i=[];let n,o=0,a=0;for(const l of h){const c=[...l];let u;switch(c[0]){case"l":c[1]+=t,c[2]+=e;case"L":t=c[1],e=c[2],u=["L",t,e];break;case"h":c[1]+=t;case"H":t=c[1],u=["L",t,e];break;case"v":c[1]+=e;case"V":e=c[1],u=["L",t,e];break;case"m":c[1]+=t,c[2]+=e;case"M":t=c[1],e=c[2],r=c[1],s=c[2],u=["M",t,e];break;case"c":c[1]+=t,c[2]+=e,c[3]+=t,c[4]+=e,c[5]+=t,c[6]+=e;case"C":o=c[3],a=c[4],t=c[5],e=c[6],u=["C",c[1],c[2],o,a,t,e];break;case"s":c[1]+=t,c[2]+=e,c[3]+=t,c[4]+=e;case"S":n==="C"?(o=2*t-o,a=2*e-a):(o=t,a=e),t=c[3],e=c[4],u=["C",o,a,c[1],c[2],t,e],o=u[3],a=u[4];break;case"q":c[1]+=t,c[2]+=e,c[3]+=t,c[4]+=e;case"Q":o=c[1],a=c[2],t=c[3],e=c[4],u=["Q",o,a,t,e];break;case"t":c[1]+=t,c[2]+=e;case"T":n==="Q"?(o=2*t-o,a=2*e-a):(o=t,a=e),t=c[1],e=c[2],u=["Q",o,a,t,e];break;case"a":c[6]+=t,c[7]+=e;case"A":bl(t,e,c).forEach(f=>i.push(f)),t=c[6],e=c[7];break;case"z":case"Z":t=r,e=s,u=["Z"]}u?(i.push(u),n=u[0]):n=""}return i},Js=(h,t,e,r)=>Math.sqrt((e-h)**2+(r-t)**2),ra=(h,t,e,r,s,i,n,o)=>a=>{const l=a**3,c=(d=>3*d**2*(1-d))(a),u=(d=>3*d*(1-d)**2)(a),f=(d=>(1-d)**3)(a);return new z(n*l+s*c+e*u+h*f,o*l+i*c+r*u+t*f)},sa=h=>h**2,ia=h=>2*h*(1-h),na=h=>(1-h)**2,wl=(h,t,e,r,s,i,n,o)=>a=>{const l=sa(a),c=ia(a),u=na(a),f=3*(u*(e-h)+c*(s-e)+l*(n-s)),d=3*(u*(r-t)+c*(i-r)+l*(o-i));return Math.atan2(d,f)},Cl=(h,t,e,r,s,i)=>n=>{const o=sa(n),a=ia(n),l=na(n);return new z(s*o+e*a+h*l,i*o+r*a+t*l)},Sl=(h,t,e,r,s,i)=>n=>{const o=1-n,a=2*(o*(e-h)+n*(s-e)),l=2*(o*(r-t)+n*(i-r));return Math.atan2(l,a)},lo=(h,t,e)=>{let r=new z(t,e),s=0;for(let i=1;i<=100;i+=1){const n=h(i/100);s+=Js(r.x,r.y,n.x,n.y),r=n}return s},Tl=(h,t)=>{let e,r=0,s=0,i={x:h.x,y:h.y},n=D({},i),o=.01,a=0;const l=h.iterator,c=h.angleFinder;for(;s<t&&o>1e-4;)n=l(r),a=r,e=Js(i.x,i.y,n.x,n.y),e+s>t?(r-=o,o/=2):(i=n,r+=o,s+=e);return D(D({},n),{},{angle:c(a)})},oa=h=>{let t,e,r=0,s=0,i=0,n=0,o=0;const a=[];for(const l of h){const c={x:s,y:i,command:l[0],length:0};switch(l[0]){case"M":e=c,e.x=n=s=l[1],e.y=o=i=l[2];break;case"L":e=c,e.length=Js(s,i,l[1],l[2]),s=l[1],i=l[2];break;case"C":t=ra(s,i,l[1],l[2],l[3],l[4],l[5],l[6]),e=c,e.iterator=t,e.angleFinder=wl(s,i,l[1],l[2],l[3],l[4],l[5],l[6]),e.length=lo(t,s,i),s=l[5],i=l[6];break;case"Q":t=Cl(s,i,l[1],l[2],l[3],l[4]),e=c,e.iterator=t,e.angleFinder=Sl(s,i,l[1],l[2],l[3],l[4]),e.length=lo(t,s,i),s=l[3],i=l[4];break;case"Z":e=c,e.destX=n,e.destY=o,e.length=Js(s,i,n,o),s=n,i=o}r+=e.length,a.push(e)}return a.push({length:r,x:s,y:i}),a},kl=function(h,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:oa(h),r=0;for(;t-e[r].length>0&&r<e.length-2;)t-=e[r].length,r++;const s=e[r],i=t/s.length,n=h[r];switch(s.command){case"M":return{x:s.x,y:s.y,angle:0};case"Z":return D(D({},new z(s.x,s.y).lerp(new z(s.destX,s.destY),i)),{},{angle:Math.atan2(s.destY-s.y,s.destX-s.x)});case"L":return D(D({},new z(s.x,s.y).lerp(new z(n[1],n[2]),i)),{},{angle:Math.atan2(n[2]-s.y,n[1]-s.x)});case"C":case"Q":return Tl(s,t)}},Ol=new RegExp("[mzlhvcsqta][^mzlhvcsqta]*","gi"),co=new RegExp(_l,"g"),Dl=new RegExp(lr,"gi"),El={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Al=h=>{var t;const e=[],r=(t=h.match(Ol))!==null&&t!==void 0?t:[];for(const s of r){const i=s[0];if(i==="z"||i==="Z"){e.push([i]);continue}const n=El[i.toLowerCase()];let o=[];if(i==="a"||i==="A"){co.lastIndex=0;for(let a=null;a=co.exec(s);)o.push(...a.slice(1))}else o=s.match(Dl)||[];for(let a=0;a<o.length;a+=n){const l=new Array(n),c=vl[i];l[0]=a>0&&c?c:i;for(let u=0;u<n;u++)l[u+1]=parseFloat(o[a+u]);e.push(l)}}return e},Ml=(h,t)=>h.map(e=>e.map((r,s)=>s===0||t===void 0?r:Pt(r,t)).join(" ")).join(" ");function Ni(h,t){const e=h.style;e&&t&&(typeof t=="string"?e.cssText+=";"+t:Object.entries(t).forEach(r=>{let[s,i]=r;return e.setProperty(s,i)}))}class Pl extends Io{constructor(t){let{allowTouchScrolling:e=!1,containerClass:r=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t),O(this,"upper",void 0),O(this,"container",void 0);const{el:s}=this.lower,i=this.createUpperCanvas();this.upper={el:i,ctx:i.getContext("2d")},this.applyCanvasStyle(s,{allowTouchScrolling:e}),this.applyCanvasStyle(i,{allowTouchScrolling:e,styles:{position:"absolute",left:"0",top:"0"}});const n=this.createContainerElement();n.classList.add(r),s.parentNode&&s.parentNode.replaceChild(n,s),n.append(s,i),this.container=n}createUpperCanvas(){const{el:t}=this.lower,e=zt();return e.className=t.className,e.classList.remove("lower-canvas"),e.classList.add("upper-canvas"),e.setAttribute("data-fabric","top"),e.style.cssText=t.style.cssText,e.setAttribute("draggable","true"),e}createContainerElement(){const t=Mr().createElement("div");return t.setAttribute("data-fabric","wrapper"),Ni(t,{position:"relative"}),Un(t),t}applyCanvasStyle(t,e){const{styles:r,allowTouchScrolling:s}=e;Ni(t,D(D({},r),{},{"touch-action":s?"manipulation":te})),Un(t)}setDimensions(t,e){super.setDimensions(t,e);const{el:r,ctx:s}=this.upper;Lo(r,s,t,e)}setCSSDimensions(t){super.setCSSDimensions(t),Pi(this.upper.el,t),Pi(this.container,t)}cleanupDOM(t){const e=this.container,{el:r}=this.lower,{el:s}=this.upper;super.cleanupDOM(t),e.removeChild(s),e.removeChild(r),e.parentNode&&e.parentNode.replaceChild(r,e)}dispose(){super.dispose(),Te().dispose(this.upper.el),delete this.upper,delete this.container}}class hi extends $r{constructor(){super(...arguments),O(this,"targets",[]),O(this,"_hoveredTargets",[]),O(this,"_objectsToRender",void 0),O(this,"_currentTransform",null),O(this,"_groupSelector",null),O(this,"contextTopDirty",!1)}static getDefaults(){return D(D({},super.getDefaults()),hi.ownDefaults)}get upperCanvasEl(){var t;return(t=this.elements.upper)===null||t===void 0?void 0:t.el}get contextTop(){var t;return(t=this.elements.upper)===null||t===void 0?void 0:t.ctx}get wrapperEl(){return this.elements.container}initElements(t){this.elements=new Pl(t,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(t){this._objectsToRender=void 0,super._onObjectAdded(t)}_onObjectRemoved(t){this._objectsToRender=void 0,t===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[t]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[t]}),t.fire("deselected",{target:t})),t===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(t)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){const t=this._activeObject;return!this.preserveObjectStacking&&t?this._objects.filter(e=>!e.group&&e!==t).concat(t):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(t){t.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(t),this.contextTopDirty=!0),t.restore()}renderTop(){const t=this.contextTop;this.clearContext(t),this.renderTopLayer(t),this.fire("after:render",{ctx:t})}setTargetFindTolerance(t){t=Math.round(t),this.targetFindTolerance=t;const e=this.getRetinaScaling(),r=Math.ceil((2*t+1)*e);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=r,this.pixelFindContext.scale(e,e)}isTargetTransparent(t,e,r){const s=this.targetFindTolerance,i=this.pixelFindContext;this.clearContext(i),i.save(),i.translate(-e+s,-r+s),i.transform(...this.viewportTransform);const n=t.selectionBackgroundColor;t.selectionBackgroundColor="",t.render(i),t.selectionBackgroundColor=n,i.restore();const o=Math.round(s*this.getRetinaScaling());return Rh(i,o,o,o)}_isSelectionKeyPressed(t){const e=this.selectionKey;return!!e&&(Array.isArray(e)?!!e.find(r=>!!r&&t[r]===!0):t[e])}_shouldClearSelection(t,e){const r=this.getActiveObjects(),s=this._activeObject;return!!(!e||e&&s&&r.length>1&&r.indexOf(e)===-1&&s!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&s&&s!==e)}_shouldCenterTransform(t,e,r){if(!t)return;let s;return e===ei||e===re||e===ue||e===Vr?s=this.centeredScaling||t.centeredScaling:e===Gi&&(s=this.centeredRotation||t.centeredRotation),s?!r:r}_getOriginFromCorner(t,e){const r={x:t.originX,y:t.originY};return e&&(["ml","tl","bl"].includes(e)?r.x=Ft:["mr","tr","br"].includes(e)&&(r.x=kt),["tl","mt","tr"].includes(e)?r.y=Mi:["bl","mb","br"].includes(e)&&(r.y=$t)),r}_setupCurrentTransform(t,e,r){var s;const i=e.group?Dr(this.getScenePoint(t),void 0,e.group.calcTransformMatrix()):this.getScenePoint(t),{key:n="",control:o}=e.getActiveControl()||{},a=r&&o?(s=o.getActionHandler(t,e,o))===null||s===void 0?void 0:s.bind(o):rh,l=((d,m,p,v)=>{if(!m||!d)return"drag";const _=v.controls[m];return _.getActionName(p,_,v)})(r,n,t,e),c=t[this.centeredKey],u=this._shouldCenterTransform(e,l,c)?{x:yt,y:yt}:this._getOriginFromCorner(e,n),f={target:e,action:l,actionHandler:a,actionPerformed:!1,corner:n,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:i.x-e.left,offsetY:i.y-e.top,originX:u.x,originY:u.y,ex:i.x,ey:i.y,lastX:i.x,lastY:i.y,theta:Lt(e.angle),width:e.width,height:e.height,shiftKey:t.shiftKey,altKey:c,original:D(D({},Ro(e)),{},{originX:u.x,originY:u.y})};this._currentTransform=f,this.fire("before:transform",{e:t,transform:f})}setCursor(t){this.upperCanvasEl.style.cursor=t}_drawSelection(t){const{x:e,y:r,deltaX:s,deltaY:i}=this._groupSelector,n=new z(e,r).transform(this.viewportTransform),o=new z(e+s,r+i).transform(this.viewportTransform),a=this.selectionLineWidth/2;let l=Math.min(n.x,o.x),c=Math.min(n.y,o.y),u=Math.max(n.x,o.x),f=Math.max(n.y,o.y);this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(l,c,u-l,f-c)),this.selectionLineWidth&&this.selectionBorderColor&&(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,l+=a,c+=a,u-=a,f-=a,Gt.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(l,c,u-l,f-c))}findTarget(t){if(this.skipTargetFind)return;const e=this.getViewportPoint(t),r=this._activeObject,s=this.getActiveObjects();if(this.targets=[],r&&s.length>=1){if(r.findControl(e,ji(t))||s.length>1&&this.searchPossibleTargets([r],e))return r;if(r===this.searchPossibleTargets([r],e)){if(this.preserveObjectStacking){const i=this.targets;this.targets=[];const n=this.searchPossibleTargets(this._objects,e);return t[this.altSelectionKey]&&n&&n!==r?(this.targets=i,r):n}return r}}return this.searchPossibleTargets(this._objects,e)}_pointIsInObjectSelectionArea(t,e){let r=t.getCoords();const s=this.getZoom(),i=t.padding/s;if(i){const[n,o,a,l]=r,c=Math.atan2(o.y-n.y,o.x-n.x),u=je(c)*i,f=Fe(c)*i,d=u+f,m=u-f;r=[new z(n.x-m,n.y-d),new z(o.x+d,o.y-m),new z(a.x+m,a.y+d),new z(l.x-d,l.y+m)]}return Mt.isPointInPolygon(e,r)}_checkTarget(t,e){return!!(t&&t.visible&&t.evented&&this._pointIsInObjectSelectionArea(t,Dr(e,void 0,this.viewportTransform))&&(!this.perPixelTargetFind&&!t.perPixelTargetFind||t.isEditing||!this.isTargetTransparent(t,e.x,e.y)))}_searchPossibleTargets(t,e){let r=t.length;for(;r--;){const s=t[r];if(this._checkTarget(s,e)){if(Ls(s)&&s.subTargetCheck){const i=this._searchPossibleTargets(s._objects,e);i&&this.targets.push(i)}return s}}}searchPossibleTargets(t,e){const r=this._searchPossibleTargets(t,e);if(r&&Ls(r)&&r.interactive&&this.targets[0]){const s=this.targets;for(let i=s.length-1;i>0;i--){const n=s[i];if(!Ls(n)||!n.interactive)return n}return s[0]}return r}getViewportPoint(t){return this._pointer?this._pointer:this.getPointer(t,!0)}getScenePoint(t){return this._absolutePointer?this._absolutePointer:this.getPointer(t)}getPointer(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=this.upperCanvasEl,s=r.getBoundingClientRect();let i=Za(t),n=s.width||0,o=s.height||0;n&&o||($t in s&&Mi in s&&(o=Math.abs(s.top-s.bottom)),Ft in s&&kt in s&&(n=Math.abs(s.right-s.left))),this.calcOffset(),i.x=i.x-this._offset.left,i.y=i.y-this._offset.top,e||(i=Dr(i,void 0,this.viewportTransform));const a=this.getRetinaScaling();a!==1&&(i.x/=a,i.y/=a);const l=n===0||o===0?new z(1,1):new z(r.width/n,r.height/o);return i.multiply(l)}_setDimensionsImpl(t,e){this._resetTransformEventData(),super._setDimensionsImpl(t,e),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=zt(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){const t=this._activeObject;return er(t)?t.getObjects():t?[t]:[]}_fireSelectionEvents(t,e){let r=!1,s=!1;const i=this.getActiveObjects(),n=[],o=[];t.forEach(a=>{i.includes(a)||(r=!0,a.fire("deselected",{e,target:a}),o.push(a))}),i.forEach(a=>{t.includes(a)||(r=!0,a.fire("selected",{e,target:a}),n.push(a))}),t.length>0&&i.length>0?(s=!0,r&&this.fire("selection:updated",{e,selected:n,deselected:o})):i.length>0?(s=!0,this.fire("selection:created",{e,selected:n})):t.length>0&&(s=!0,this.fire("selection:cleared",{e,deselected:o})),s&&(this._objectsToRender=void 0)}setActiveObject(t,e){const r=this.getActiveObjects(),s=this._setActiveObject(t,e);return this._fireSelectionEvents(r,e),s}_setActiveObject(t,e){const r=this._activeObject;return r!==t&&!(!this._discardActiveObject(e,t)&&this._activeObject)&&!t.onSelect({e})&&(this._activeObject=t,er(t)&&r!==t&&t.set("canvas",this),t.setCoords(),!0)}_discardActiveObject(t,e){const r=this._activeObject;return!!r&&!r.onDeselect({e:t,object:e})&&(this._currentTransform&&this._currentTransform.target===r&&this.endCurrentTransform(t),er(r)&&r===this._hoveredTarget&&(this._hoveredTarget=void 0),this._activeObject=void 0,!0)}discardActiveObject(t){const e=this.getActiveObjects(),r=this.getActiveObject();e.length&&this.fire("before:selection:cleared",{e:t,deselected:[r]});const s=this._discardActiveObject(t);return this._fireSelectionEvents(e,t),s}endCurrentTransform(t){const e=this._currentTransform;this._finalizeCurrentTransform(t),e&&e.target&&(e.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(t){const e=this._currentTransform,r=e.target,s={e:t,target:r,transform:e,action:e.action};r._scaling&&(r._scaling=!1),r.setCoords(),e.actionPerformed&&(this.fire("object:modified",s),r.fire(Xs,s))}setViewportTransform(t){super.setViewportTransform(t);const e=this._activeObject;e&&e.setCoords()}destroy(){const t=this._activeObject;er(t)&&(t.removeAll(),t.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(t){const e=this._activeObject;e&&e._renderControls(t)}_toObject(t,e,r){const s=this._realizeGroupTransformOnObject(t),i=super._toObject(t,e,r);return t.set(s),i}_realizeGroupTransformOnObject(t){const{group:e}=t;if(e&&er(e)&&this._activeObject===e){const r=Fr(t,["angle","flipX","flipY",kt,re,ue,Pr,jr,$t]);return Ja(t,e.calcOwnMatrix()),r}return{}}_setSVGObject(t,e,r){const s=this._realizeGroupTransformOnObject(e);super._setSVGObject(t,e,r),e.set(s)}}O(hi,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});class jl{constructor(t){O(this,"targets",[]),O(this,"__disposer",void 0);const e=()=>{const{hiddenTextarea:s}=t.getActiveObject()||{};s&&s.focus()},r=t.upperCanvasEl;r.addEventListener("click",e),this.__disposer=()=>r.removeEventListener("click",e)}exitTextEditing(){this.target=void 0,this.targets.forEach(t=>{t.isEditing&&t.exitEditing()})}add(t){this.targets.push(t)}remove(t){this.unregister(t),Cr(this.targets,t)}register(t){this.target=t}unregister(t){t===this.target&&(this.target=void 0)}onMouseMove(t){var e;!((e=this.target)===null||e===void 0)&&e.isEditing&&this.target.updateSelectionOnMouseMove(t)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}const Fl=["target","oldTarget","fireCanvas","e"],ie={passive:!1},wr=(h,t)=>{const e=h.getViewportPoint(t),r=h.getScenePoint(t);return{viewportPoint:e,scenePoint:r,pointer:e,absolutePointer:r}},Xe=function(h){for(var t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];return h.addEventListener(...e)},le=function(h){for(var t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];return h.removeEventListener(...e)},Ll={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class Qs extends hi{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}),O(this,"_isClick",void 0),O(this,"textEditingManager",new jl(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onDoubleClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach(e=>{this[e]=this[e].bind(this)}),this.addOrRemove(Xe,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(t,e){const r=this.upperCanvasEl,s=this._getEventPrefix();t(Fo(r),"resize",this._onResize),t(r,s+"down",this._onMouseDown),t(r,"".concat(s,"move"),this._onMouseMove,ie),t(r,"".concat(s,"out"),this._onMouseOut),t(r,"".concat(s,"enter"),this._onMouseEnter),t(r,"wheel",this._onMouseWheel),t(r,"contextmenu",this._onContextMenu),t(r,"dblclick",this._onDoubleClick),t(r,"dragstart",this._onDragStart),t(r,"dragend",this._onDragEnd),t(r,"dragover",this._onDragOver),t(r,"dragenter",this._onDragEnter),t(r,"dragleave",this._onDragLeave),t(r,"drop",this._onDrop),this.enablePointerEvents||t(r,"touchstart",this._onTouchStart,ie)}removeListeners(){this.addOrRemove(le,"remove");const t=this._getEventPrefix(),e=ve(this.upperCanvasEl);le(e,"".concat(t,"up"),this._onMouseUp),le(e,"touchend",this._onTouchEnd,ie),le(e,"".concat(t,"move"),this._onMouseMove,ie),le(e,"touchmove",this._onMouseMove,ie)}_onMouseWheel(t){this.__onMouseWheel(t)}_onMouseOut(t){const e=this._hoveredTarget,r=D({e:t},wr(this,t));this.fire("mouse:out",D(D({},r),{},{target:e})),this._hoveredTarget=void 0,e&&e.fire("mouseout",D({},r)),this._hoveredTargets.forEach(s=>{this.fire("mouse:out",D(D({},r),{},{target:s})),s&&s.fire("mouseout",D({},r))}),this._hoveredTargets=[]}_onMouseEnter(t){this._currentTransform||this.findTarget(t)||(this.fire("mouse:over",D({e:t},wr(this,t))),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(t){this._isClick=!1;const e=this.getActiveObject();if(e&&e.onDragStart(t)){this._dragSource=e;const r={e:t,target:e};return this.fire("dragstart",r),e.fire("dragstart",r),void Xe(this.upperCanvasEl,"drag",this._onDragProgress)}Fi(t)}_renderDragEffects(t,e,r){let s=!1;const i=this._dropTarget;i&&i!==e&&i!==r&&(i.clearContextTop(),s=!0),e==null||e.clearContextTop(),r!==e&&(r==null||r.clearContextTop());const n=this.contextTop;n.save(),n.transform(...this.viewportTransform),e&&(n.save(),e.transform(n),e.renderDragSourceEffect(t),n.restore(),s=!0),r&&(n.save(),r.transform(n),r.renderDropTargetEffect(t),n.restore(),s=!0),n.restore(),s&&(this.contextTopDirty=!0)}_onDragEnd(t){const e=!!t.dataTransfer&&t.dataTransfer.dropEffect!==te,r=e?this._activeObject:void 0,s={e:t,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:e,dropTarget:r};le(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",s),this._dragSource&&this._dragSource.fire("dragend",s),delete this._dragSource,this._onMouseUp(t)}_onDragProgress(t){const e={e:t,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",e),this._dragSource&&this._dragSource.fire("drag",e)}findDragTargets(t){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(t)),targets:[...this.targets]}}_onDragOver(t){const e="dragover",{target:r,targets:s}=this.findDragTargets(t),i=this._dragSource,n={e:t,target:r,subTargets:s,dragSource:i,canDrop:!1,dropTarget:void 0};let o;this.fire(e,n),this._fireEnterLeaveEvents(r,n),r&&(r.canDrop(t)&&(o=r),r.fire(e,n));for(let a=0;a<s.length;a++){const l=s[a];l.canDrop(t)&&(o=l),l.fire(e,n)}this._renderDragEffects(t,i,o),this._dropTarget=o}_onDragEnter(t){const{target:e,targets:r}=this.findDragTargets(t),s={e:t,target:e,subTargets:r,dragSource:this._dragSource};this.fire("dragenter",s),this._fireEnterLeaveEvents(e,s)}_onDragLeave(t){const e={e:t,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",e),this._fireEnterLeaveEvents(void 0,e),this._renderDragEffects(t,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(t){const{target:e,targets:r}=this.findDragTargets(t),s=this._basicEventHandler("drop:before",D({e:t,target:e,subTargets:r,dragSource:this._dragSource},wr(this,t)));s.didDrop=!1,s.dropTarget=void 0,this._basicEventHandler("drop",s),this.fire("drop:after",s)}_onContextMenu(t){const e=this.findTarget(t),r=this.targets||[],s=this._basicEventHandler("contextmenu:before",{e:t,target:e,subTargets:r});return this.stopContextMenu&&Fi(t),this._basicEventHandler("contextmenu",s),!1}_onDoubleClick(t){this._cacheTransformEventData(t),this._handleEvent(t,"dblclick"),this._resetTransformEventData()}getPointerId(t){const e=t.changedTouches;return e?e[0]&&e[0].identifier:this.enablePointerEvents?t.pointerId:-1}_isMainEvent(t){return t.isPrimary===!0||t.isPrimary!==!1&&(t.type==="touchend"&&t.touches.length===0||!t.changedTouches||t.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(t){t.preventDefault(),this.mainTouchId===void 0&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();const e=this.upperCanvasEl,r=this._getEventPrefix(),s=ve(e);Xe(s,"touchend",this._onTouchEnd,ie),Xe(s,"touchmove",this._onMouseMove,ie),le(e,"".concat(r,"down"),this._onMouseDown)}_onMouseDown(t){this.__onMouseDown(t),this._resetTransformEventData();const e=this.upperCanvasEl,r=this._getEventPrefix();le(e,"".concat(r,"move"),this._onMouseMove,ie);const s=ve(e);Xe(s,"".concat(r,"up"),this._onMouseUp),Xe(s,"".concat(r,"move"),this._onMouseMove,ie)}_onTouchEnd(t){if(t.touches.length>0)return;this.__onMouseUp(t),this._resetTransformEventData(),delete this.mainTouchId;const e=this._getEventPrefix(),r=ve(this.upperCanvasEl);le(r,"touchend",this._onTouchEnd,ie),le(r,"touchmove",this._onMouseMove,ie),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(()=>{Xe(this.upperCanvasEl,"".concat(e,"down"),this._onMouseDown),this._willAddMouseDown=0},400)}_onMouseUp(t){this.__onMouseUp(t),this._resetTransformEventData();const e=this.upperCanvasEl,r=this._getEventPrefix();if(this._isMainEvent(t)){const s=ve(this.upperCanvasEl);le(s,"".concat(r,"up"),this._onMouseUp),le(s,"".concat(r,"move"),this._onMouseMove,ie),Xe(e,"".concat(r,"move"),this._onMouseMove,ie)}}_onMouseMove(t){const e=this.getActiveObject();!this.allowTouchScrolling&&(!e||!e.shouldStartDragging(t))&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(t){const e=this.getActiveObject();return!!e!=!!t||e&&t&&e!==t}__onMouseUp(t){var e;this._cacheTransformEventData(t),this._handleEvent(t,"up:before");const r=this._currentTransform,s=this._isClick,i=this._target,{button:n}=t;if(n)return(this.fireMiddleClick&&n===1||this.fireRightClick&&n===2)&&this._handleEvent(t,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(t);if(!this._isMainEvent(t))return;let o,a,l=!1;if(r&&(this._finalizeCurrentTransform(t),l=r.actionPerformed),!s){const c=i===this._activeObject;this.handleSelection(t),l||(l=this._shouldRender(i)||!c&&i===this._activeObject)}if(i){const c=i.findControl(this.getViewportPoint(t),ji(t)),{key:u,control:f}=c||{};if(a=u,i.selectable&&i!==this._activeObject&&i.activeOn==="up")this.setActiveObject(i,t),l=!0;else if(f){const d=f.getMouseUpHandler(t,i,f);d&&(o=this.getScenePoint(t),d.call(f,t,r,o.x,o.y))}i.isMoving=!1}if(r&&(r.target!==i||r.corner!==a)){const c=r.target&&r.target.controls[r.corner],u=c&&c.getMouseUpHandler(t,r.target,c);o=o||this.getScenePoint(t),u&&u.call(c,t,r,o.x,o.y)}this._setCursorFromEvent(t,i),this._handleEvent(t,"up"),this._groupSelector=null,this._currentTransform=null,i&&(i.__corner=void 0),l?this.requestRenderAll():s||(e=this._activeObject)!==null&&e!==void 0&&e.isEditing||this.renderTop()}_basicEventHandler(t,e){const{target:r,subTargets:s=[]}=e;this.fire(t,e),r&&r.fire(t,e);for(let i=0;i<s.length;i++)s[i]!==r&&s[i].fire(t,e);return e}_handleEvent(t,e){const r=this._target,s=this.targets||[],i=D(D({e:t,target:r,subTargets:s},wr(this,t)),{},{transform:this._currentTransform},e==="up:before"||e==="up"?{isClick:this._isClick,currentTarget:this.findTarget(t),currentSubTargets:this.targets}:{});this.fire("mouse:".concat(e),i),r&&r.fire("mouse".concat(e),i);for(let n=0;n<s.length;n++)s[n]!==r&&s[n].fire("mouse".concat(e),i)}_onMouseDownInDrawingMode(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(t),this.requestRenderAll());const e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(e,{e:t,pointer:e}),this._handleEvent(t,"down")}_onMouseMoveInDrawingMode(t){if(this._isCurrentlyDrawing){const e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(e,{e:t,pointer:e})}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")}_onMouseUpInDrawingMode(t){const e=this.getScenePoint(t);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:t,pointer:e}):this._isCurrentlyDrawing=!1,this._handleEvent(t,"up")}__onMouseDown(t){this._isClick=!0,this._cacheTransformEventData(t),this._handleEvent(t,"down:before");let e=this._target;const{button:r}=t;if(r)return(this.fireMiddleClick&&r===1||this.fireRightClick&&r===2)&&this._handleEvent(t,"down"),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(t);if(!this._isMainEvent(t)||this._currentTransform)return;let s=this._shouldRender(e),i=!1;if(this.handleMultiSelection(t,e)?(e=this._activeObject,i=!0,s=!0):this._shouldClearSelection(t,e)&&this.discardActiveObject(t),this.selection&&(!e||!e.selectable&&!e.isEditing&&e!==this._activeObject)){const n=this.getScenePoint(t);this._groupSelector={x:n.x,y:n.y,deltaY:0,deltaX:0}}if(e){const n=e===this._activeObject;e.selectable&&e.activeOn==="down"&&this.setActiveObject(e,t);const o=e.findControl(this.getViewportPoint(t),ji(t));if(e===this._activeObject&&(o||!i)){this._setupCurrentTransform(t,e,n);const a=o?o.control:void 0,l=this.getScenePoint(t),c=a&&a.getMouseDownHandler(t,e,a);c&&c.call(a,t,this._currentTransform,l.x,l.y)}}s&&(this._objectsToRender=void 0),this._handleEvent(t,"down"),s&&this.requestRenderAll()}_resetTransformEventData(){this._target=void 0,this._pointer=void 0,this._absolutePointer=void 0}_cacheTransformEventData(t){this._resetTransformEventData(),this._pointer=this.getViewportPoint(t),this._absolutePointer=Dr(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)}__onMouseMove(t){if(this._isClick=!1,this._cacheTransformEventData(t),this._handleEvent(t,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(t);if(!this._isMainEvent(t))return;const e=this._groupSelector;if(e){const r=this.getScenePoint(t);e.deltaX=r.x-e.x,e.deltaY=r.y-e.y,this.renderTop()}else if(this._currentTransform)this._transformObject(t);else{const r=this.findTarget(t);this._setCursorFromEvent(t,r),this._fireOverOutEvents(t,r)}this.textEditingManager.onMouseMove(t),this._handleEvent(t,"move"),this._resetTransformEventData()}_fireOverOutEvents(t,e){const r=this._hoveredTarget,s=this._hoveredTargets,i=this.targets,n=Math.max(s.length,i.length);this.fireSyntheticInOutEvents("mouse",{e:t,target:e,oldTarget:r,fireCanvas:!0});for(let o=0;o<n;o++)this.fireSyntheticInOutEvents("mouse",{e:t,target:i[o],oldTarget:s[o]});this._hoveredTarget=e,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(t,e){const r=this._draggedoverTarget,s=this._hoveredTargets,i=this.targets,n=Math.max(s.length,i.length);this.fireSyntheticInOutEvents("drag",D(D({},e),{},{target:t,oldTarget:r,fireCanvas:!0}));for(let o=0;o<n;o++)this.fireSyntheticInOutEvents("drag",D(D({},e),{},{target:i[o],oldTarget:s[o]}));this._draggedoverTarget=t}fireSyntheticInOutEvents(t,e){let{target:r,oldTarget:s,fireCanvas:i,e:n}=e,o=At(e,Fl);const{targetIn:a,targetOut:l,canvasIn:c,canvasOut:u}=Ll[t],f=s!==r;if(s&&f){const d=D(D({},o),{},{e:n,target:s,nextTarget:r},wr(this,n));i&&this.fire(u,d),s.fire(l,d)}if(r&&f){const d=D(D({},o),{},{e:n,target:r,previousTarget:s},wr(this,n));i&&this.fire(c,d),r.fire(a,d)}}__onMouseWheel(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()}_transformObject(t){const e=this.getScenePoint(t),r=this._currentTransform,s=r.target,i=s.group?Dr(e,void 0,s.group.calcTransformMatrix()):e;r.shiftKey=t.shiftKey,r.altKey=!!this.centeredKey&&t[this.centeredKey],this._performTransformAction(t,r,i),r.actionPerformed&&this.requestRenderAll()}_performTransformAction(t,e,r){const{action:s,actionHandler:i,target:n}=e,o=!!i&&i(t,e,r.x,r.y);o&&n.setCoords(),s==="drag"&&o&&(e.target.isMoving=!0,this.setCursor(e.target.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||o}_setCursorFromEvent(t,e){if(!e)return void this.setCursor(this.defaultCursor);let r=e.hoverCursor||this.hoverCursor;const s=er(this._activeObject)?this._activeObject:null,i=(!s||e.group!==s)&&e.findControl(this.getViewportPoint(t));if(i){const n=i.control;this.setCursor(n.cursorStyleHandler(t,n,e))}else e.subTargetCheck&&this.targets.concat().reverse().map(n=>{r=n.hoverCursor||r}),this.setCursor(r)}handleMultiSelection(t,e){const r=this._activeObject,s=er(r);if(r&&this._isSelectionKeyPressed(t)&&this.selection&&e&&e.selectable&&(r!==e||s)&&(s||!e.isDescendantOf(r)&&!r.isDescendantOf(e))&&!e.onSelect({e:t})&&!r.getActiveControl()){if(s){const i=r.getObjects();if(e===r){const n=this.getViewportPoint(t);if(!(e=this.searchPossibleTargets(i,n)||this.searchPossibleTargets(this._objects,n))||!e.selectable)return!1}e.group===r?(r.remove(e),this._hoveredTarget=e,this._hoveredTargets=[...this.targets],r.size()===1&&this._setActiveObject(r.item(0),t)):(r.multiSelectAdd(e),this._hoveredTarget=r,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(i,t)}else{r.exitEditing&&r.exitEditing();const i=new(rt.getClass("ActiveSelection"))([],{canvas:this});i.multiSelectAdd(r,e),this._hoveredTarget=i,this._setActiveObject(i,t),this._fireSelectionEvents([r],t)}return!0}return!1}handleSelection(t){if(!this.selection||!this._groupSelector)return!1;const{x:e,y:r,deltaX:s,deltaY:i}=this._groupSelector,n=new z(e,r),o=n.add(new z(s,i)),a=n.min(o),l=n.max(o).subtract(a),c=this.collectObjects({left:a.x,top:a.y,width:l.x,height:l.y},{includeIntersecting:!this.selectionFullyContained}),u=n.eq(o)?c[0]?[c[0]]:[]:c.length>1?c.filter(f=>!f.onSelect({e:t})).reverse():c;if(u.length===1)this.setActiveObject(u[0],t);else if(u.length>1){const f=rt.getClass("ActiveSelection");this.setActiveObject(new f(u,{canvas:this}),t)}return this._groupSelector=null,!0}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}const aa={x1:0,y1:0,x2:0,y2:0},Il=D(D({},aa),{},{r1:0,r2:0}),Tr=(h,t)=>isNaN(h)&&typeof t=="number"?t:h,Rl=/^(\d+\.\d+)%|(\d+)%$/;function ha(h){return h&&Rl.test(h)}function la(h,t){const e=typeof h=="number"?h:typeof h=="string"?parseFloat(h)/(ha(h)?100:1):NaN;return Ar(0,Tr(e,t),1)}const Bl=/\s*;\s*/,zl=/\s*:\s*/;function Wl(h,t){let e,r;const s=h.getAttribute("style");if(s){const n=s.split(Bl);n[n.length-1]===""&&n.pop();for(let o=n.length;o--;){const[a,l]=n[o].split(zl).map(c=>c.trim());a==="stop-color"?e=l:a==="stop-opacity"&&(r=l)}}const i=new Ot(e||h.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:la(h.getAttribute("offset"),0),color:i.toRgb(),opacity:Tr(parseFloat(r||h.getAttribute("stop-opacity")||""),1)*i.getAlpha()*t}}function Nl(h,t){const e=[],r=h.getElementsByTagName("stop"),s=la(t,1);for(let i=r.length;i--;)e.push(Wl(r[i],s));return e}function ca(h){return h.nodeName==="linearGradient"||h.nodeName==="LINEARGRADIENT"?"linear":"radial"}function ua(h){return h.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage"}function ge(h,t){return h.getAttribute(t)}function Ul(h,t){return function(e,r){let s,{width:i,height:n,gradientUnits:o}=r;return Object.keys(e).reduce((a,l)=>{const c=e[l];return c==="Infinity"?s=1:c==="-Infinity"?s=0:(s=typeof c=="string"?parseFloat(c):c,typeof c=="string"&&ha(c)&&(s*=.01,o==="pixels"&&(l!=="x1"&&l!=="x2"&&l!=="r2"||(s*=i),l!=="y1"&&l!=="y2"||(s*=n)))),a[l]=s,a},{})}(ca(h)==="linear"?function(e){return{x1:ge(e,"x1")||0,y1:ge(e,"y1")||0,x2:ge(e,"x2")||"100%",y2:ge(e,"y2")||0}}(h):function(e){return{x1:ge(e,"fx")||ge(e,"cx")||"50%",y1:ge(e,"fy")||ge(e,"cy")||"50%",r1:0,x2:ge(e,"cx")||"50%",y2:ge(e,"cy")||"50%",r2:ge(e,"r")||"50%"}}(h),D(D({},t),{},{gradientUnits:ua(h)}))}class cs{constructor(t){const{type:e="linear",gradientUnits:r="pixels",coords:s={},colorStops:i=[],offsetX:n=0,offsetY:o=0,gradientTransform:a,id:l}=t||{};Object.assign(this,{type:e,gradientUnits:r,coords:D(D({},e==="radial"?Il:aa),s),colorStops:i,offsetX:n,offsetY:o,gradientTransform:a,id:l?"".concat(l,"_").concat(Ve()):Ve()})}addColorStop(t){for(const e in t){const r=new Ot(t[e]);this.colorStops.push({offset:parseFloat(e),color:r.toRgb(),opacity:r.getAlpha()})}return this}toObject(t){return D(D({},Fr(this,t)),{},{type:this.type,coords:D({},this.coords),colorStops:this.colorStops.map(e=>D({},e)),offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0})}toSVG(t){let{additionalTransform:e}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=[],s=this.gradientTransform?this.gradientTransform.concat():Kt.concat(),i=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox",n=this.colorStops.map(u=>D({},u)).sort((u,f)=>u.offset-f.offset);let o=-this.offsetX,a=-this.offsetY;var l;i==="objectBoundingBox"?(o/=t.width,a/=t.height):(o+=t.width/2,a+=t.height/2),(l=t)&&typeof l._renderPathCommands=="function"&&this.gradientUnits!=="percentage"&&(o-=t.pathOffset.x,a-=t.pathOffset.y),s[4]-=o,s[5]-=a;const c=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(i,'"'),'gradientTransform="'.concat(e?e+" ":"").concat(Hs(s),'"'),""].join(" ");if(this.type==="linear"){const{x1:u,y1:f,x2:d,y2:m}=this.coords;r.push("<linearGradient ",c,' x1="',u,'" y1="',f,'" x2="',d,'" y2="',m,`">
`)}else if(this.type==="radial"){const{x1:u,y1:f,x2:d,y2:m,r1:p,r2:v}=this.coords,_=p>v;r.push("<radialGradient ",c,' cx="',_?u:d,'" cy="',_?f:m,'" r="',_?p:v,'" fx="',_?d:u,'" fy="',_?m:f,`">
`),_&&(n.reverse(),n.forEach(C=>{C.offset=1-C.offset}));const b=Math.min(p,v);if(b>0){const C=b/Math.max(p,v);n.forEach(k=>{k.offset+=C*(1-k.offset)})}}return n.forEach(u=>{let{color:f,offset:d,opacity:m}=u;r.push("<stop ",'offset="',100*d+"%",'" style="stop-color:',f,m!==void 0?";stop-opacity: "+m:";",`"/>
`)}),r.push(this.type==="linear"?"</linearGradient>":"</radialGradient>",`
`),r.join("")}toLive(t){const{x1:e,y1:r,x2:s,y2:i,r1:n,r2:o}=this.coords,a=this.type==="linear"?t.createLinearGradient(e,r,s,i):t.createRadialGradient(e,r,n,s,i,o);return this.colorStops.forEach(l=>{let{color:c,opacity:u,offset:f}=l;a.addColorStop(f,u!==void 0?new Ot(c).setAlpha(u).toRgba():c)}),a}static async fromObject(t){const{colorStops:e,gradientTransform:r}=t;return new this(D(D({},t),{},{colorStops:e?e.map(s=>D({},s)):void 0,gradientTransform:r?[...r]:void 0}))}static fromElement(t,e,r){const s=ua(t),i=e._findCenterFromElement();return new this(D({id:t.getAttribute("id")||void 0,type:ca(t),coords:Ul(t,{width:r.viewBoxWidth||r.width,height:r.viewBoxHeight||r.height}),colorStops:Nl(t,r.opacity),gradientUnits:s,gradientTransform:Bi(t.getAttribute("gradientTransform")||"")},s==="pixels"?{offsetX:e.width/2-i.x,offsetY:e.height/2-i.y}:{offsetX:0,offsetY:0}))}}O(cs,"type","Gradient"),rt.setClass(cs,"gradient"),rt.setClass(cs,"linear"),rt.setClass(cs,"radial");const Xl=["type","source","patternTransform"];class wi{get type(){return"pattern"}set type(t){Ye("warn","Setting type has no effect",t)}constructor(t){O(this,"repeat","repeat"),O(this,"offsetX",0),O(this,"offsetY",0),O(this,"crossOrigin",""),this.id=Ve(),Object.assign(this,t)}isImageSource(){return!!this.source&&typeof this.source.src=="string"}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(t){return this.source&&(!this.isImageSource()||this.source.complete&&this.source.naturalWidth!==0&&this.source.naturalHeight!==0)?t.createPattern(this.source,this.repeat):null}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const{repeat:e,crossOrigin:r}=this;return D(D({},Fr(this,t)),{},{type:"pattern",source:this.sourceToString(),repeat:e,crossOrigin:r,offsetX:Pt(this.offsetX,xt.NUM_FRACTION_DIGITS),offsetY:Pt(this.offsetY,xt.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(t){let{width:e,height:r}=t;const{source:s,repeat:i,id:n}=this,o=Tr(this.offsetX/e,0),a=Tr(this.offsetY/r,0),l=i==="repeat-y"||i==="no-repeat"?1+Math.abs(o||0):Tr(s.width/e,0),c=i==="repeat-x"||i==="no-repeat"?1+Math.abs(a||0):Tr(s.height/r,0);return['<pattern id="SVGID_'.concat(n,'" x="').concat(o,'" y="').concat(a,'" width="').concat(l,'" height="').concat(c,'">'),'<image x="0" y="0" width="'.concat(s.width,'" height="').concat(s.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join(`
`)}static async fromObject(t,e){let{type:r,source:s,patternTransform:i}=t,n=At(t,Xl);const o=await Rs(s,D(D({},e),{},{crossOrigin:n.crossOrigin}));return new this(D(D({},n),{},{patternTransform:i&&i.slice(0),source:o}))}}O(wi,"type","Pattern"),rt.setClass(wi),rt.setClass(wi,"pattern");const Yl=["path","left","top"],Vl=["d"];class rr extends Gt{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{path:r,left:s,top:i}=e,n=At(e,Yl);super(),Object.assign(this,rr.ownDefaults),this.setOptions(n),this._setPath(t||[],!0),typeof s=="number"&&this.set(kt,s),typeof i=="number"&&this.set($t,i)}_setPath(t,e){this.path=xl(Array.isArray(t)?t:Al(t)),this.setBoundingBox(e)}_findCenterFromElement(){const t=this._calcBoundsFromPath();return new z(t.left+t.width/2,t.top+t.height/2)}_renderPathCommands(t){const e=-this.pathOffset.x,r=-this.pathOffset.y;t.beginPath();for(const s of this.path)switch(s[0]){case"L":t.lineTo(s[1]+e,s[2]+r);break;case"M":t.moveTo(s[1]+e,s[2]+r);break;case"C":t.bezierCurveTo(s[1]+e,s[2]+r,s[3]+e,s[4]+r,s[5]+e,s[6]+r);break;case"Q":t.quadraticCurveTo(s[1]+e,s[2]+r,s[3]+e,s[4]+r);break;case"Z":t.closePath()}}_render(t){this._renderPathCommands(t),this._renderPaintInOrder(t)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return D(D({},super.toObject(t)),{},{path:this.path.map(e=>e.slice())})}toDatalessObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=this.toObject(t);return this.sourcePath&&(delete e.path,e.sourcePath=this.sourcePath),e}_toSVG(){const t=Ml(this.path,xt.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(t,`" stroke-linecap="round" />
`)]}_getOffsetTransform(){const t=xt.NUM_FRACTION_DIGITS;return" translate(".concat(Pt(-this.pathOffset.x,t),", ").concat(Pt(-this.pathOffset.y,t),")")}toClipPathSVG(t){const e=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}toSVG(t){const e=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(t){const{width:e,height:r,pathOffset:s}=this._calcDimensions();this.set({width:e,height:r,pathOffset:s}),t&&this.setPositionByOrigin(s,yt,yt)}_calcBoundsFromPath(){const t=[];let e=0,r=0,s=0,i=0;for(const n of this.path)switch(n[0]){case"L":s=n[1],i=n[2],t.push({x:e,y:r},{x:s,y:i});break;case"M":s=n[1],i=n[2],e=s,r=i;break;case"C":t.push(...ho(s,i,n[1],n[2],n[3],n[4],n[5],n[6])),s=n[5],i=n[6];break;case"Q":t.push(...ho(s,i,n[1],n[2],n[1],n[2],n[3],n[4])),s=n[3],i=n[4];break;case"Z":s=e,i=r}return Me(t)}_calcDimensions(){const t=this._calcBoundsFromPath();return D(D({},t),{},{pathOffset:new z(t.left+t.width/2,t.top+t.height/2)})}static fromObject(t){return this._fromObject(t,{extraParam:"path"})}static async fromElement(t,e,r){const s=Ie(t,this.ATTRIBUTE_NAMES,r),{d:i}=s;return new this(i,D(D(D({},At(s,Vl)),e),{},{left:void 0,top:void 0}))}}O(rr,"type","Path"),O(rr,"cacheProperties",[...Le,"path","fillRule"]),O(rr,"ATTRIBUTE_NAMES",[...Ge,"d"]),rt.setClass(rr),rt.setSVGClass(rr);const Hl=["left","top","radius"],da=["radius","startAngle","endAngle","counterClockwise"];class we extends Gt{static getDefaults(){return D(D({},super.getDefaults()),we.ownDefaults)}constructor(t){super(),Object.assign(this,we.ownDefaults),this.setOptions(t)}_set(t,e){return super._set(t,e),t==="radius"&&this.setRadius(e),this}_render(t){t.beginPath(),t.arc(0,0,this.radius,Lt(this.startAngle),Lt(this.endAngle),this.counterClockwise),this._renderPaintInOrder(t)}getRadiusX(){return this.get("radius")*this.get(re)}getRadiusY(){return this.get("radius")*this.get(ue)}setRadius(t){this.radius=t,this.set({width:2*t,height:2*t})}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...da,...t])}_toSVG(){const t=(this.endAngle-this.startAngle)%360;if(t===0)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),`" />
`];{const{radius:e}=this,r=Lt(this.startAngle),s=Lt(this.endAngle),i=je(r)*e,n=Fe(r)*e,o=je(s)*e,a=Fe(s)*e,l=t>180?1:0,c=this.counterClockwise?0:1;return['<path d="M '.concat(i," ").concat(n," A ").concat(e," ").concat(e," 0 ").concat(l," ").concat(c," ").concat(o," ").concat(a,'" '),"COMMON_PARTS",` />
`]}}static async fromElement(t,e,r){const s=Ie(t,this.ATTRIBUTE_NAMES,r),{left:i=0,top:n=0,radius:o=0}=s;return new this(D(D({},At(s,Hl)),{},{radius:o,left:i-o,top:n-o}))}static fromObject(t){return super._fromObject(t)}}O(we,"type","Circle"),O(we,"cacheProperties",[...Le,...da]),O(we,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),O(we,"ATTRIBUTE_NAMES",["cx","cy","r",...Ge]),rt.setClass(we),rt.setSVGClass(we);const Gl=["x1","y1","x2","y2"],ql=["x1","y1","x2","y2"],Ui=["x1","x2","y1","y2"];class sr extends Gt{constructor(){let[t,e,r,s]=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0,0],i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,sr.ownDefaults),this.setOptions(i),this.x1=t,this.x2=r,this.y1=e,this.y2=s,this._setWidthHeight();const{left:n,top:o}=i;typeof n=="number"&&this.set(kt,n),typeof o=="number"&&this.set($t,o)}_setWidthHeight(){const{x1:t,y1:e,x2:r,y2:s}=this;this.width=Math.abs(r-t),this.height=Math.abs(s-e);const{left:i,top:n,width:o,height:a}=Me([{x:t,y:e},{x:r,y:s}]),l=new z(i+o/2,n+a/2);this.setPositionByOrigin(l,yt,yt)}_set(t,e){return super._set(t,e),Ui.includes(t)&&this._setWidthHeight(),this}_render(t){t.beginPath();const e=this.calcLinePoints();t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.lineWidth=this.strokeWidth;const r=t.strokeStyle;var s;ce(this.stroke)?t.strokeStyle=this.stroke.toLive(t):t.strokeStyle=(s=this.stroke)!==null&&s!==void 0?s:t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=r}_findCenterFromElement(){return new z((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return D(D({},super.toObject(t)),this.calcLinePoints())}_getNonTransformedDimensions(){const t=super._getNonTransformedDimensions();return this.strokeLineCap==="butt"&&(this.width===0&&(t.y-=this.strokeWidth),this.height===0&&(t.x-=this.strokeWidth)),t}calcLinePoints(){const{x1:t,x2:e,y1:r,y2:s,width:i,height:n}=this,o=t<=e?-1:1,a=r<=s?-1:1;return{x1:o*i/2,x2:o*-i/2,y1:a*n/2,y2:a*-n/2}}_toSVG(){const{x1:t,x2:e,y1:r,y2:s}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(t,'" y1="').concat(r,'" x2="').concat(e,'" y2="').concat(s,`" />
`)]}static async fromElement(t,e,r){const s=Ie(t,this.ATTRIBUTE_NAMES,r),{x1:i=0,y1:n=0,x2:o=0,y2:a=0}=s;return new this([i,n,o,a],At(s,Gl))}static fromObject(t){let{x1:e,y1:r,x2:s,y2:i}=t,n=At(t,ql);return this._fromObject(D(D({},n),{},{points:[e,r,s,i]}),{extraParam:"points"})}}O(sr,"type","Line"),O(sr,"cacheProperties",[...Le,...Ui]),O(sr,"ATTRIBUTE_NAMES",Ge.concat(Ui)),rt.setClass(sr),rt.setSVGClass(sr);class ir extends Gt{static getDefaults(){return D(D({},super.getDefaults()),ir.ownDefaults)}constructor(t){super(),Object.assign(this,ir.ownDefaults),this.setOptions(t)}_render(t){const e=this.width/2,r=this.height/2;t.beginPath(),t.moveTo(-e,r),t.lineTo(0,-r),t.lineTo(e,r),t.closePath(),this._renderPaintInOrder(t)}_toSVG(){const t=this.width/2,e=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-t," ").concat(e,",0 ").concat(-e,",").concat(t," ").concat(e),'" />']}}O(ir,"type","Triangle"),O(ir,"ownDefaults",{width:100,height:100}),rt.setClass(ir),rt.setSVGClass(ir);const fa=["rx","ry"];class De extends Gt{static getDefaults(){return D(D({},super.getDefaults()),De.ownDefaults)}constructor(t){super(),Object.assign(this,De.ownDefaults),this.setOptions(t)}_set(t,e){switch(super._set(t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this}getRx(){return this.get("rx")*this.get(re)}getRy(){return this.get("ry")*this.get(ue)}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...fa,...t])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,`" />
`)]}_render(t){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(0,0,this.rx,0,Ns,!1),t.restore(),this._renderPaintInOrder(t)}static async fromElement(t,e,r){const s=Ie(t,this.ATTRIBUTE_NAMES,r);return s.left=(s.left||0)-s.rx,s.top=(s.top||0)-s.ry,new this(s)}}function Zl(h){if(!h)return[];const t=h.replace(/,/g," ").trim().split(/\s+/),e=[];for(let r=0;r<t.length;r+=2)e.push({x:parseFloat(t[r]),y:parseFloat(t[r+1])});return e}O(De,"type","Ellipse"),O(De,"cacheProperties",[...Le,...fa]),O(De,"ownDefaults",{rx:0,ry:0}),O(De,"ATTRIBUTE_NAMES",[...Ge,"cx","cy","rx","ry"]),rt.setClass(De),rt.setSVGClass(De);const Kl=["left","top"],ga={exactBoundingBox:!1};class me extends Gt{static getDefaults(){return D(D({},super.getDefaults()),me.ownDefaults)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),O(this,"strokeDiff",void 0),Object.assign(this,me.ownDefaults),this.setOptions(e),this.points=t;const{left:r,top:s}=e;this.initialized=!0,this.setBoundingBox(!0),typeof r=="number"&&this.set(kt,r),typeof s=="number"&&this.set($t,s)}isOpen(){return!0}_projectStrokeOnPoints(t){return zh(this.points,t,this.isOpen())}_calcDimensions(t){t=D({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},t||{});const e=this.exactBoundingBox?this._projectStrokeOnPoints(t).map(l=>l.projectedPoint):this.points;if(e.length===0)return{left:0,top:0,width:0,height:0,pathOffset:new z,strokeOffset:new z,strokeDiff:new z};const r=Me(e),s=ri(D(D({},t),{},{scaleX:1,scaleY:1})),i=Me(this.points.map(l=>Qt(l,s,!0))),n=new z(this.scaleX,this.scaleY);let o=r.left+r.width/2,a=r.top+r.height/2;return this.exactBoundingBox&&(o-=a*Math.tan(Lt(this.skewX)),a-=o*Math.tan(Lt(this.skewY))),D(D({},r),{},{pathOffset:new z(o,a),strokeOffset:new z(i.left,i.top).subtract(new z(r.left,r.top)).multiply(n),strokeDiff:new z(r.width,r.height).subtract(new z(i.width,i.height)).multiply(n)})}_findCenterFromElement(){const t=Me(this.points);return new z(t.left+t.width/2,t.top+t.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(t){const{left:e,top:r,width:s,height:i,pathOffset:n,strokeOffset:o,strokeDiff:a}=this._calcDimensions();this.set({width:s,height:i,pathOffset:n,strokeOffset:o,strokeDiff:a}),t&&this.setPositionByOrigin(new z(e+s/2,r+i/2),yt,yt)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new z(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.exactBoundingBox){let n;if(Object.keys(t).some(o=>this.strokeUniform||this.constructor.layoutProperties.includes(o))){var e,r;const{width:o,height:a}=this._calcDimensions(t);n=new z((e=t.width)!==null&&e!==void 0?e:o,(r=t.height)!==null&&r!==void 0?r:a)}else{var s,i;n=new z((s=t.width)!==null&&s!==void 0?s:this.width,(i=t.height)!==null&&i!==void 0?i:this.height)}return n.multiply(new z(t.scaleX||this.scaleX,t.scaleY||this.scaleY))}return super._getTransformedDimensions(t)}_set(t,e){const r=this.initialized&&this[t]!==e,s=super._set(t,e);return this.exactBoundingBox&&r&&((t===re||t===ue)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(t))&&this.setDimensions(),s}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return D(D({},super.toObject(t)),{},{points:this.points.map(e=>{let{x:r,y:s}=e;return{x:r,y:s}})})}_toSVG(){const t=[],e=this.pathOffset.x,r=this.pathOffset.y,s=xt.NUM_FRACTION_DIGITS;for(let i=0,n=this.points.length;i<n;i++)t.push(Pt(this.points[i].x-e,s),",",Pt(this.points[i].y-r,s)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(t.join(""),`" />
`)]}_render(t){const e=this.points.length,r=this.pathOffset.x,s=this.pathOffset.y;if(e&&!isNaN(this.points[e-1].y)){t.beginPath(),t.moveTo(this.points[0].x-r,this.points[0].y-s);for(let i=0;i<e;i++){const n=this.points[i];t.lineTo(n.x-r,n.y-s)}!this.isOpen()&&t.closePath(),this._renderPaintInOrder(t)}}complexity(){return this.points.length}static async fromElement(t,e,r){return new this(Zl(t.getAttribute("points")),D(D({},At(Ie(t,this.ATTRIBUTE_NAMES,r),Kl)),e))}static fromObject(t){return this._fromObject(t,{extraParam:"points"})}}O(me,"ownDefaults",ga),O(me,"type","Polyline"),O(me,"layoutProperties",[Pr,jr,"strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),O(me,"cacheProperties",[...Le,"points"]),O(me,"ATTRIBUTE_NAMES",[...Ge]),rt.setClass(me),rt.setSVGClass(me);class us extends me{isOpen(){return!1}}O(us,"ownDefaults",ga),O(us,"type","Polygon"),rt.setClass(us),rt.setSVGClass(us);const pa=["fontSize","fontWeight","fontFamily","fontStyle"],ma=["underline","overline","linethrough"],_a=[...pa,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],va=[..._a,...ma,"textBackgroundColor","direction"],Jl=[...pa,...ma,ee,"strokeWidth",Rt,"deltaY","textBackgroundColor"],Ql={_reNewline:Hi,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:kt,fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:kt,pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2},Ce="justify",$s="justify-left",Xr="justify-right",Yr="justify-center";class ya extends Gt{isEmptyStyles(t){if(!this.styles||t!==void 0&&!this.styles[t])return!0;const e=t===void 0?this.styles:{line:this.styles[t]};for(const r in e)for(const s in e[r])for(const i in e[r][s])return!1;return!0}styleHas(t,e){if(!this.styles||e!==void 0&&!this.styles[e])return!1;const r=e===void 0?this.styles:{0:this.styles[e]};for(const s in r)for(const i in r[s])if(r[s][i][t]!==void 0)return!0;return!1}cleanStyle(t){if(!this.styles)return!1;const e=this.styles;let r,s,i=0,n=!0,o=0;for(const a in e){r=0;for(const l in e[a]){const c=e[a][l]||{};i++,c[t]!==void 0?(s?c[t]!==s&&(n=!1):s=c[t],c[t]===this[t]&&delete c[t]):n=!1,Object.keys(c).length!==0?r++:delete e[a][l]}r===0&&delete e[a]}for(let a=0;a<this._textLines.length;a++)o+=this._textLines[a].length;n&&i===o&&(this[t]=s,this.removeStyle(t))}removeStyle(t){if(!this.styles)return;const e=this.styles;let r,s,i;for(s in e){for(i in r=e[s],r)delete r[i][t],Object.keys(r[i]).length===0&&delete r[i];Object.keys(r).length===0&&delete e[s]}}_extendStyles(t,e){const{lineIndex:r,charIndex:s}=this.get2DCursorLocation(t);this._getLineStyle(r)||this._setLineStyle(r);const i=Ji(D(D({},this._getStyleDeclaration(r,s)),e),n=>n!==void 0);this._setStyleDeclaration(r,s,i)}getSelectionStyles(t,e,r){const s=[];for(let i=t;i<(e||t);i++)s.push(this.getStyleAtPosition(i,r));return s}getStyleAtPosition(t,e){const{lineIndex:r,charIndex:s}=this.get2DCursorLocation(t);return e?this.getCompleteStyleDeclaration(r,s):this._getStyleDeclaration(r,s)}setSelectionStyles(t,e,r){for(let s=e;s<(r||e);s++)this._extendStyles(s,t);this._forceClearCache=!0}_getStyleDeclaration(t,e){var r;const s=this.styles&&this.styles[t];return s&&(r=s[e])!==null&&r!==void 0?r:{}}getCompleteStyleDeclaration(t,e){return D(D({},Fr(this,this.constructor._styleProperties)),this._getStyleDeclaration(t,e))}_setStyleDeclaration(t,e,r){this.styles[t][e]=r}_deleteStyleDeclaration(t,e){delete this.styles[t][e]}_getLineStyle(t){return!!this.styles[t]}_setLineStyle(t){this.styles[t]={}}_deleteLineStyle(t){delete this.styles[t]}}O(ya,"_styleProperties",Jl);const $l=/  +/g,tc=/"/g;function Ci(h,t,e,r,s){return"		".concat(function(i,n){let{left:o,top:a,width:l,height:c}=n,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:xt.NUM_FRACTION_DIGITS;const f=Gr(Rt,i,!1),[d,m,p,v]=[o,a,l,c].map(_=>Pt(_,u));return"<rect ".concat(f,' x="').concat(d,'" y="').concat(m,'" width="').concat(p,'" height="').concat(v,'"></rect>')}(h,{left:t,top:e,width:r,height:s}),`
`)}const ec=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];let Si;class Ht extends ya{static getDefaults(){return D(D({},super.getDefaults()),Ht.ownDefaults)}constructor(t,e){super(),O(this,"__charBounds",[]),Object.assign(this,Ht.ownDefaults),this.setOptions(e),this.styles||(this.styles={}),this.text=t,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){const t=this.path;t&&(t.segmentsInfo=oa(t.path))}_splitText(){const t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(Ce)&&this.enlargeSpaces()}enlargeSpaces(){let t,e,r,s,i,n,o;for(let a=0,l=this._textLines.length;a<l;a++)if((this.textAlign===Ce||a!==l-1&&!this.isEndOfWrapping(a))&&(s=0,i=this._textLines[a],e=this.getLineWidth(a),e<this.width&&(o=this.textLines[a].match(this._reSpacesAndTabs)))){r=o.length,t=(this.width-e)/r;for(let c=0;c<=i.length;c++)n=this.__charBounds[a][c],this._reSpaceAndTab.test(i[c])?(n.width+=t,n.kernedWidth+=t,n.left+=s,s+=t):n.left+=s}}isEndOfWrapping(t){return t===this._textLines.length-1}missingNewlineOffset(t){return 1}get2DCursorLocation(t,e){const r=e?this._unwrappedTextLines:this._textLines;let s;for(s=0;s<r.length;s++){if(t<=r[s].length)return{lineIndex:s,charIndex:t};t-=r[s].length+this.missingNewlineOffset(s,e)}return{lineIndex:s-1,charIndex:r[s-1].length<t?r[s-1].length:t}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){const t=super._getCacheCanvasDimensions(),e=this.fontSize;return t.width+=e*t.zoomX,t.height+=e*t.zoomY,t}_render(t){const e=this.path;e&&!e.isNotVisible()&&e._render(t),this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough")}_renderText(t){this.paintFirst===ee?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t))}_setTextStyles(t,e,r){if(t.textBaseline="alphabetic",this.path)switch(this.pathAlign){case yt:t.textBaseline="middle";break;case"ascender":t.textBaseline=$t;break;case"descender":t.textBaseline=Mi}t.font=this._getFontDeclaration(e,r)}calcTextWidth(){let t=this.getLineWidth(0);for(let e=1,r=this._textLines.length;e<r;e++){const s=this.getLineWidth(e);s>t&&(t=s)}return t}_renderTextLine(t,e,r,s,i,n){this._renderChars(t,e,r,s,i,n)}_renderTextLinesBackground(t){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;const e=t.fillStyle,r=this._getLeftOffset();let s=this._getTopOffset();for(let i=0,n=this._textLines.length;i<n;i++){const o=this.getHeightOfLine(i);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",i)){s+=o;continue}const a=this._textLines[i].length,l=this._getLineLeftOffset(i);let c,u,f=0,d=0,m=this.getValueOfPropertyAt(i,0,"textBackgroundColor");for(let p=0;p<a;p++){const v=this.__charBounds[i][p];u=this.getValueOfPropertyAt(i,p,"textBackgroundColor"),this.path?(t.save(),t.translate(v.renderLeft,v.renderTop),t.rotate(v.angle),t.fillStyle=u,u&&t.fillRect(-v.width/2,-o/this.lineHeight*(1-this._fontSizeFraction),v.width,o/this.lineHeight),t.restore()):u!==m?(c=r+l+d,this.direction==="rtl"&&(c=this.width-c-f),t.fillStyle=m,m&&t.fillRect(c,s,f,o/this.lineHeight),d=v.left,f=v.width,m=u):f+=v.kernedWidth}u&&!this.path&&(c=r+l+d,this.direction==="rtl"&&(c=this.width-c-f),t.fillStyle=u,t.fillRect(c,s,f,o/this.lineHeight)),s+=o}t.fillStyle=e,this._removeShadow(t)}_measureChar(t,e,r,s){const i=Nr.getFontCache(e),n=this._getFontDeclaration(e),o=r+t,a=r&&n===this._getFontDeclaration(s),l=e.fontSize/this.CACHE_FONT_SIZE;let c,u,f,d;if(r&&i[r]!==void 0&&(f=i[r]),i[t]!==void 0&&(d=c=i[t]),a&&i[o]!==void 0&&(u=i[o],d=u-f),c===void 0||f===void 0||u===void 0){const m=function(){if(!Si){const p=zt();p.width=p.height=0,Si=p.getContext("2d")}return Si}();this._setTextStyles(m,e,!0),c===void 0&&(d=c=m.measureText(t).width,i[t]=c),f===void 0&&a&&r&&(f=m.measureText(r).width,i[r]=f),a&&u===void 0&&(u=m.measureText(o).width,i[o]=u,d=u-f)}return{width:c*l,kernedWidth:d*l}}getHeightOfChar(t,e){return this.getValueOfPropertyAt(t,e,"fontSize")}measureLine(t){const e=this._measureLine(t);return this.charSpacing!==0&&(e.width-=this._getWidthOfCharSpacing()),e.width<0&&(e.width=0),e}_measureLine(t){let e,r,s=0;const i=this.pathSide===Ft,n=this.path,o=this._textLines[t],a=o.length,l=new Array(a);this.__charBounds[t]=l;for(let c=0;c<a;c++){const u=o[c];r=this._getGraphemeBox(u,t,c,e),l[c]=r,s+=r.kernedWidth,e=u}if(l[a]={left:r?r.left+r.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},n&&n.segmentsInfo){let c=0;const u=n.segmentsInfo[n.segmentsInfo.length-1].length;switch(this.textAlign){case kt:c=i?u-s:0;break;case yt:c=(u-s)/2;break;case Ft:c=i?0:u-s}c+=this.pathStartOffset*(i?-1:1);for(let f=i?a-1:0;i?f>=0:f<a;i?f--:f++)r=l[f],c>u?c%=u:c<0&&(c+=u),this._setGraphemeOnPath(c,r),c+=r.kernedWidth}return{width:s,numOfSpaces:0}}_setGraphemeOnPath(t,e){const r=t+e.kernedWidth/2,s=this.path,i=kl(s.path,r,s.segmentsInfo);e.renderLeft=i.x-s.pathOffset.x,e.renderTop=i.y-s.pathOffset.y,e.angle=i.angle+(this.pathSide===Ft?Math.PI:0)}_getGraphemeBox(t,e,r,s,i){const n=this.getCompleteStyleDeclaration(e,r),o=s?this.getCompleteStyleDeclaration(e,r-1):{},a=this._measureChar(t,n,s,o);let l,c=a.kernedWidth,u=a.width;this.charSpacing!==0&&(l=this._getWidthOfCharSpacing(),u+=l,c+=l);const f={width:u,left:0,height:n.fontSize,kernedWidth:c,deltaY:n.deltaY};if(r>0&&!i){const d=this.__charBounds[e][r-1];f.left=d.left+d.width+a.kernedWidth-a.width}return f}getHeightOfLine(t){if(this.__lineHeights[t])return this.__lineHeights[t];let e=this.getHeightOfChar(t,0);for(let r=1,s=this._textLines[t].length;r<s;r++)e=Math.max(this.getHeightOfChar(t,r),e);return this.__lineHeights[t]=e*this.lineHeight*this._fontSizeMult}calcTextHeight(){let t,e=0;for(let r=0,s=this._textLines.length;r<s;r++)t=this.getHeightOfLine(r),e+=r===s-1?t/this.lineHeight:t;return e}_getLeftOffset(){return this.direction==="ltr"?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(t,e){t.save();let r=0;const s=this._getLeftOffset(),i=this._getTopOffset();for(let n=0,o=this._textLines.length;n<o;n++){const a=this.getHeightOfLine(n),l=a/this.lineHeight,c=this._getLineLeftOffset(n);this._renderTextLine(e,t,this._textLines[n],s+c,i+r+l,n),r+=a}t.restore()}_renderTextFill(t){(this.fill||this.styleHas(Rt))&&this._renderTextCommon(t,"fillText")}_renderTextStroke(t){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())}_renderChars(t,e,r,s,i,n){const o=this.getHeightOfLine(n),a=this.textAlign.includes(Ce),l=this.path,c=!a&&this.charSpacing===0&&this.isEmptyStyles(n)&&!l,u=this.direction==="ltr",f=this.direction==="ltr"?1:-1,d=e.direction;let m,p,v,_,b,C="",k=0;if(e.save(),d!==this.direction&&(e.canvas.setAttribute("dir",u?"ltr":"rtl"),e.direction=u?"ltr":"rtl",e.textAlign=u?kt:Ft),i-=o*this._fontSizeFraction/this.lineHeight,c)return this._renderChar(t,e,n,0,r.join(""),s,i),void e.restore();for(let T=0,P=r.length-1;T<=P;T++)_=T===P||this.charSpacing||l,C+=r[T],v=this.__charBounds[n][T],k===0?(s+=f*(v.kernedWidth-v.width),k+=v.width):k+=v.kernedWidth,a&&!_&&this._reSpaceAndTab.test(r[T])&&(_=!0),_||(m=m||this.getCompleteStyleDeclaration(n,T),p=this.getCompleteStyleDeclaration(n,T+1),_=on(m,p,!1)),_&&(l?(e.save(),e.translate(v.renderLeft,v.renderTop),e.rotate(v.angle),this._renderChar(t,e,n,T,C,-k/2,0),e.restore()):(b=s,this._renderChar(t,e,n,T,C,b,i)),C="",m=p,s+=f*k,k=0);e.restore()}_applyPatternGradientTransformText(t){const e=zt(),r=this.width+this.strokeWidth,s=this.height+this.strokeWidth,i=e.getContext("2d");return e.width=r,e.height=s,i.beginPath(),i.moveTo(0,0),i.lineTo(r,0),i.lineTo(r,s),i.lineTo(0,s),i.closePath(),i.translate(r/2,s/2),i.fillStyle=t.toLive(i),this._applyPatternGradientTransform(i,t),i.fill(),i.createPattern(e,"no-repeat")}handleFiller(t,e,r){let s,i;return ce(r)?r.gradientUnits==="percentage"||r.gradientTransform||r.patternTransform?(s=-this.width/2,i=-this.height/2,t.translate(s,i),t[e]=this._applyPatternGradientTransformText(r),{offsetX:s,offsetY:i}):(t[e]=r.toLive(t),this._applyPatternGradientTransform(t,r)):(t[e]=r,{offsetX:0,offsetY:0})}_setStrokeStyles(t,e){let{stroke:r,strokeWidth:s}=e;return t.lineWidth=s,t.lineCap=this.strokeLineCap,t.lineDashOffset=this.strokeDashOffset,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,this.handleFiller(t,"strokeStyle",r)}_setFillStyles(t,e){let{fill:r}=e;return this.handleFiller(t,"fillStyle",r)}_renderChar(t,e,r,s,i,n,o){const a=this._getStyleDeclaration(r,s),l=this.getCompleteStyleDeclaration(r,s),c=t==="fillText"&&l.fill,u=t==="strokeText"&&l.stroke&&l.strokeWidth;if(u||c){if(e.save(),e.font=this._getFontDeclaration(l),a.textBackgroundColor&&this._removeShadow(e),a.deltaY&&(o+=a.deltaY),c){const f=this._setFillStyles(e,l);e.fillText(i,n-f.offsetX,o-f.offsetY)}if(u){const f=this._setStrokeStyles(e,l);e.strokeText(i,n-f.offsetX,o-f.offsetY)}e.restore()}}setSuperscript(t,e){this._setScript(t,e,this.superscript)}setSubscript(t,e){this._setScript(t,e,this.subscript)}_setScript(t,e,r){const s=this.get2DCursorLocation(t,!0),i=this.getValueOfPropertyAt(s.lineIndex,s.charIndex,"fontSize"),n=this.getValueOfPropertyAt(s.lineIndex,s.charIndex,"deltaY"),o={fontSize:i*r.size,deltaY:n+i*r.baseline};this.setSelectionStyles(o,t,e)}_getLineLeftOffset(t){const e=this.getLineWidth(t),r=this.width-e,s=this.textAlign,i=this.direction,n=this.isEndOfWrapping(t);let o=0;return s===Ce||s===Yr&&!n||s===Xr&&!n||s===$s&&!n?0:(s===yt&&(o=r/2),s===Ft&&(o=r),s===Yr&&(o=r/2),s===Xr&&(o=r),i==="rtl"&&(s===Ft||s===Ce||s===Xr?o=0:s===kt||s===$s?o=-r:s!==yt&&s!==Yr||(o=-r/2)),o)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(t){if(this.__lineWidths[t]!==void 0)return this.__lineWidths[t];const{width:e}=this.measureLine(t);return this.__lineWidths[t]=e,e}_getWidthOfCharSpacing(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(t,e,r){var s;return(s=this._getStyleDeclaration(t,e)[r])!==null&&s!==void 0?s:this[r]}_renderTextDecoration(t,e){if(!this[e]&&!this.styleHas(e))return;let r=this._getTopOffset();const s=this._getLeftOffset(),i=this.path,n=this._getWidthOfCharSpacing(),o=this.offsets[e];for(let a=0,l=this._textLines.length;a<l;a++){const c=this.getHeightOfLine(a);if(!this[e]&&!this.styleHas(e,a)){r+=c;continue}const u=this._textLines[a],f=c/this.lineHeight,d=this._getLineLeftOffset(a);let m,p,v=0,_=0,b=this.getValueOfPropertyAt(a,0,e),C=this.getValueOfPropertyAt(a,0,Rt);const k=r+f*(1-this._fontSizeFraction);let T=this.getHeightOfChar(a,0),P=this.getValueOfPropertyAt(a,0,"deltaY");for(let I=0,j=u.length;I<j;I++){const U=this.__charBounds[a][I];m=this.getValueOfPropertyAt(a,I,e),p=this.getValueOfPropertyAt(a,I,Rt);const $=this.getHeightOfChar(a,I),S=this.getValueOfPropertyAt(a,I,"deltaY");if(i&&m&&p)t.save(),t.fillStyle=C,t.translate(U.renderLeft,U.renderTop),t.rotate(U.angle),t.fillRect(-U.kernedWidth/2,o*$+S,U.kernedWidth,this.fontSize/15),t.restore();else if((m!==b||p!==C||$!==T||S!==P)&&_>0){let F=s+d+v;this.direction==="rtl"&&(F=this.width-F-_),b&&C&&(t.fillStyle=C,t.fillRect(F,k+o*T+P,_,this.fontSize/15)),v=U.left,_=U.width,b=m,C=p,T=$,P=S}else _+=U.kernedWidth}let A=s+d+v;this.direction==="rtl"&&(A=this.width-A-_),t.fillStyle=p,m&&p&&t.fillRect(A,k+o*T+P,_-n,this.fontSize/15),r+=c}this._removeShadow(t)}_getFontDeclaration(){let{fontFamily:t=this.fontFamily,fontStyle:e=this.fontStyle,fontWeight:r=this.fontWeight,fontSize:s=this.fontSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;const n=t.includes("'")||t.includes('"')||t.includes(",")||Ht.genericFonts.includes(t.toLowerCase())?t:'"'.concat(t,'"');return[e,r,"".concat(i?this.CACHE_FONT_SIZE:s,"px"),n].join(" ")}render(t){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(t)))}graphemeSplit(t){return nn(t)}_splitTextIntoLines(t){const e=t.split(this._reNewline),r=new Array(e.length),s=[`
`];let i=[];for(let n=0;n<e.length;n++)r[n]=this.graphemeSplit(e[n]),i=i.concat(r[n],s);return i.pop(),{_unwrappedLines:r,lines:e,graphemeText:i,graphemeLines:r}}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return D(D({},super.toObject([...va,...t])),{},{styles:Uh(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(t,e){const{textLayoutProperties:r}=this.constructor;super.set(t,e);let s=!1,i=!1;if(typeof t=="object")for(const n in t)n==="path"&&this.setPathInfo(),s=s||r.includes(n),i=i||n==="path";else s=r.includes(t),i=t==="path";return i&&this.setPathInfo(),s&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(t,e,r){const s=Ie(t,Ht.ATTRIBUTE_NAMES,r),i=D(D({},e),s),{textAnchor:n=kt,textDecoration:o="",dx:a=0,dy:l=0,top:c=0,left:u=0,fontSize:f=Vi,strokeWidth:d=1}=i,m=At(i,ec),p=new this((t.textContent||"").replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),D({left:u+a,top:c+l,underline:o.includes("underline"),overline:o.includes("overline"),linethrough:o.includes("line-through"),strokeWidth:0,fontSize:f},m)),v=p.getScaledHeight()/p.height,_=((p.height+p.strokeWidth)*p.lineHeight-p.height)*v,b=p.getScaledHeight()+_;let C=0;return n===yt&&(C=p.getScaledWidth()/2),n===Ft&&(C=p.getScaledWidth()),p.set({left:p.left-C,top:p.top-(b-p.fontSize*(.07+p._fontSizeFraction))/p.lineHeight,strokeWidth:d}),p}static fromObject(t){return this._fromObject(D(D({},t),{},{styles:Xh(t.styles||{},t.text)}),{extraParam:"text"})}}O(Ht,"textLayoutProperties",_a),O(Ht,"cacheProperties",[...Le,...va]),O(Ht,"ownDefaults",Ql),O(Ht,"type","Text"),O(Ht,"genericFonts",["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),O(Ht,"ATTRIBUTE_NAMES",Ge.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),Jo(Ht,[class extends Uo{_toSVG(){const h=this._getSVGLeftTopOffsets(),t=this._getSVGTextAndBg(h.textTop,h.textLeft);return this._wrapSVGTextAndBg(t)}toSVG(h){return this._createBaseSVGMarkup(this._toSVG(),{reviver:h,noStyle:!0,withShadow:!0})}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(h){let{textBgRects:t,textSpans:e}=h;const r=this.getSvgTextDecoration(this);return[t.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'.concat(this.fontFamily.replace(tc,"'"),'" '):"",this.fontSize?'font-size="'.concat(this.fontSize,'" '):"",this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",r?'text-decoration="'.concat(r,'" '):"",this.direction==="rtl"?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",e.join(""),`</text>
`]}_getSVGTextAndBg(h,t){const e=[],r=[];let s,i=h;this.backgroundColor&&r.push(...Ci(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let n=0,o=this._textLines.length;n<o;n++)s=this._getLineLeftOffset(n),this.direction==="rtl"&&(s+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",n))&&this._setSVGTextLineBg(r,n,t+s,i),this._setSVGTextLineText(e,n,t+s,i),i+=this.getHeightOfLine(n);return{textSpans:e,textBgRects:r}}_createTextCharSpan(h,t,e,r){const s=this.getSvgSpanStyles(t,h!==h.trim()||!!h.match($l)),i=s?'style="'.concat(s,'"'):"",n=t.deltaY,o=n?' dy="'.concat(Pt(n,xt.NUM_FRACTION_DIGITS),'" '):"";return'<tspan x="'.concat(Pt(e,xt.NUM_FRACTION_DIGITS),'" y="').concat(Pt(r,xt.NUM_FRACTION_DIGITS),'" ').concat(o).concat(i,">").concat(Wh(h),"</tspan>")}_setSVGTextLineText(h,t,e,r){const s=this.getHeightOfLine(t),i=this.textAlign.includes(Ce),n=this._textLines[t];let o,a,l,c,u,f="",d=0;r+=s*(1-this._fontSizeFraction)/this.lineHeight;for(let m=0,p=n.length-1;m<=p;m++)u=m===p||this.charSpacing,f+=n[m],l=this.__charBounds[t][m],d===0?(e+=l.kernedWidth-l.width,d+=l.width):d+=l.kernedWidth,i&&!u&&this._reSpaceAndTab.test(n[m])&&(u=!0),u||(o=o||this.getCompleteStyleDeclaration(t,m),a=this.getCompleteStyleDeclaration(t,m+1),u=on(o,a,!0)),u&&(c=this._getStyleDeclaration(t,m),h.push(this._createTextCharSpan(f,c,e,r)),f="",o=a,this.direction==="rtl"?e-=d:e+=d,d=0)}_setSVGTextLineBg(h,t,e,r){const s=this._textLines[t],i=this.getHeightOfLine(t)/this.lineHeight;let n,o=0,a=0,l=this.getValueOfPropertyAt(t,0,"textBackgroundColor");for(let c=0;c<s.length;c++){const{left:u,width:f,kernedWidth:d}=this.__charBounds[t][c];n=this.getValueOfPropertyAt(t,c,"textBackgroundColor"),n!==l?(l&&h.push(...Ci(l,e+a,r,o,i)),a=u,o=f,l=n):o+=d}n&&h.push(...Ci(l,e+a,r,o,i))}_getSVGLineTopOffset(h){let t,e=0;for(t=0;t<h;t++)e+=this.getHeightOfLine(t);const r=this.getHeightOfLine(t);return{lineTop:e,offset:(this._fontSizeMult-this._fontSizeFraction)*r/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(h){return"".concat(super.getSvgStyles(h)," white-space: pre;")}getSvgSpanStyles(h,t){const{fontFamily:e,strokeWidth:r,stroke:s,fill:i,fontSize:n,fontStyle:o,fontWeight:a,deltaY:l}=h,c=this.getSvgTextDecoration(h);return[s?Gr(ee,s):"",r?"stroke-width: ".concat(r,"; "):"",e?"font-family: ".concat(e.includes("'")||e.includes('"')?e:"'".concat(e,"'"),"; "):"",n?"font-size: ".concat(n,"px; "):"",o?"font-style: ".concat(o,"; "):"",a?"font-weight: ".concat(a,"; "):"",c&&"text-decoration: ".concat(c,"; "),i?Gr(Rt,i):"",l?"baseline-shift: ".concat(-l,"; "):"",t?"white-space: pre; ":""].join("")}getSvgTextDecoration(h){return["overline","underline","line-through"].filter(t=>h[t.replace("-","")]).join(" ")}}]),rt.setClass(Ht),rt.setSVGClass(Ht);class rc{constructor(t){O(this,"target",void 0),O(this,"__mouseDownInPlace",!1),O(this,"__dragStartFired",!1),O(this,"__isDraggingOver",!1),O(this,"__dragStartSelection",void 0),O(this,"__dragImageDisposer",void 0),O(this,"_dispose",void 0),this.target=t;const e=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{e.forEach(r=>r()),this._dispose=void 0}}isPointerOverSelection(t){const e=this.target,r=e.getSelectionStartFromPointer(t);return e.isEditing&&r>=e.selectionStart&&r<=e.selectionEnd&&e.selectionStart<e.selectionEnd}start(t){return this.__mouseDownInPlace=this.isPointerOverSelection(t)}isActive(){return this.__mouseDownInPlace}end(t){const e=this.isActive();return e&&!this.__dragStartFired&&(this.target.setCursorByClick(t),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,e}getDragStartSelection(){return this.__dragStartSelection}setDragImage(t,e){var r;let{selectionStart:s,selectionEnd:i}=e;const n=this.target,o=n.canvas,a=new z(n.flipX?-1:1,n.flipY?-1:1),l=n._getCursorBoundaries(s),c=new z(l.left+l.leftOffset,l.top+l.topOffset).multiply(a).transform(n.calcTransformMatrix()),u=o.getScenePoint(t).subtract(c),f=n.getCanvasRetinaScaling(),d=n.getBoundingRect(),m=c.subtract(new z(d.left,d.top)),p=o.viewportTransform,v=m.add(u).transform(p,!0),_=n.backgroundColor,b=sn(n.styles);n.backgroundColor="";const C={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};n.setSelectionStyles(C,0,s),n.setSelectionStyles(C,i,n.text.length),n.dirty=!0;const k=n.toCanvasElement({enableRetinaScaling:o.enableRetinaScaling,viewportTransform:!0});n.backgroundColor=_,n.styles=b,n.dirty=!0,Ni(k,{position:"fixed",left:"".concat(-k.width,"px"),border:te,width:"".concat(k.width/f,"px"),height:"".concat(k.height/f,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{k.remove()},ve(t.target||this.target.hiddenTextarea).body.appendChild(k),(r=t.dataTransfer)===null||r===void 0||r.setDragImage(k,v.x,v.y)}onDragStart(t){this.__dragStartFired=!0;const e=this.target,r=this.isActive();if(r&&t.dataTransfer){const s=this.__dragStartSelection={selectionStart:e.selectionStart,selectionEnd:e.selectionEnd},i=e._text.slice(s.selectionStart,s.selectionEnd).join(""),n=D({text:e.text,value:i},s);t.dataTransfer.setData("text/plain",i),t.dataTransfer.setData("application/fabric",JSON.stringify({value:i,styles:e.getSelectionStyles(s.selectionStart,s.selectionEnd,!0)})),t.dataTransfer.effectAllowed="copyMove",this.setDragImage(t,n)}return e.abortCursorAnimation(),r}canDrop(t){if(this.target.editable&&!this.target.getActiveControl()&&!t.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){const e=this.target.getSelectionStartFromPointer(t),r=this.__dragStartSelection;return e<r.selectionStart||e>r.selectionEnd}return!0}return!1}targetCanDrop(t){return this.target.canDrop(t)}dragEnterHandler(t){let{e}=t;const r=this.targetCanDrop(e);!this.__isDraggingOver&&r&&(this.__isDraggingOver=!0)}dragOverHandler(t){const{e}=t,r=this.targetCanDrop(e);!this.__isDraggingOver&&r?this.__isDraggingOver=!0:this.__isDraggingOver&&!r&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(e.preventDefault(),t.canDrop=!0,t.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(t){var e;const{e:r}=t,s=r.defaultPrevented;this.__isDraggingOver=!1,r.preventDefault();let i=(e=r.dataTransfer)===null||e===void 0?void 0:e.getData("text/plain");if(i&&!s){const n=this.target,o=n.canvas;let a=n.getSelectionStartFromPointer(r);const{styles:l}=r.dataTransfer.types.includes("application/fabric")?JSON.parse(r.dataTransfer.getData("application/fabric")):{},c=i[Math.max(0,i.length-1)],u=0;if(this.__dragStartSelection){const f=this.__dragStartSelection.selectionStart,d=this.__dragStartSelection.selectionEnd;a>f&&a<=d?a=f:a>d&&(a-=d-f),n.removeChars(f,d),delete this.__dragStartSelection}n._reNewline.test(c)&&(n._reNewline.test(n._text[a])||a===n._text.length)&&(i=i.trimEnd()),t.didDrop=!0,t.dropTarget=n,n.insertChars(i,l,a),o.setActiveObject(n),n.enterEditing(r),n.selectionStart=Math.min(a+u,n._text.length),n.selectionEnd=Math.min(n.selectionStart+i.length,n._text.length),n.hiddenTextarea.value=n.text,n._updateTextarea(),n.hiddenTextarea.focus(),n.fire(Us,{index:a+u,action:"drop"}),o.fire("text:changed",{target:n}),o.contextTopDirty=!0,o.requestRenderAll()}}dragEndHandler(t){let{e}=t;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var r;const s=this.target,i=this.target.canvas,{selectionStart:n,selectionEnd:o}=this.__dragStartSelection,a=((r=e.dataTransfer)===null||r===void 0?void 0:r.dropEffect)||te;a===te?(s.selectionStart=n,s.selectionEnd=o,s._updateTextarea(),s.hiddenTextarea.focus()):(s.clearContextTop(),a==="move"&&(s.removeChars(n,o),s.selectionStart=s.selectionEnd=n,s.hiddenTextarea&&(s.hiddenTextarea.value=s.text),s._updateTextarea(),s.fire(Us,{index:n,action:"dragend"}),i.fire("text:changed",{target:s}),i.requestRenderAll()),s.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}const uo=/[ \n\.,;!\?\-]/;class sc extends Ht{constructor(){super(...arguments),O(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(t){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(t)}_animateCursor(t){let{toValue:e,duration:r,delay:s,onComplete:i}=t;return Ho({startValue:this._currentCursorOpacity,endValue:e,duration:r,delay:s,onComplete:i,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:n=>{this._currentCursorOpacity=n,this.renderCursorOrSelection()}})}_tick(t){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(t||0,100),onComplete:this._onTickComplete})}_onTickComplete(){var t;(t=this._currentTickCompleteState)===null||t===void 0||t.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick})}initDelayedCursor(t){this.abortCursorAnimation(),this._tick(t?0:this.cursorDelay)}abortCursorAnimation(){let t=!1;[this._currentTickState,this._currentTickCompleteState].forEach(e=>{e&&!e.isDone()&&(t=!0,e.abort())}),this._currentCursorOpacity=1,t&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some(t=>!t||t.isDone())&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(t){let e=0,r=t-1;if(this._reSpace.test(this._text[r]))for(;this._reSpace.test(this._text[r]);)e++,r--;for(;/\S/.test(this._text[r])&&r>-1;)e++,r--;return t-e}findWordBoundaryRight(t){let e=0,r=t;if(this._reSpace.test(this._text[r]))for(;this._reSpace.test(this._text[r]);)e++,r++;for(;/\S/.test(this._text[r])&&r<this._text.length;)e++,r++;return t+e}findLineBoundaryLeft(t){let e=0,r=t-1;for(;!/\n/.test(this._text[r])&&r>-1;)e++,r--;return t-e}findLineBoundaryRight(t){let e=0,r=t;for(;!/\n/.test(this._text[r])&&r<this._text.length;)e++,r++;return t+e}searchWordBoundary(t,e){const r=this._text;let s=t>0&&this._reSpace.test(r[t])&&(e===-1||!Hi.test(r[t-1]))?t-1:t,i=r[s];for(;s>0&&s<r.length&&!uo.test(i);)s+=e,i=r[s];return e===-1&&uo.test(i)&&s++,s}selectWord(t){t=t||this.selectionStart;const e=this.searchWordBoundary(t,-1),r=Math.max(e,this.searchWordBoundary(t,1));this.selectionStart=e,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(t){t=t||this.selectionStart;const e=this.findLineBoundaryLeft(t),r=this.findLineBoundaryRight(t);return this.selectionStart=e,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea(),this}enterEditing(t){!this.isEditing&&this.editable&&(this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered",t?{e:t}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e:t}),this.canvas.requestRenderAll()))}updateSelectionOnMouseMove(t){if(this.getActiveControl())return;const e=this.hiddenTextarea;ve(e).activeElement!==e&&e.focus();const r=this.getSelectionStartFromPointer(t),s=this.selectionStart,i=this.selectionEnd;(r===this.__selectionStartOnMouseDown&&s!==i||s!==r&&i!==r)&&(r>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=r):(this.selectionStart=r,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===s&&this.selectionEnd===i||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(t,e,r){const s=r.slice(0,t),i=this.graphemeSplit(s).length;if(t===e)return{selectionStart:i,selectionEnd:i};const n=r.slice(t,e);return{selectionStart:i,selectionEnd:i+this.graphemeSplit(n).length}}fromGraphemeToStringSelection(t,e,r){const s=r.slice(0,t).join("").length;return t===e?{selectionStart:s,selectionEnd:s}:{selectionStart:s,selectionEnd:s+r.slice(t,e).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){const t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};const t=this.hiddenTextarea;this.text=t.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();const e=this.fromStringToGraphemeSelection(t.selectionStart,t.selectionEnd,t.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){const t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};const t=this.inCompositionMode?this.compositionStart:this.selectionStart,e=this._getCursorBoundaries(t),r=this.get2DCursorLocation(t),s=r.lineIndex,i=r.charIndex,n=this.getValueOfPropertyAt(s,i,"fontSize")*this.lineHeight,o=e.leftOffset,a=this.getCanvasRetinaScaling(),l=this.canvas.upperCanvasEl,c=l.width/a,u=l.height/a,f=c-n,d=u-n,m=new z(e.left+o,e.top+e.topOffset+n).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new z(l.clientWidth/c,l.clientHeight/u));return m.x<0&&(m.x=0),m.x>f&&(m.x=f),m.y<0&&(m.y=0),m.y>d&&(m.y=d),m.x+=this.canvas._offset.left,m.y+=this.canvas._offset.top,{left:"".concat(m.x,"px"),top:"".concat(m.y,"px"),fontSize:"".concat(n,"px"),charHeight:n}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){const t=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,t&&(t.blur&&t.blur(),t.parentNode&&t.parentNode.removeChild(t)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop()}exitEditing(){const t=this._textBeforeEdit!==this.text;return this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),t&&this.fire(Xs),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(const t in this.styles)this._textLines[t]||delete this.styles[t]}removeStyleFromTo(t,e){const{lineIndex:r,charIndex:s}=this.get2DCursorLocation(t,!0),{lineIndex:i,charIndex:n}=this.get2DCursorLocation(e,!0);if(r!==i){if(this.styles[r])for(let o=s;o<this._unwrappedTextLines[r].length;o++)delete this.styles[r][o];if(this.styles[i])for(let o=n;o<this._unwrappedTextLines[i].length;o++){const a=this.styles[i][o];a&&(this.styles[r]||(this.styles[r]={}),this.styles[r][s+o-n]=a)}for(let o=r+1;o<=i;o++)delete this.styles[o];this.shiftLineStyles(i,r-i)}else if(this.styles[r]){const o=this.styles[r],a=n-s;for(let l=s;l<n;l++)delete o[l];for(const l in this.styles[r]){const c=parseInt(l,10);c>=n&&(o[c-a]=o[l],delete o[l])}}}shiftLineStyles(t,e){const r=Object.assign({},this.styles);for(const s in this.styles){const i=parseInt(s,10);i>t&&(this.styles[i+e]=r[i],r[i-e]||delete this.styles[i])}}insertNewlineStyleObject(t,e,r,s){const i={},n=this._unwrappedTextLines[t].length,o=n===e;let a=!1;r||(r=1),this.shiftLineStyles(t,r);const l=this.styles[t]?this.styles[t][e===0?e:e-1]:void 0;for(const u in this.styles[t]){const f=parseInt(u,10);f>=e&&(a=!0,i[f-e]=this.styles[t][u],o&&e===0||delete this.styles[t][u])}let c=!1;for(a&&!o&&(this.styles[t+r]=i,c=!0),(c||n>e)&&r--;r>0;)s&&s[r-1]?this.styles[t+r]={0:D({},s[r-1])}:l?this.styles[t+r]={0:D({},l)}:delete this.styles[t+r],r--;this._forceClearCache=!0}insertCharStyleObject(t,e,r,s){this.styles||(this.styles={});const i=this.styles[t],n=i?D({},i):{};r||(r=1);for(const a in n){const l=parseInt(a,10);l>=e&&(i[l+r]=n[l],n[l-r]||delete i[l])}if(this._forceClearCache=!0,s){for(;r--;)Object.keys(s[r]).length&&(this.styles[t]||(this.styles[t]={}),this.styles[t][e+r]=D({},s[r]));return}if(!i)return;const o=i[e?e-1:1];for(;o&&r--;)this.styles[t][e+r]=D({},o)}insertNewStyleBlock(t,e,r){const s=this.get2DCursorLocation(e,!0),i=[0];let n,o=0;for(let a=0;a<t.length;a++)t[a]===`
`?(o++,i[o]=0):i[o]++;for(i[0]>0&&(this.insertCharStyleObject(s.lineIndex,s.charIndex,i[0],r),r=r&&r.slice(i[0]+1)),o&&this.insertNewlineStyleObject(s.lineIndex,s.charIndex+i[0],o),n=1;n<o;n++)i[n]>0?this.insertCharStyleObject(s.lineIndex+n,0,i[n],r):r&&this.styles[s.lineIndex+n]&&r[0]&&(this.styles[s.lineIndex+n][0]=r[0]),r=r&&r.slice(i[n]+1);i[n]>0&&this.insertCharStyleObject(s.lineIndex+n,0,i[n],r)}removeChars(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t+1;this.removeStyleFromTo(t,e),this._text.splice(t,e-t),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(t,e,r){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:r;s>r&&this.removeStyleFromTo(r,s);const i=this.graphemeSplit(t);this.insertNewStyleBlock(i,r,e),this._text=[...this._text.slice(0,r),...i,...this._text.slice(s)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(t,e,r){r<=t?(e===t?this._selectionDirection=kt:this._selectionDirection===Ft&&(this._selectionDirection=kt,this.selectionEnd=t),this.selectionStart=r):r>t&&r<e?this._selectionDirection===Ft?this.selectionEnd=r:this.selectionStart=r:(e===t?this._selectionDirection=Ft:this._selectionDirection===kt&&(this._selectionDirection=Ft,this.selectionStart=e),this.selectionEnd=r)}}class ic extends sc{initHiddenTextarea(){const t=this.canvas&&ve(this.canvas.getElement())||Mr(),e=t.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off"}).map(n=>{let[o,a]=n;return e.setAttribute(o,a)});const{top:r,left:s,fontSize:i}=this._calcTextareaPosition();e.style.cssText="position: absolute; top: ".concat(r,"; left: ").concat(s,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(i,";"),(this.hiddenTextareaContainer||t.body).appendChild(e),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map(n=>{let[o,a]=n;return e.addEventListener(o,this[a].bind(this))}),this.hiddenTextarea=e}blur(){this.abortCursorAnimation()}onKeyDown(t){if(!this.isEditing)return;const e=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(t.keyCode in e)this[e[t.keyCode]](t);else{if(!(t.keyCode in this.ctrlKeysMapDown)||!t.ctrlKey&&!t.metaKey)return;this[this.ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),t.keyCode>=33&&t.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(t){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:t.keyCode in this.ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this.ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(t){const e=this.fromPaste;if(this.fromPaste=!1,t&&t.stopPropagation(),!this.isEditing)return;const r=()=>{this.updateFromTextArea(),this.fire(Us),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(this.hiddenTextarea.value==="")return this.styles={},void r();const s=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,i=this._text.length,n=s.length,o=this.selectionStart,a=this.selectionEnd,l=o!==a;let c,u,f,d,m=n-i;const p=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),v=o>p.selectionStart;l?(u=this._text.slice(o,a),m+=a-o):n<i&&(u=v?this._text.slice(a+m,a):this._text.slice(o,o-m));const _=s.slice(p.selectionEnd-m,p.selectionEnd);if(u&&u.length&&(_.length&&(c=this.getSelectionStyles(o,o+1,!1),c=_.map(()=>c[0])),l?(f=o,d=a):v?(f=a-u.length,d=a):(f=a,d=a+u.length),this.removeStyleFromTo(f,d)),_.length){const{copyPasteData:b}=Te();e&&_.join("")===b.copiedText&&!xt.disableStyleCopyPaste&&(c=b.copiedTextStyle),this.insertNewStyleBlock(_,o,c)}r()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(t){let{target:e}=t;const{selectionStart:r,selectionEnd:s}=e;this.compositionStart=r,this.compositionEnd=s,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;const{copyPasteData:t}=Te();t.copiedText=this.getSelectedText(),xt.disableStyleCopyPaste?t.copiedTextStyle=void 0:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(t,e){let r,s=this._getLineLeftOffset(t);return e>0&&(r=this.__charBounds[t][e-1],s+=r.left+r.width),s}getDownCursorOffset(t,e){const r=this._getSelectionForOffset(t,e),s=this.get2DCursorLocation(r),i=s.lineIndex;if(i===this._textLines.length-1||t.metaKey||t.keyCode===34)return this._text.length-r;const n=s.charIndex,o=this._getWidthBeforeCursor(i,n),a=this._getIndexOnLine(i+1,o);return this._textLines[i].slice(n).length+a+1+this.missingNewlineOffset(i)}_getSelectionForOffset(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart}getUpCursorOffset(t,e){const r=this._getSelectionForOffset(t,e),s=this.get2DCursorLocation(r),i=s.lineIndex;if(i===0||t.metaKey||t.keyCode===33)return-r;const n=s.charIndex,o=this._getWidthBeforeCursor(i,n),a=this._getIndexOnLine(i-1,o),l=this._textLines[i].slice(0,n),c=this.missingNewlineOffset(i-1);return-this._textLines[i-1].length+a-l.length+(1-c)}_getIndexOnLine(t,e){const r=this._textLines[t];let s,i,n=this._getLineLeftOffset(t),o=0;for(let a=0,l=r.length;a<l;a++)if(s=this.__charBounds[t][a].width,n+=s,n>e){i=!0;const c=n-s,u=n,f=Math.abs(c-e);o=Math.abs(u-e)<f?a:a-1;break}return i||(o=r.length-1),o}moveCursorDown(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",t)}moveCursorUp(t){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",t)}_moveCursorUpOrDown(t,e){const r=this["get".concat(t,"CursorOffset")](e,this._selectionDirection===Ft);if(e.shiftKey?this.moveCursorWithShift(r):this.moveCursorWithoutShift(r),r!==0){const s=this.text.length;this.selectionStart=Ar(0,this.selectionStart,s),this.selectionEnd=Ar(0,this.selectionEnd,s),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(t){const e=this._selectionDirection===kt?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),t!==0}moveCursorWithoutShift(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),t!==0}moveCursorLeft(t){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",t)}_move(t,e,r){let s;if(t.altKey)s=this["findWordBoundary".concat(r)](this[e]);else{if(!t.metaKey&&t.keyCode!==35&&t.keyCode!==36)return this[e]+=r==="Left"?-1:1,!0;s=this["findLineBoundary".concat(r)](this[e])}return s!==void 0&&this[e]!==s&&(this[e]=s,!0)}_moveLeft(t,e){return this._move(t,e,"Left")}_moveRight(t,e){return this._move(t,e,"Right")}moveCursorLeftWithoutShift(t){let e=!0;return this._selectionDirection=kt,this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e}moveCursorLeftWithShift(t){return this._selectionDirection===Ft&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection=kt,this._moveLeft(t,"selectionStart")):void 0}moveCursorRight(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",t)}_moveCursorLeftOrRight(t,e){const r="moveCursor".concat(t).concat(e.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[r](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(t){return this._selectionDirection===kt&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=Ft,this._moveRight(t,"selectionEnd")):void 0}moveCursorRightWithoutShift(t){let e=!0;return this._selectionDirection=Ft,this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e}}const Ti=h=>!!h.button;class nc extends ic{constructor(){super(...arguments),O(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler),this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown),this.draggableTextDelegate=new rc(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(t){return this.draggableTextDelegate.onDragStart(t)}canDrop(t){return this.draggableTextDelegate.canDrop(t)}onMouseDown(t){if(!this.canvas)return;this.__newClickTime=+new Date;const e=t.pointer;this.isTripleClick(e)&&(this.fire("tripleclick",t),Fi(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastSelected=this.selected&&!this.getActiveControl()}isTripleClick(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y}doubleClickHandler(t){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(t.e))}tripleClickHandler(t){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(t.e))}_mouseDownHandler(t){let{e}=t;this.canvas&&this.editable&&!Ti(e)&&!this.getActiveControl()&&(this.draggableTextDelegate.start(e)||(this.canvas.textEditingManager.register(this),this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())))}_mouseDownHandlerBefore(t){let{e}=t;this.canvas&&this.editable&&!Ti(e)&&(this.selected=this===this.canvas._activeObject)}mouseUpHandler(t){let{e,transform:r}=t;const s=this.draggableTextDelegate.end(e);if(this.canvas){this.canvas.textEditingManager.unregister(this);const i=this.canvas._activeObject;if(i&&i!==this)return}!this.editable||this.group&&!this.group.interactive||r&&r.actionPerformed||Ti(e)||s||(this.__lastSelected&&!this.getActiveControl()?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0)}setCursorByClick(t){const e=this.getSelectionStartFromPointer(t),r=this.selectionStart,s=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(r,s,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(t){const e=this.canvas.getScenePoint(t).transform(ye(this.calcTransformMatrix())).add(new z(-this._getLeftOffset(),-this._getTopOffset()));let r=0,s=0,i=0;for(let l=0;l<this._textLines.length&&r<=e.y;l++)r+=this.getHeightOfLine(l),i=l,l>0&&(s+=this._textLines[l-1].length+this.missingNewlineOffset(l-1));let n=Math.abs(this._getLineLeftOffset(i));const o=this._textLines[i].length,a=this.__charBounds[i];for(let l=0;l<o;l++){const c=n+a[l].kernedWidth;if(e.x<=c){Math.abs(e.x-c)<=Math.abs(e.x-n)&&s++;break}n=c,s++}return Math.min(this.flipX?o-s:s,this._text.length)}}const ds="moveCursorUp",fs="moveCursorDown",gs="moveCursorLeft",ps="moveCursorRight",ms="exitEditing",oc=D({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:ms,27:ms,33:ds,34:fs,35:ps,36:gs,37:gs,38:ds,39:ps,40:fs},keysMapRtl:{9:ms,27:ms,33:ds,34:fs,35:gs,36:ps,37:ps,38:ds,39:gs,40:fs},ctrlKeysMapDown:{65:"selectAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1});class Ae extends nc{static getDefaults(){return D(D({},super.getDefaults()),Ae.ownDefaults)}get type(){const t=super.type;return t==="itext"?"i-text":t}constructor(t,e){super(t,D(D({},Ae.ownDefaults),e)),this.initBehavior()}_set(t,e){return this.isEditing&&this._savedProps&&t in this._savedProps?(this._savedProps[t]=e,this):(t==="canvas"&&(this.canvas instanceof Qs&&this.canvas.textEditingManager.remove(this),e instanceof Qs&&e.textEditingManager.add(this)),super._set(t,e))}setSelectionStart(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)}setSelectionEnd(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)}_updateAndFire(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart||0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionEnd,r=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(t,e,r)}setSelectionStyles(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionStart||0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.selectionEnd;return super.setSelectionStyles(t,e,r)}get2DCursorLocation(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(t,e)}render(t){super.render(t),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(t){const e=this.isEditing;this.isEditing=!1;const r=super.toCanvasElement(t);return this.isEditing=e,r}renderCursorOrSelection(){if(!this.isEditing)return;const t=this.clearContextTop(!0);if(!t)return;const e=this._getCursorBoundaries();this.selectionStart===this.selectionEnd?this.renderCursor(t,e):this.renderSelection(t,e),this.canvas.contextTopDirty=!0,t.restore()}_getCursorBoundaries(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;const r=this._getLeftOffset(),s=this._getTopOffset(),i=this._getCursorBoundariesOffsets(t,e);return{left:r,top:s,leftOffset:i.left,topOffset:i.top}}_getCursorBoundariesOffsets(t,e){return e?this.__getCursorBoundariesOffsets(t):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(t)}__getCursorBoundariesOffsets(t){let e=0,r=0;const{charIndex:s,lineIndex:i}=this.get2DCursorLocation(t);for(let l=0;l<i;l++)e+=this.getHeightOfLine(l);const n=this._getLineLeftOffset(i),o=this.__charBounds[i][s];o&&(r=o.left),this.charSpacing!==0&&s===this._textLines[i].length&&(r-=this._getWidthOfCharSpacing());const a={top:e,left:n+(r>0?r:0)};return this.direction==="rtl"&&(this.textAlign===Ft||this.textAlign===Ce||this.textAlign===Xr?a.left*=-1:this.textAlign===kt||this.textAlign===$s?a.left=n-(r>0?r:0):this.textAlign!==yt&&this.textAlign!==Yr||(a.left=n-(r>0?r:0))),a}renderCursorAt(t){const e=this._getCursorBoundaries(t,!0);this._renderCursor(this.canvas.contextTop,e,t)}renderCursor(t,e){this._renderCursor(t,e,this.selectionStart)}_renderCursor(t,e,r){const s=this.get2DCursorLocation(r),i=s.lineIndex,n=s.charIndex>0?s.charIndex-1:0,o=this.getValueOfPropertyAt(i,n,"fontSize"),a=this.getObjectScaling().x*this.canvas.getZoom(),l=this.cursorWidth/a,c=this.getValueOfPropertyAt(i,n,"deltaY"),u=e.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(i)/this.lineHeight-o*(1-this._fontSizeFraction);this.inCompositionMode&&this.renderSelection(t,e),t.fillStyle=this.cursorColor||this.getValueOfPropertyAt(i,n,Rt),t.globalAlpha=this._currentCursorOpacity,t.fillRect(e.left+e.leftOffset-l/2,u+e.top+c,l,o)}renderSelection(t,e){const r={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(t,r,e)}renderDragSourceEffect(){const t=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,t,this._getCursorBoundaries(t.selectionStart,!0))}renderDropTargetEffect(t){const e=this.getSelectionStartFromPointer(t);this.renderCursorAt(e)}_renderSelection(t,e,r){const s=e.selectionStart,i=e.selectionEnd,n=this.textAlign.includes(Ce),o=this.get2DCursorLocation(s),a=this.get2DCursorLocation(i),l=o.lineIndex,c=a.lineIndex,u=o.charIndex<0?0:o.charIndex,f=a.charIndex<0?0:a.charIndex;for(let d=l;d<=c;d++){const m=this._getLineLeftOffset(d)||0;let p=this.getHeightOfLine(d),v=0,_=0,b=0;if(d===l&&(_=this.__charBounds[l][u].left),d>=l&&d<c)b=n&&!this.isEndOfWrapping(d)?this.width:this.getLineWidth(d)||5;else if(d===c)if(f===0)b=this.__charBounds[c][f].left;else{const A=this._getWidthOfCharSpacing();b=this.__charBounds[c][f-1].left+this.__charBounds[c][f-1].width-A}v=p,(this.lineHeight<1||d===c&&this.lineHeight>1)&&(p/=this.lineHeight);let C=r.left+m+_,k=p,T=0;const P=b-_;this.inCompositionMode?(t.fillStyle=this.compositionColor||"black",k=1,T=p):t.fillStyle=this.selectionColor,this.direction==="rtl"&&(this.textAlign===Ft||this.textAlign===Ce||this.textAlign===Xr?C=this.width-C-P:this.textAlign===kt||this.textAlign===$s?C=r.left+m-b:this.textAlign!==yt&&this.textAlign!==Yr||(C=r.left+m-b)),t.fillRect(C,r.top+r.topOffset+T,P,k),r.topOffset+=v}}getCurrentCharFontSize(){const t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize")}getCurrentCharColor(){const t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,Rt)}_getCurrentCharIndex(){const t=this.get2DCursorLocation(this.selectionStart,!0),e=t.charIndex>0?t.charIndex-1:0;return{l:t.lineIndex,c:e}}dispose(){this._exitEditing(),this.draggableTextDelegate.dispose(),super.dispose()}}O(Ae,"ownDefaults",oc),O(Ae,"type","IText"),rt.setClass(Ae),rt.setClass(Ae,"i-text");class nr extends Ae{static getDefaults(){return D(D({},super.getDefaults()),nr.ownDefaults)}constructor(t,e){super(t,D(D({},nr.ownDefaults),e))}static createControls(){return{controls:Ih()}}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(Ce)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(t){let e=0,r=0,s=0;const i={};for(let n=0;n<t.graphemeLines.length;n++)t.graphemeText[s]===`
`&&n>0?(r=0,s++,e++):!this.splitByGrapheme&&this._reSpaceAndTab.test(t.graphemeText[s])&&n>0&&(r++,s++),i[n]={line:e,offset:r},s+=t.graphemeLines[n].length,r+=t.graphemeLines[n].length;return i}styleHas(t,e){if(this._styleMap&&!this.isWrapping){const r=this._styleMap[e];r&&(e=r.line)}return super.styleHas(t,e)}isEmptyStyles(t){if(!this.styles)return!0;let e,r=0,s=t+1,i=!1;const n=this._styleMap[t],o=this._styleMap[t+1];n&&(t=n.line,r=n.offset),o&&(s=o.line,i=s===t,e=o.offset);const a=t===void 0?this.styles:{line:this.styles[t]};for(const l in a)for(const c in a[l]){const u=parseInt(c,10);if(u>=r&&(!i||u<e))for(const f in a[l][c])return!1}return!0}_getStyleDeclaration(t,e){if(this._styleMap&&!this.isWrapping){const r=this._styleMap[t];if(!r)return{};t=r.line,e=r.offset+e}return super._getStyleDeclaration(t,e)}_setStyleDeclaration(t,e,r){const s=this._styleMap[t];super._setStyleDeclaration(s.line,s.offset+e,r)}_deleteStyleDeclaration(t,e){const r=this._styleMap[t];super._deleteStyleDeclaration(r.line,r.offset+e)}_getLineStyle(t){const e=this._styleMap[t];return!!this.styles[e.line]}_setLineStyle(t){const e=this._styleMap[t];super._setLineStyle(e.line)}_wrapText(t,e){this.isWrapping=!0;const r=this.getGraphemeDataForRender(t),s=[];for(let i=0;i<r.wordsData.length;i++)s.push(...this._wrapLine(i,e,r));return this.isWrapping=!1,s}getGraphemeDataForRender(t){const e=this.splitByGrapheme,r=e?"":" ";let s=0;return{wordsData:t.map((i,n)=>{let o=0;const a=e?this.graphemeSplit(i):this.wordSplit(i);return a.length===0?[{word:[],width:0}]:a.map(l=>{const c=e?[l]:this.graphemeSplit(l),u=this._measureWord(c,n,o);return s=Math.max(u,s),o+=c.length+r.length,{word:c,width:u}})}),largestWordWidth:s}}_measureWord(t,e){let r,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=0;for(let n=0,o=t.length;n<o;n++)i+=this._getGraphemeBox(t[n],e,n+s,r,!0).kernedWidth,r=t[n];return i}wordSplit(t){return t.split(this._wordJoiners)}_wrapLine(t,e,r){let{largestWordWidth:s,wordsData:i}=r,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const o=this._getWidthOfCharSpacing(),a=this.splitByGrapheme,l=[],c=a?"":" ";let u=0,f=[],d=0,m=0,p=!0;e-=n;const v=Math.max(e,s,this.dynamicMinWidth),_=i[t];let b;for(d=0,b=0;b<_.length;b++){const{word:C,width:k}=_[b];d+=C.length,u+=m+k-o,u>v&&!p?(l.push(f),f=[],u=k,p=!0):u+=o,p||a||f.push(c),f=f.concat(C),m=a?0:this._measureWord([c],t,d),d++,p=!1}return b&&l.push(f),s+n>this.dynamicMinWidth&&(this.dynamicMinWidth=s-o+n),l}isEndOfWrapping(t){return!this._styleMap[t+1]||this._styleMap[t+1].line!==this._styleMap[t].line}missingNewlineOffset(t,e){return this.splitByGrapheme&&!e?this.isEndOfWrapping(t)?1:0:1}_splitTextIntoLines(t){const e=super._splitTextIntoLines(t),r=this._wrapText(e.lines,this.width),s=new Array(r.length);for(let i=0;i<r.length;i++)s[i]=r[i].join("");return e.lines=s,e.graphemeLines=r,e}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){const t=new Map;for(const e in this._styleMap){const r=parseInt(e,10);if(this._textLines[r]){const s=this._styleMap[e].line;t.set("".concat(s),!0)}}for(const e in this.styles)t.has(e)||delete this.styles[e]}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...t])}}O(nr,"type","Textbox"),O(nr,"textLayoutProperties",[...Ae.textLayoutProperties,"width"]),O(nr,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),rt.setClass(nr);class fo extends ai{shouldPerformLayout(t){return!!t.target.clipPath&&super.shouldPerformLayout(t)}shouldLayoutClipPath(){return!1}calcLayoutResult(t,e){const{target:r}=t,{clipPath:s,group:i}=r;if(!s||!this.shouldPerformLayout(t))return;const{width:n,height:o}=Me(ta(r,s)),a=new z(n,o);if(s.absolutePositioned)return{center:Dr(s.getRelativeCenterPoint(),void 0,i?i.calcTransformMatrix():void 0),size:a};{const l=s.getRelativeCenterPoint().transform(r.calcOwnMatrix(),!0);if(this.shouldPerformLayout(t)){const{center:c=new z,correction:u=new z}=this.calcBoundingBox(e,t)||{};return{center:c.add(l),correction:u.subtract(l),size:a}}return{center:r.getRelativeCenterPoint().add(l),size:a}}}}O(fo,"type","clip-path"),rt.setClass(fo);class go extends ai{getInitialSize(t,e){let{target:r}=t,{size:s}=e;return new z(r.width||s.x,r.height||s.y)}}O(go,"type","fixed"),rt.setClass(go);class ac extends Zr{subscribeTargets(t){const e=t.target;t.targets.reduce((r,s)=>(s.parent&&r.add(s.parent),r),new Set).forEach(r=>{r.layoutManager.subscribeTargets({target:r,targets:[e]})})}unsubscribeTargets(t){const e=t.target,r=e.getObjects();t.targets.reduce((s,i)=>(i.parent&&s.add(i.parent),s),new Set).forEach(s=>{!r.some(i=>i.parent===s)&&s.layoutManager.unsubscribeTargets({target:s,targets:[e]})})}}class or extends ar{static getDefaults(){return D(D({},super.getDefaults()),or.ownDefaults)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,or.ownDefaults),this.setOptions(e);const{left:r,top:s,layoutManager:i}=e;this.groupInit(t,{left:r,top:s,layoutManager:i??new ac})}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.multiSelectionStacking==="selection-order"?this.add(...e):e.forEach(s=>{const i=this._objects.findIndex(o=>o.isInFrontOf(s)),n=i===-1?this.size():i;this.insertAt(n,s)})}canEnterGroup(t){return this.getObjects().some(e=>e.isDescendantOf(t)||t.isDescendantOf(e))?(Ye("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(t)}enterGroup(t,e){t.parent&&t.parent===t.group?t.parent._exitGroup(t):t.group&&t.parent!==t.group&&t.group.remove(t),this._enterGroup(t,e)}exitGroup(t,e){this._exitGroup(t,e),t.parent&&t.parent._enterGroup(t,!0)}_onAfterObjectsChange(t,e){super._onAfterObjectsChange(t,e);const r=new Set;e.forEach(s=>{const{parent:i}=s;i&&r.add(i)}),t===hn?r.forEach(s=>{s._onAfterObjectsChange(Zs,e)}):r.forEach(s=>{s._set("dirty",!0)})}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(t,e,r){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;const s=D(D({hasControls:!1},r),{},{forActiveSelection:!0});for(let i=0;i<this._objects.length;i++)this._objects[i]._renderControls(t,s);super._renderControls(t,e),t.restore()}}O(or,"type","ActiveSelection"),O(or,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),rt.setClass(or),rt.setClass(or,"activeSelection");class hc{constructor(){O(this,"resources",{})}applyFilters(t,e,r,s,i){const n=i.getContext("2d");if(!n)return;n.drawImage(e,0,0,r,s);const o={sourceWidth:r,sourceHeight:s,imageData:n.getImageData(0,0,r,s),originalEl:e,originalImageData:n.getImageData(0,0,r,s),canvasEl:i,ctx:n,filterBackend:this};t.forEach(l=>{l.applyTo(o)});const{imageData:a}=o;return a.width===r&&a.height===s||(i.width=a.width,i.height=a.height),n.putImageData(a,0,0),o}}class ba{constructor(){let{tileSize:t=xt.textureSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};O(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),O(this,"resources",{}),this.tileSize=t,this.setupGLContext(t,t),this.captureGPUInfo()}setupGLContext(t,e){this.dispose(),this.createWebGLCanvas(t,e)}createWebGLCanvas(t,e){const r=zt();r.width=t,r.height=e;const s=r.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});s&&(s.clearColor(0,0,0,0),this.canvas=r,this.gl=s)}applyFilters(t,e,r,s,i,n){const o=this.gl,a=i.getContext("2d");if(!o||!a)return;let l;n&&(l=this.getCachedTexture(n,e));const c={originalWidth:e.width||e.originalWidth||0,originalHeight:e.height||e.originalHeight||0,sourceWidth:r,sourceHeight:s,destinationWidth:r,destinationHeight:s,context:o,sourceTexture:this.createTexture(o,r,s,l?void 0:e),targetTexture:this.createTexture(o,r,s),originalTexture:l||this.createTexture(o,r,s,l?void 0:e),passes:t.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:i},u=o.createFramebuffer();return o.bindFramebuffer(o.FRAMEBUFFER,u),t.forEach(f=>{f&&f.applyTo(c)}),function(f){const d=f.targetCanvas,m=d.width,p=d.height,v=f.destinationWidth,_=f.destinationHeight;m===v&&p===_||(d.width=v,d.height=_)}(c),this.copyGLTo2D(o,c),o.bindTexture(o.TEXTURE_2D,null),o.deleteTexture(c.sourceTexture),o.deleteTexture(c.targetTexture),o.deleteFramebuffer(u),a.setTransform(1,0,0,1,0,0),c}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(t,e,r,s,i){const{NEAREST:n,TEXTURE_2D:o,RGBA:a,UNSIGNED_BYTE:l,CLAMP_TO_EDGE:c,TEXTURE_MAG_FILTER:u,TEXTURE_MIN_FILTER:f,TEXTURE_WRAP_S:d,TEXTURE_WRAP_T:m}=t,p=t.createTexture();return t.bindTexture(o,p),t.texParameteri(o,u,i||n),t.texParameteri(o,f,i||n),t.texParameteri(o,d,c),t.texParameteri(o,m,c),s?t.texImage2D(o,0,a,a,l,s):t.texImage2D(o,0,a,e,r,0,a,l,null),p}getCachedTexture(t,e,r){const{textureCache:s}=this;if(s[t])return s[t];{const i=this.createTexture(this.gl,e.width,e.height,e,r);return i&&(s[t]=i),i}}evictCachesForKey(t){this.textureCache[t]&&(this.gl.deleteTexture(this.textureCache[t]),delete this.textureCache[t])}copyGLTo2D(t,e){const r=t.canvas,s=e.targetCanvas,i=s.getContext("2d");if(!i)return;i.translate(0,s.height),i.scale(1,-1);const n=r.height-s.height;i.drawImage(r,0,n,s.width,s.height,0,0,s.width,s.height)}copyGLTo2DPutImageData(t,e){const r=e.targetCanvas.getContext("2d"),s=e.destinationWidth,i=e.destinationHeight,n=s*i*4;if(!r)return;const o=new Uint8Array(this.imageBuffer,0,n),a=new Uint8ClampedArray(this.imageBuffer,0,n);t.readPixels(0,0,s,i,t.RGBA,t.UNSIGNED_BYTE,o);const l=new ImageData(a,s,i);r.putImageData(l,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;const t=this.gl,e={renderer:"",vendor:""};if(!t)return e;const r=t.getExtension("WEBGL_debug_renderer_info");if(r){const s=t.getParameter(r.UNMASKED_RENDERER_WEBGL),i=t.getParameter(r.UNMASKED_VENDOR_WEBGL);s&&(e.renderer=s.toLowerCase()),i&&(e.vendor=i.toLowerCase())}return this.gpuInfo=e,e}}let ki;function lc(){const{WebGLProbe:h}=Te();return h.queryWebGL(zt()),xt.enableGLFiltering&&h.isSupported(xt.textureSize)?new ba({tileSize:xt.textureSize}):new hc}function Oi(){return!ki&&(!(arguments.length>0&&arguments[0]!==void 0)||arguments[0])&&(ki=lc()),ki}const cc=["filters","resizeFilter","src","crossOrigin","type"],xa=["cropX","cropY"];class ne extends Gt{static getDefaults(){return D(D({},super.getDefaults()),ne.ownDefaults)}constructor(t,e){super(),O(this,"_lastScaleX",1),O(this,"_lastScaleY",1),O(this,"_filterScalingX",1),O(this,"_filterScalingY",1),this.filters=[],Object.assign(this,ne.ownDefaults),this.setOptions(e),this.cacheKey="texture".concat(Ve()),this.setElement(typeof t=="string"?(this.canvas&&ve(this.canvas.getElement())||Mr()).getElementById(t):t,e)}getElement(){return this._element}setElement(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=t,this._originalElement=t,this._setWidthHeight(e),t.classList.add(ne.CSS_CANVAS),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(t){const e=Oi(!1);e instanceof ba&&e.evictCachesForKey(t)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(t=>{const e=this[t];e&&Te().dispose(e),this[t]=void 0})}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){const t=this.getElement();return t?{width:t.naturalWidth||t.width,height:t.naturalHeight||t.height}:{width:0,height:0}}_stroke(t){if(!this.stroke||this.strokeWidth===0)return;const e=this.width/2,r=this.height/2;t.beginPath(),t.moveTo(-e,-r),t.lineTo(e,-r),t.lineTo(e,r),t.lineTo(-e,r),t.lineTo(-e,-r),t.closePath()}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=[];return this.filters.forEach(r=>{r&&e.push(r.toObject())}),D(D({},super.toObject([...xa,...t])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:e},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){const t=[],e=this._element,r=-this.width/2,s=-this.height/2;let i=[],n=[],o="",a="";if(!e)return[];if(this.hasCrop()){const l=Ve();i.push('<clipPath id="imageCrop_'+l+`">
`,'	<rect x="'+r+'" y="'+s+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),o=' clip-path="url(#imageCrop_'+l+')" '}if(this.imageSmoothing||(a=' image-rendering="optimizeSpeed"'),t.push("	<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(r-this.cropX,'" y="').concat(s-this.cropY,'" width="').concat(e.width||e.naturalWidth,'" height="').concat(e.height||e.naturalHeight,'"').concat(a).concat(o,`></image>
`)),this.stroke||this.strokeDashArray){const l=this.fill;this.fill=null,n=['	<rect x="'.concat(r,'" y="').concat(s,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),`" />
`)],this.fill=l}return i=this.paintFirst!==Rt?i.concat(n,t):i.concat(t,n),i}getSrc(t){const e=t?this._element:this._originalElement;return e?e.toDataURL?e.toDataURL():this.srcFromAttribute?e.getAttribute("src")||"":e.src:this.src||""}getSvgSrc(t){return this.getSrc(t)}setSrc(t){let{crossOrigin:e,signal:r}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Rs(t,{crossOrigin:e,signal:r}).then(s=>{e!==void 0&&this.set({crossOrigin:e}),this.setElement(s)})}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){const t=this.resizeFilter,e=this.minimumScaleTrigger,r=this.getTotalObjectScaling(),s=r.x,i=r.y,n=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!t||s>e&&i>e)return this._element=n,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=s,void(this._lastScaleY=i);const o=zt(),a=n.width,l=n.height;o.width=a,o.height=l,this._element=o,this._lastScaleX=t.scaleX=s,this._lastScaleY=t.scaleY=i,Oi().applyFilters([t],n,a,l,this._element),this._filterScalingX=o.width/this._originalElement.width,this._filterScalingY=o.height/this._originalElement.height}applyFilters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.filters||[];if(t=t.filter(i=>i&&!i.isNeutralState()),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),t.length===0)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);const e=this._originalElement,r=e.naturalWidth||e.width,s=e.naturalHeight||e.height;if(this._element===this._originalElement){const i=zt();i.width=r,i.height=s,this._element=i,this._filteredEl=i}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,r,s),this._lastScaleX=1,this._lastScaleY=1);Oi().applyFilters(t,this._originalElement,r,s,this._element),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(t){t.imageSmoothingEnabled=this.imageSmoothing,this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(t),this._renderPaintInOrder(t)}drawCacheOnCanvas(t){t.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(t)}shouldCache(){return this.needsItsOwnCache()}_renderFill(t){const e=this._element;if(!e)return;const r=this._filterScalingX,s=this._filterScalingY,i=this.width,n=this.height,o=Math.max(this.cropX,0),a=Math.max(this.cropY,0),l=e.naturalWidth||e.width,c=e.naturalHeight||e.height,u=o*r,f=a*s,d=Math.min(i*r,l-u),m=Math.min(n*s,c-f),p=-i/2,v=-n/2,_=Math.min(i,l/r-o),b=Math.min(n,c/s-a);e&&t.drawImage(e,u,f,d,m,p,v,_,b)}_needsResize(){const t=this.getTotalObjectScaling();return t.x!==this._lastScaleX||t.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:t,height:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=this.getOriginalSize();this.width=t||r.width,this.height=e||r.height}parsePreserveAspectRatioAttribute(){const t=Ha(this.preserveAspectRatio||""),e=this.width,r=this.height,s={width:e,height:r};let i,n=this._element.width,o=this._element.height,a=1,l=1,c=0,u=0,f=0,d=0;return!t||t.alignX===te&&t.alignY===te?(a=e/n,l=r/o):(t.meetOrSlice==="meet"&&(a=l=pl(this._element,s),i=(e-n*a)/2,t.alignX==="Min"&&(c=-i),t.alignX==="Max"&&(c=i),i=(r-o*l)/2,t.alignY==="Min"&&(u=-i),t.alignY==="Max"&&(u=i)),t.meetOrSlice==="slice"&&(a=l=ml(this._element,s),i=n-e/a,t.alignX==="Mid"&&(f=i/2),t.alignX==="Max"&&(f=i),i=o-r/l,t.alignY==="Mid"&&(d=i/2),t.alignY==="Max"&&(d=i),n=e/a,o=r/l)),{width:n,height:o,scaleX:a,scaleY:l,offsetLeft:c,offsetTop:u,cropX:f,cropY:d}}static fromObject(t,e){let{filters:r,resizeFilter:s,src:i,crossOrigin:n,type:o}=t,a=At(t,cc);return Promise.all([Rs(i,D(D({},e),{},{crossOrigin:n})),r&&Hr(r,e),s&&Hr([s],e),si(a,e)]).then(l=>{let[c,u=[],[f]=[],d={}]=l;return new this(c,D(D({},a),{},{src:i,filters:u,resizeFilter:f},d))})}static fromURL(t){let{crossOrigin:e=null,signal:r}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;return Rs(t,{crossOrigin:e,signal:r}).then(i=>new this(i,s))}static async fromElement(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;const s=Ie(t,this.ATTRIBUTE_NAMES,r);return this.fromURL(s["xlink:href"],e,s).catch(i=>(Ye("log","Unable to parse Image",i),null))}}O(ne,"type","Image"),O(ne,"cacheProperties",[...Le,...xa]),O(ne,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),O(ne,"CSS_CANVAS","canvas-img"),O(ne,"ATTRIBUTE_NAMES",[...Ge,"x","y","width","height","preserveAspectRatio","xlink:href","crossOrigin","image-rendering"]),rt.setClass(ne),rt.setSVGClass(ne);ni(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);const li=h=>h.webgl!==void 0,ln="precision highp float",uc=`
    `.concat(ln,`;
    varying vec2 vTexCoord;
    uniform sampler2D uTexture;
    void main() {
      gl_FragColor = texture2D(uTexture, vTexCoord);
    }`),dc=["type"],fc=["type"],gc=new RegExp(ln,"g");class Wt{get type(){return this.constructor.type}constructor(){let t=At(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},dc);Object.assign(this,this.constructor.defaults,t)}getFragmentSource(){return uc}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    void main() {
      vTexCoord = aPosition;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }`}createProgram(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getFragmentSource(),r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.getVertexSource();const{WebGLProbe:{GLPrecision:s="highp"}}=Te();s!=="highp"&&(e=e.replace(gc,ln.replace("highp",s)));const i=t.createShader(t.VERTEX_SHADER),n=t.createShader(t.FRAGMENT_SHADER),o=t.createProgram();if(!i||!n||!o)throw new Se("Vertex, fragment shader or program creation error");if(t.shaderSource(i,r),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw new Se("Vertex shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(i)));if(t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Se("Fragment shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(n)));if(t.attachShader(o,i),t.attachShader(o,n),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))throw new Se('Shader link error for "'.concat(this.type,'" ').concat(t.getProgramInfoLog(o)));const a=this.getUniformLocations(t,o)||{};return a.uStepW=t.getUniformLocation(o,"uStepW"),a.uStepH=t.getUniformLocation(o,"uStepH"),{program:o,attributeLocations:this.getAttributeLocations(t,o),uniformLocations:a}}getAttributeLocations(t,e){return{aPosition:t.getAttribLocation(e,"aPosition")}}getUniformLocations(t,e){const r=this.constructor.uniformLocations,s={};for(let i=0;i<r.length;i++)s[r[i]]=t.getUniformLocation(e,r[i]);return s}sendAttributeData(t,e,r){const s=e.aPosition,i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.enableVertexAttribArray(s),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW)}_setupFrameBuffer(t){const e=t.context;if(t.passes>1){const r=t.destinationWidth,s=t.destinationHeight;t.sourceWidth===r&&t.sourceHeight===s||(e.deleteTexture(t.targetTexture),t.targetTexture=t.filterBackend.createTexture(e,r,s)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.targetTexture,0)}else e.bindFramebuffer(e.FRAMEBUFFER,null),e.finish()}_swapTextures(t){t.passes--,t.pass++;const e=t.targetTexture;t.targetTexture=t.sourceTexture,t.sourceTexture=e}isNeutralState(t){return!1}applyTo(t){li(t)?(this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){}getCacheKey(){return this.type}retrieveShader(t){const e=this.getCacheKey();return t.programCache[e]||(t.programCache[e]=this.createProgram(t.context)),t.programCache[e]}applyToWebGL(t){const e=t.context,r=this.retrieveShader(t);t.pass===0&&t.originalTexture?e.bindTexture(e.TEXTURE_2D,t.originalTexture):e.bindTexture(e.TEXTURE_2D,t.sourceTexture),e.useProgram(r.program),this.sendAttributeData(e,r.attributeLocations,t.aPosition),e.uniform1f(r.uniformLocations.uStepW,1/t.sourceWidth),e.uniform1f(r.uniformLocations.uStepH,1/t.sourceHeight),this.sendUniformData(e,r.uniformLocations),e.viewport(0,0,t.destinationWidth,t.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(t,e,r){t.activeTexture(r),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE0)}unbindAdditionalTexture(t,e){t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0)}sendUniformData(t,e){}createHelpLayer(t){if(!t.helpLayer){const e=zt();e.width=t.sourceWidth,e.height=t.sourceHeight,t.helpLayer=e}}toObject(){const t=Object.keys(this.constructor.defaults||{});return D({type:this.type},t.reduce((e,r)=>(e[r]=this[r],e),{}))}toJSON(){return this.toObject()}static async fromObject(t,e){return new this(At(t,fc))}}O(Wt,"type","BaseFilter"),O(Wt,"uniformLocations",[]);const pc={multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,difference:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`
    if (uColor.r < 0.5) {
      gl_FragColor.r *= 2.0 * uColor.r;
    } else {
      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
    }
    if (uColor.g < 0.5) {
      gl_FragColor.g *= 2.0 * uColor.g;
    } else {
      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
    }
    if (uColor.b < 0.5) {
      gl_FragColor.b *= 2.0 * uColor.b;
    } else {
      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
    }
    `,tint:`
    gl_FragColor.rgb *= (1.0 - uColor.a);
    gl_FragColor.rgb += uColor.rgb;
    `};class _s extends Wt{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec4 uColor;
      varying vec2 vTexCoord;
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        gl_FragColor = color;
        if (color.a > 0.0) {
          `.concat(pc[this.mode],`
        }
      }
      `)}applyTo2d(t){let{imageData:{data:e}}=t;const r=new Ot(this.color).getSource(),s=r[0]*this.alpha,i=r[1]*this.alpha,n=r[2]*this.alpha,o=1-this.alpha;for(let a=0;a<e.length;a+=4){const l=e[a],c=e[a+1],u=e[a+2];switch(this.mode){case"multiply":e[a]=l*s/255,e[a+1]=c*i/255,e[a+2]=u*n/255;break;case"screen":e[a]=255-(255-l)*(255-s)/255,e[a+1]=255-(255-c)*(255-i)/255,e[a+2]=255-(255-u)*(255-n)/255;break;case"add":e[a]=l+s,e[a+1]=c+i,e[a+2]=u+n;break;case"difference":e[a]=Math.abs(l-s),e[a+1]=Math.abs(c-i),e[a+2]=Math.abs(u-n);break;case"subtract":e[a]=l-s,e[a+1]=c-i,e[a+2]=u-n;break;case"darken":e[a]=Math.min(l,s),e[a+1]=Math.min(c,i),e[a+2]=Math.min(u,n);break;case"lighten":e[a]=Math.max(l,s),e[a+1]=Math.max(c,i),e[a+2]=Math.max(u,n);break;case"overlay":e[a]=s<128?2*l*s/255:255-2*(255-l)*(255-s)/255,e[a+1]=i<128?2*c*i/255:255-2*(255-c)*(255-i)/255,e[a+2]=n<128?2*u*n/255:255-2*(255-u)*(255-n)/255;break;case"exclusion":e[a]=s+l-2*s*l/255,e[a+1]=i+c-2*i*c/255,e[a+2]=n+u-2*n*u/255;break;case"tint":e[a]=s+l*o,e[a+1]=i+c*o,e[a+2]=n+u*o}}}sendUniformData(t,e){const r=new Ot(this.color).getSource();r[0]=this.alpha*r[0]/255,r[1]=this.alpha*r[1]/255,r[2]=this.alpha*r[2]/255,r[3]=this.alpha,t.uniform4fv(e.uColor,r)}}O(_s,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),O(_s,"type","BlendColor"),O(_s,"uniformLocations",["uColor"]),rt.setClass(_s);const mc={multiply:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.rgba *= color2.rgba;
      gl_FragColor = color;
    }
    `,mask:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.a = color2.a;
      gl_FragColor = color;
    }
    `},_c=["type","image"];class vs extends Wt{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return mc[this.mode]}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    uniform mat3 uTransformMatrix;
    void main() {
      vTexCoord = aPosition;
      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }
    `}applyToWebGL(t){const e=t.context,r=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(e,r,e.TEXTURE1),super.applyToWebGL(t),this.unbindAdditionalTexture(e,e.TEXTURE1)}createTexture(t,e){return t.getCachedTexture(e.cacheKey,e.getElement())}calculateMatrix(){const t=this.image,{width:e,height:r}=t.getElement();return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/e,-t.top/r,1]}applyTo2d(t){let{imageData:{data:e,width:r,height:s},filterBackend:{resources:i}}=t;const n=this.image;i.blendImage||(i.blendImage=zt());const o=i.blendImage,a=o.getContext("2d");o.width!==r||o.height!==s?(o.width=r,o.height=s):a.clearRect(0,0,r,s),a.setTransform(n.scaleX,0,0,n.scaleY,n.left,n.top),a.drawImage(n.getElement(),0,0,r,s);const l=a.getImageData(0,0,r,s).data;for(let c=0;c<e.length;c+=4){const u=e[c],f=e[c+1],d=e[c+2],m=e[c+3],p=l[c],v=l[c+1],_=l[c+2],b=l[c+3];switch(this.mode){case"multiply":e[c]=u*p/255,e[c+1]=f*v/255,e[c+2]=d*_/255,e[c+3]=m*b/255;break;case"mask":e[c+3]=b}}}sendUniformData(t,e){const r=this.calculateMatrix();t.uniform1i(e.uImage,1),t.uniformMatrix3fv(e.uTransformMatrix,!1,r)}toObject(){return D(D({},super.toObject()),{},{image:this.image&&this.image.toObject()})}static async fromObject(t,e){let{type:r,image:s}=t,i=At(t,_c);return ne.fromObject(s,e).then(n=>new this(D(D({},i),{},{image:n})))}}O(vs,"type","BlendImage"),O(vs,"defaults",{mode:"multiply",alpha:1}),O(vs,"uniformLocations",["uTransformMatrix","uImage"]),rt.setClass(vs);class ys extends Wt{getFragmentSource(){return`
    precision highp float;
    uniform sampler2D uTexture;
    uniform vec2 uDelta;
    varying vec2 vTexCoord;
    const float nSamples = 15.0;
    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
    float random(vec3 scale) {
      /* use the fragment position for a different seed per-pixel */
      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
    }
    void main() {
      vec4 color = vec4(0.0);
      float total = 0.0;
      float offset = random(v3offset);
      for (float t = -nSamples; t <= nSamples; t++) {
        float percent = (t + offset - 0.5) / nSamples;
        float weight = 1.0 - abs(percent);
        color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
        total += weight;
      }
      gl_FragColor = color / total;
    }
  `}applyTo(t){li(t)?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){t.imageData=this.simpleBlur(t)}simpleBlur(t){let{ctx:e,imageData:r,filterBackend:{resources:s}}=t;const{width:i,height:n}=r;s.blurLayer1||(s.blurLayer1=zt(),s.blurLayer2=zt());const o=s.blurLayer1,a=s.blurLayer2;o.width===i&&o.height===n||(a.width=o.width=i,a.height=o.height=n);const l=o.getContext("2d"),c=a.getContext("2d"),u=15,f=.06*this.blur*.5;let d,m,p,v;for(l.putImageData(r,0,0),c.clearRect(0,0,i,n),v=-15;v<=u;v++)d=(Math.random()-.5)/4,m=v/u,p=f*m*i+d,c.globalAlpha=1-Math.abs(m),c.drawImage(o,p,d),l.drawImage(a,0,0),c.globalAlpha=1,c.clearRect(0,0,a.width,a.height);for(v=-15;v<=u;v++)d=(Math.random()-.5)/4,m=v/u,p=f*m*n+d,c.globalAlpha=1-Math.abs(m),c.drawImage(o,d,p),l.drawImage(a,0,0),c.globalAlpha=1,c.clearRect(0,0,a.width,a.height);e.drawImage(o,0,0);const _=e.getImageData(0,0,o.width,o.height);return l.globalAlpha=1,l.clearRect(0,0,o.width,o.height),_}sendUniformData(t,e){const r=this.chooseRightDelta();t.uniform2fv(e.uDelta,r)}isNeutralState(){return this.blur===0}chooseRightDelta(){let t=1;const e=[0,0];this.horizontal?this.aspectRatio>1&&(t=1/this.aspectRatio):this.aspectRatio<1&&(t=this.aspectRatio);const r=t*this.blur*.12;return this.horizontal?e[0]=r:e[1]=r,e}}O(ys,"type","Blur"),O(ys,"defaults",{blur:0}),O(ys,"uniformLocations",["uDelta"]),rt.setClass(ys);class bs extends Wt{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBrightness;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += uBrightness;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;const r=Math.round(255*this.brightness);for(let s=0;s<e.length;s+=4)e[s]=e[s]+r,e[s+1]=e[s+1]+r,e[s+2]=e[s+2]+r}isNeutralState(){return this.brightness===0}sendUniformData(t,e){t.uniform1f(e.uBrightness,this.brightness)}}O(bs,"type","Brightness"),O(bs,"defaults",{brightness:0}),O(bs,"uniformLocations",["uBrightness"]),rt.setClass(bs);class kr extends Wt{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  varying vec2 vTexCoord;
  uniform mat4 uColorMatrix;
  uniform vec4 uConstants;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color *= uColorMatrix;
    color += uConstants;
    gl_FragColor = color;
  }`}applyTo2d(t){const e=t.imageData.data,r=this.matrix,s=this.colorsOnly;for(let i=0;i<e.length;i+=4){const n=e[i],o=e[i+1],a=e[i+2];if(s)e[i]=n*r[0]+o*r[1]+a*r[2]+255*r[4],e[i+1]=n*r[5]+o*r[6]+a*r[7]+255*r[9],e[i+2]=n*r[10]+o*r[11]+a*r[12]+255*r[14];else{const l=e[i+3];e[i]=n*r[0]+o*r[1]+a*r[2]+l*r[3]+255*r[4],e[i+1]=n*r[5]+o*r[6]+a*r[7]+l*r[8]+255*r[9],e[i+2]=n*r[10]+o*r[11]+a*r[12]+l*r[13]+255*r[14],e[i+3]=n*r[15]+o*r[16]+a*r[17]+l*r[18]+255*r[19]}}}sendUniformData(t,e){const r=this.matrix,s=[r[0],r[1],r[2],r[3],r[5],r[6],r[7],r[8],r[10],r[11],r[12],r[13],r[15],r[16],r[17],r[18]],i=[r[4],r[9],r[14],r[19]];t.uniformMatrix4fv(e.uColorMatrix,!1,s),t.uniform4fv(e.uConstants,i)}toObject(){return D(D({},super.toObject()),{},{matrix:[...this.matrix]})}}function cr(h,t){var e;const r=(O(e=class extends kr{toObject(){return{type:this.type,colorsOnly:this.colorsOnly}}},"type",h),O(e,"defaults",{colorsOnly:!1,matrix:t}),e);return rt.setClass(r,h),r}O(kr,"type","ColorMatrix"),O(kr,"defaults",{matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],colorsOnly:!0}),O(kr,"uniformLocations",["uColorMatrix","uConstants"]),rt.setClass(kr);cr("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]);cr("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]);cr("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]);cr("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]);cr("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]);cr("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]);cr("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);class po extends Wt{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(t),this.subFilters=t.subFilters||[]}applyTo(t){li(t)&&(t.passes+=this.subFilters.length-1),this.subFilters.forEach(e=>{e.applyTo(t)})}toObject(){return{type:this.type,subFilters:this.subFilters.map(t=>t.toObject())}}isNeutralState(){return!this.subFilters.some(t=>!t.isNeutralState())}static fromObject(t,e){return Promise.all((t.subFilters||[]).map(r=>rt.getClass(r.type).fromObject(r,e))).then(r=>new this({subFilters:r}))}}O(po,"type","Composed"),rt.setClass(po);class xs extends Wt{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uContrast;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
    gl_FragColor = color;
  }`}isNeutralState(){return this.contrast===0}applyTo2d(t){let{imageData:{data:e}}=t;const r=Math.floor(255*this.contrast),s=259*(r+255)/(255*(259-r));for(let i=0;i<e.length;i+=4)e[i]=s*(e[i]-128)+128,e[i+1]=s*(e[i+1]-128)+128,e[i+2]=s*(e[i+2]-128)+128}sendUniformData(t,e){t.uniform1f(e.uContrast,this.contrast)}}O(xs,"type","Contrast"),O(xs,"defaults",{contrast:0}),O(xs,"uniformLocations",["uContrast"]),rt.setClass(xs);const vc={Convolute_3_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_3_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_5_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_5_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_7_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_7_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_9_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_9_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `};class ws extends Wt{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return vc[this.getCacheKey()]}applyTo2d(t){const e=t.imageData,r=e.data,s=this.matrix,i=Math.round(Math.sqrt(s.length)),n=Math.floor(i/2),o=e.width,a=e.height,l=t.ctx.createImageData(o,a),c=l.data,u=this.opaque?1:0;let f,d,m,p,v,_,b,C,k,T,P,A,I;for(P=0;P<a;P++)for(T=0;T<o;T++){for(v=4*(P*o+T),f=0,d=0,m=0,p=0,I=0;I<i;I++)for(A=0;A<i;A++)b=P+I-n,_=T+A-n,b<0||b>=a||_<0||_>=o||(C=4*(b*o+_),k=s[I*i+A],f+=r[C]*k,d+=r[C+1]*k,m+=r[C+2]*k,u||(p+=r[C+3]*k));c[v]=f,c[v+1]=d,c[v+2]=m,c[v+3]=u?r[v+3]:p}t.imageData=l}sendUniformData(t,e){t.uniform1fv(e.uMatrix,this.matrix)}toObject(){return D(D({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}O(ws,"type","Convolute"),O(ws,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),O(ws,"uniformLocations",["uMatrix","uOpaque","uHalfSize","uSize"]),rt.setClass(ws);const wa="Gamma";class Cs extends Wt{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform vec3 uGamma;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    vec3 correction = (1.0 / uGamma);
    color.r = pow(color.r, correction.r);
    color.g = pow(color.g, correction.g);
    color.b = pow(color.b, correction.b);
    gl_FragColor = color;
    gl_FragColor.rgb *= color.a;
  }
`}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(t),this.gamma=t.gamma||this.constructor.defaults.gamma.concat()}applyTo2d(t){let{imageData:{data:e}}=t;const r=this.gamma,s=1/r[0],i=1/r[1],n=1/r[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});const o=this.rgbValues;for(let a=0;a<256;a++)o.r[a]=255*Math.pow(a/255,s),o.g[a]=255*Math.pow(a/255,i),o.b[a]=255*Math.pow(a/255,n);for(let a=0;a<e.length;a+=4)e[a]=o.r[e[a]],e[a+1]=o.g[e[a+1]],e[a+2]=o.b[e[a+2]]}sendUniformData(t,e){t.uniform3fv(e.uGamma,this.gamma)}isNeutralState(){const{gamma:t}=this;return t[0]===1&&t[1]===1&&t[2]===1}toObject(){return{type:wa,gamma:this.gamma.concat()}}}O(Cs,"type",wa),O(Cs,"defaults",{gamma:[1,1,1]}),O(Cs,"uniformLocations",["uGamma"]),rt.setClass(Cs);const yc={average:`
    precision highp float;
    uniform sampler2D uTexture;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      float average = (color.r + color.b + color.g) / 3.0;
      gl_FragColor = vec4(average, average, average, color.a);
    }
    `,lightness:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `,luminosity:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `};class Ss extends Wt{applyTo2d(t){let{imageData:{data:e}}=t;for(let r,s=0;s<e.length;s+=4){switch(this.mode){case"average":r=(e[s]+e[s+1]+e[s+2])/3;break;case"lightness":r=(Math.min(e[s],e[s+1],e[s+2])+Math.max(e[s],e[s+1],e[s+2]))/2;break;case"luminosity":r=.21*e[s]+.72*e[s+1]+.07*e[s+2]}e[s]=r,e[s+1]=r,e[s+2]=r}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return yc[this.mode]}sendUniformData(t,e){t.uniform1i(e.uMode,1)}isNeutralState(){return!1}}O(Ss,"type","Grayscale"),O(Ss,"defaults",{mode:"average"}),O(Ss,"uniformLocations",["uMode"]),rt.setClass(Ss);class Di extends kr{calculateMatrix(){const t=this.rotation*Math.PI,e=je(t),r=Fe(t),s=1/3,i=Math.sqrt(s)*r,n=1-e;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=e+n/3,this.matrix[1]=s*n-i,this.matrix[2]=s*n+i,this.matrix[5]=s*n+i,this.matrix[6]=e+s*n,this.matrix[7]=s*n-i,this.matrix[10]=s*n-i,this.matrix[11]=s*n+i,this.matrix[12]=e+s*n}isNeutralState(){return this.rotation===0}applyTo(t){this.calculateMatrix(),super.applyTo(t)}toObject(){return{type:this.type,rotation:this.rotation}}}O(Di,"type","HueRotation"),O(Di,"defaults",{rotation:0}),rt.setClass(Di);class Ts extends Wt{applyTo2d(t){let{imageData:{data:e}}=t;for(let r=0;r<e.length;r+=4)e[r]=255-e[r],e[r+1]=255-e[r+1],e[r+2]=255-e[r+2],this.alpha&&(e[r+3]=255-e[r+3])}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform int uInvert;
  uniform int uAlpha;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    if (uInvert == 1) {
      if (uAlpha == 1) {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);
      } else {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
      }
    } else {
      gl_FragColor = color;
    }
  }
`}isNeutralState(){return!this.invert}sendUniformData(t,e){t.uniform1i(e.uInvert,Number(this.invert)),t.uniform1i(e.uAlpha,Number(this.alpha))}}O(Ts,"type","Invert"),O(Ts,"defaults",{alpha:!1,invert:!0}),O(Ts,"uniformLocations",["uInvert","uAlpha"]),rt.setClass(Ts);class ks extends Wt{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uStepH;
  uniform float uNoise;
  uniform float uSeed;
  varying vec2 vTexCoord;
  float rand(vec2 co, float seed, float vScale) {
    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
  }
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;const r=this.noise;for(let s=0;s<e.length;s+=4){const i=(.5-Math.random())*r;e[s]+=i,e[s+1]+=i,e[s+2]+=i}}sendUniformData(t,e){t.uniform1f(e.uNoise,this.noise/255),t.uniform1f(e.uSeed,Math.random())}isNeutralState(){return this.noise===0}}O(ks,"type","Noise"),O(ks,"defaults",{noise:0}),O(ks,"uniformLocations",["uNoise","uSeed"]),rt.setClass(ks);class Os extends Wt{applyTo2d(t){let{imageData:{data:e,width:r,height:s}}=t;for(let i=0;i<s;i+=this.blocksize)for(let n=0;n<r;n+=this.blocksize){const o=4*i*r+4*n,a=e[o],l=e[o+1],c=e[o+2],u=e[o+3];for(let f=i;f<Math.min(i+this.blocksize,s);f++)for(let d=n;d<Math.min(n+this.blocksize,r);d++){const m=4*f*r+4*d;e[m]=a,e[m+1]=l,e[m+2]=c,e[m+3]=u}}}isNeutralState(){return this.blocksize===1}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBlocksize;
  uniform float uStepW;
  uniform float uStepH;
  varying vec2 vTexCoord;
  void main() {
    float blockW = uBlocksize * uStepW;
    float blockH = uBlocksize * uStepH;
    int posX = int(vTexCoord.x / blockW);
    int posY = int(vTexCoord.y / blockH);
    float fposX = float(posX);
    float fposY = float(posY);
    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
    vec4 color = texture2D(uTexture, squareCoords);
    gl_FragColor = color;
  }
`}sendUniformData(t,e){t.uniform1f(e.uBlocksize,this.blocksize)}}O(Os,"type","Pixelate"),O(Os,"defaults",{blocksize:4}),O(Os,"uniformLocations",["uBlocksize"]),rt.setClass(Os);class Ds extends Wt{getFragmentSource(){return`
precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
  gl_FragColor = texture2D(uTexture, vTexCoord);
  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
    gl_FragColor.a = 0.0;
  }
}
`}applyTo2d(t){let{imageData:{data:e}}=t;const r=255*this.distance,s=new Ot(this.color).getSource(),i=[s[0]-r,s[1]-r,s[2]-r],n=[s[0]+r,s[1]+r,s[2]+r];for(let o=0;o<e.length;o+=4){const a=e[o],l=e[o+1],c=e[o+2];a>i[0]&&l>i[1]&&c>i[2]&&a<n[0]&&l<n[1]&&c<n[2]&&(e[o+3]=0)}}sendUniformData(t,e){const r=new Ot(this.color).getSource(),s=this.distance,i=[0+r[0]/255-s,0+r[1]/255-s,0+r[2]/255-s,1],n=[r[0]/255+s,r[1]/255+s,r[2]/255+s,1];t.uniform4fv(e.uLow,i),t.uniform4fv(e.uHigh,n)}}O(Ds,"type","RemoveColor"),O(Ds,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),O(Ds,"uniformLocations",["uLow","uHigh"]),rt.setClass(Ds);class Es extends Wt{sendUniformData(t,e){t.uniform2fv(e.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),t.uniform1fv(e.uTaps,this.taps)}getFilterWindow(){const t=this.tempScale;return Math.ceil(this.lanczosLobes/t)}getCacheKey(){const t=this.getFilterWindow();return"".concat(this.type,"_").concat(t)}getFragmentSource(){const t=this.getFilterWindow();return this.generateShader(t)}getTaps(){const t=this.lanczosCreate(this.lanczosLobes),e=this.tempScale,r=this.getFilterWindow(),s=new Array(r);for(let i=1;i<=r;i++)s[i-1]=t(i*e);return s}generateShader(t){const e=new Array(t);for(let r=1;r<=t;r++)e[r-1]="".concat(r,".0 * uDelta");return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec2 uDelta;
      varying vec2 vTexCoord;
      uniform float uTaps[`.concat(t,`];
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        float sum = 1.0;
        `).concat(e.map((r,s)=>`
              color += texture2D(uTexture, vTexCoord + `.concat(r,") * uTaps[").concat(s,"] + texture2D(uTexture, vTexCoord - ").concat(r,") * uTaps[").concat(s,`];
              sum += 2.0 * uTaps[`).concat(s,`];
            `)).join(`
`),`
        gl_FragColor = color / sum;
      }
    `)}applyToForWebgl(t){t.passes++,this.width=t.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=t.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),t.destinationWidth=this.dW,super.applyTo(t),t.sourceWidth=t.destinationWidth,this.height=t.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),t.destinationHeight=this.dH,super.applyTo(t),t.sourceHeight=t.destinationHeight}applyTo(t){li(t)?this.applyToForWebgl(t):this.applyTo2d(t)}isNeutralState(){return this.scaleX===1&&this.scaleY===1}lanczosCreate(t){return e=>{if(e>=t||e<=-t)return 0;if(e<11920929e-14&&e>-11920929e-14)return 1;const r=(e*=Math.PI)/t;return Math.sin(e)/e*Math.sin(r)/r}}applyTo2d(t){const e=t.imageData,r=this.scaleX,s=this.scaleY;this.rcpScaleX=1/r,this.rcpScaleY=1/s;const i=e.width,n=e.height,o=Math.round(i*r),a=Math.round(n*s);let l;l=this.resizeType==="sliceHack"?this.sliceByTwo(t,i,n,o,a):this.resizeType==="hermite"?this.hermiteFastResize(t,i,n,o,a):this.resizeType==="bilinear"?this.bilinearFiltering(t,i,n,o,a):this.resizeType==="lanczos"?this.lanczosResize(t,i,n,o,a):new ImageData(o,a),t.imageData=l}sliceByTwo(t,e,r,s,i){const n=t.imageData,o=.5;let a=!1,l=!1,c=e*o,u=r*o;const f=t.filterBackend.resources;let d=0,m=0;const p=e;let v=0;f.sliceByTwo||(f.sliceByTwo=zt());const _=f.sliceByTwo;(_.width<1.5*e||_.height<r)&&(_.width=1.5*e,_.height=r);const b=_.getContext("2d");for(b.clearRect(0,0,1.5*e,r),b.putImageData(n,0,0),s=Math.floor(s),i=Math.floor(i);!a||!l;)e=c,r=u,s<Math.floor(c*o)?c=Math.floor(c*o):(c=s,a=!0),i<Math.floor(u*o)?u=Math.floor(u*o):(u=i,l=!0),b.drawImage(_,d,m,e,r,p,v,c,u),d=p,m=v,v+=u;return b.getImageData(d,m,s,i)}lanczosResize(t,e,r,s,i){const n=t.imageData.data,o=t.ctx.createImageData(s,i),a=o.data,l=this.lanczosCreate(this.lanczosLobes),c=this.rcpScaleX,u=this.rcpScaleY,f=2/this.rcpScaleX,d=2/this.rcpScaleY,m=Math.ceil(c*this.lanczosLobes/2),p=Math.ceil(u*this.lanczosLobes/2),v={},_={x:0,y:0},b={x:0,y:0};return function C(k){let T,P,A,I,j,U,$,S,F,y,W;for(_.x=(k+.5)*c,b.x=Math.floor(_.x),T=0;T<i;T++){for(_.y=(T+.5)*u,b.y=Math.floor(_.y),j=0,U=0,$=0,S=0,F=0,P=b.x-m;P<=b.x+m;P++)if(!(P<0||P>=e)){y=Math.floor(1e3*Math.abs(P-_.x)),v[y]||(v[y]={});for(let tt=b.y-p;tt<=b.y+p;tt++)tt<0||tt>=r||(W=Math.floor(1e3*Math.abs(tt-_.y)),v[y][W]||(v[y][W]=l(Math.sqrt(Math.pow(y*f,2)+Math.pow(W*d,2))/1e3)),A=v[y][W],A>0&&(I=4*(tt*e+P),j+=A,U+=A*n[I],$+=A*n[I+1],S+=A*n[I+2],F+=A*n[I+3]))}I=4*(T*s+k),a[I]=U/j,a[I+1]=$/j,a[I+2]=S/j,a[I+3]=F/j}return++k<s?C(k):o}(0)}bilinearFiltering(t,e,r,s,i){let n,o,a,l,c,u,f,d,m,p,v,_,b,C=0;const k=this.rcpScaleX,T=this.rcpScaleY,P=4*(e-1),A=t.imageData.data,I=t.ctx.createImageData(s,i),j=I.data;for(f=0;f<i;f++)for(d=0;d<s;d++)for(c=Math.floor(k*d),u=Math.floor(T*f),m=k*d-c,p=T*f-u,b=4*(u*e+c),v=0;v<4;v++)n=A[b+v],o=A[b+4+v],a=A[b+P+v],l=A[b+P+4+v],_=n*(1-m)*(1-p)+o*m*(1-p)+a*p*(1-m)+l*m*p,j[C++]=_;return I}hermiteFastResize(t,e,r,s,i){const n=this.rcpScaleX,o=this.rcpScaleY,a=Math.ceil(n/2),l=Math.ceil(o/2),c=t.imageData.data,u=t.ctx.createImageData(s,i),f=u.data;for(let d=0;d<i;d++)for(let m=0;m<s;m++){const p=4*(m+d*s);let v=0,_=0,b=0,C=0,k=0,T=0,P=0;const A=(d+.5)*o;for(let I=Math.floor(d*o);I<(d+1)*o;I++){const j=Math.abs(A-(I+.5))/l,U=(m+.5)*n,$=j*j;for(let S=Math.floor(m*n);S<(m+1)*n;S++){let F=Math.abs(U-(S+.5))/a;const y=Math.sqrt($+F*F);y>1&&y<-1||(v=2*y*y*y-3*y*y+1,v>0&&(F=4*(S+I*e),P+=v*c[F+3],b+=v,c[F+3]<255&&(v=v*c[F+3]/250),C+=v*c[F],k+=v*c[F+1],T+=v*c[F+2],_+=v))}}f[p]=C/_,f[p+1]=k/_,f[p+2]=T/_,f[p+3]=P/b}return u}}O(Es,"type","Resize"),O(Es,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3}),O(Es,"uniformLocations",["uDelta","uTaps"]),rt.setClass(Es);class As extends Wt{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uSaturation;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float rgMax = max(color.r, color.g);
    float rgbMax = max(rgMax, color.b);
    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;const r=-this.saturation;for(let s=0;s<e.length;s+=4){const i=Math.max(e[s],e[s+1],e[s+2]);e[s]+=i!==e[s]?(i-e[s])*r:0,e[s+1]+=i!==e[s+1]?(i-e[s+1])*r:0,e[s+2]+=i!==e[s+2]?(i-e[s+2])*r:0}}sendUniformData(t,e){t.uniform1f(e.uSaturation,-this.saturation)}isNeutralState(){return this.saturation===0}}O(As,"type","Saturation"),O(As,"defaults",{saturation:0}),O(As,"uniformLocations",["uSaturation"]),rt.setClass(As);class Ms extends Wt{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uVibrance;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float max = max(color.r, max(color.g, color.b));
    float avg = (color.r + color.g + color.b) / 3.0;
    float amt = (abs(max - avg) * 2.0) * uVibrance;
    color.r += max != color.r ? (max - color.r) * amt : 0.00;
    color.g += max != color.g ? (max - color.g) * amt : 0.00;
    color.b += max != color.b ? (max - color.b) * amt : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;const r=-this.vibrance;for(let s=0;s<e.length;s+=4){const i=Math.max(e[s],e[s+1],e[s+2]),n=(e[s]+e[s+1]+e[s+2])/3,o=2*Math.abs(i-n)/255*r;e[s]+=i!==e[s]?(i-e[s])*o:0,e[s+1]+=i!==e[s+1]?(i-e[s+1])*o:0,e[s+2]+=i!==e[s+2]?(i-e[s+2])*o:0}}sendUniformData(t,e){t.uniform1f(e.uVibrance,-this.vibrance)}isNeutralState(){return this.vibrance===0}}O(Ms,"type","Vibrance"),O(Ms,"defaults",{vibrance:0}),O(Ms,"uniformLocations",["uVibrance"]),rt.setClass(Ms);var Ps=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function bc(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}function js(h){throw new Error('Could not dynamically require "'+h+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ca={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(h,t){(function(e){h.exports=e()})(function(){return function e(r,s,i){function n(l,c){if(!s[l]){if(!r[l]){var u=typeof js=="function"&&js;if(!c&&u)return u(l,!0);if(o)return o(l,!0);var f=new Error("Cannot find module '"+l+"'");throw f.code="MODULE_NOT_FOUND",f}var d=s[l]={exports:{}};r[l][0].call(d.exports,function(m){var p=r[l][1][m];return n(p||m)},d,d.exports,e,r,s,i)}return s[l].exports}for(var o=typeof js=="function"&&js,a=0;a<i.length;a++)n(i[a]);return n}({1:[function(e,r,s){var i=e("./utils"),n=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(a){for(var l,c,u,f,d,m,p,v=[],_=0,b=a.length,C=b,k=i.getTypeOf(a)!=="string";_<a.length;)C=b-_,u=k?(l=a[_++],c=_<b?a[_++]:0,_<b?a[_++]:0):(l=a.charCodeAt(_++),c=_<b?a.charCodeAt(_++):0,_<b?a.charCodeAt(_++):0),f=l>>2,d=(3&l)<<4|c>>4,m=1<C?(15&c)<<2|u>>6:64,p=2<C?63&u:64,v.push(o.charAt(f)+o.charAt(d)+o.charAt(m)+o.charAt(p));return v.join("")},s.decode=function(a){var l,c,u,f,d,m,p=0,v=0,_="data:";if(a.substr(0,_.length)===_)throw new Error("Invalid base64 input, it looks like a data url.");var b,C=3*(a=a.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(a.charAt(a.length-1)===o.charAt(64)&&C--,a.charAt(a.length-2)===o.charAt(64)&&C--,C%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=n.uint8array?new Uint8Array(0|C):new Array(0|C);p<a.length;)l=o.indexOf(a.charAt(p++))<<2|(f=o.indexOf(a.charAt(p++)))>>4,c=(15&f)<<4|(d=o.indexOf(a.charAt(p++)))>>2,u=(3&d)<<6|(m=o.indexOf(a.charAt(p++))),b[v++]=l,d!==64&&(b[v++]=c),m!==64&&(b[v++]=u);return b}},{"./support":30,"./utils":32}],2:[function(e,r,s){var i=e("./external"),n=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),a=e("./stream/DataLengthProbe");function l(c,u,f,d,m){this.compressedSize=c,this.uncompressedSize=u,this.crc32=f,this.compression=d,this.compressedContent=m}l.prototype={getContentWorker:function(){var c=new n(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),u=this;return c.on("end",function(){if(this.streamInfo.data_length!==u.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),c},getCompressedWorker:function(){return new n(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(c,u,f){return c.pipe(new o).pipe(new a("uncompressedSize")).pipe(u.compressWorker(f)).pipe(new a("compressedSize")).withStreamInfo("compression",u)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,r,s){var i=e("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},s.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,r,s){var i=e("./utils"),n=function(){for(var o,a=[],l=0;l<256;l++){o=l;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;a[l]=o}return a}();r.exports=function(o,a){return o!==void 0&&o.length?i.getTypeOf(o)!=="string"?function(l,c,u,f){var d=n,m=f+u;l^=-1;for(var p=f;p<m;p++)l=l>>>8^d[255&(l^c[p])];return-1^l}(0|a,o,o.length,0):function(l,c,u,f){var d=n,m=f+u;l^=-1;for(var p=f;p<m;p++)l=l>>>8^d[255&(l^c.charCodeAt(p))];return-1^l}(0|a,o,o.length,0):0}},{"./utils":32}],5:[function(e,r,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(e,r,s){var i=null;i=typeof Promise<"u"?Promise:e("lie"),r.exports={Promise:i}},{lie:37}],7:[function(e,r,s){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",n=e("pako"),o=e("./utils"),a=e("./stream/GenericWorker"),l=i?"uint8array":"array";function c(u,f){a.call(this,"FlateWorker/"+u),this._pako=null,this._pakoAction=u,this._pakoOptions=f,this.meta={}}s.magic="\b\0",o.inherits(c,a),c.prototype.processChunk=function(u){this.meta=u.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(l,u.data),!1)},c.prototype.flush=function(){a.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new n[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var u=this;this._pako.onData=function(f){u.push({data:f,meta:u.meta})}},s.compressWorker=function(u){return new c("Deflate",u)},s.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,r,s){function i(d,m){var p,v="";for(p=0;p<m;p++)v+=String.fromCharCode(255&d),d>>>=8;return v}function n(d,m,p,v,_,b){var C,k,T=d.file,P=d.compression,A=b!==l.utf8encode,I=o.transformTo("string",b(T.name)),j=o.transformTo("string",l.utf8encode(T.name)),U=T.comment,$=o.transformTo("string",b(U)),S=o.transformTo("string",l.utf8encode(U)),F=j.length!==T.name.length,y=S.length!==U.length,W="",tt="",X="",st=T.dir,H=T.date,it={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(it.crc32=d.crc32,it.compressedSize=d.compressedSize,it.uncompressedSize=d.uncompressedSize);var R=0;m&&(R|=8),A||!F&&!y||(R|=2048);var L=0,ot=0;st&&(L|=16),_==="UNIX"?(ot=798,L|=function(G,_t){var wt=G;return G||(wt=_t?16893:33204),(65535&wt)<<16}(T.unixPermissions,st)):(ot=20,L|=function(G){return 63&(G||0)}(T.dosPermissions)),C=H.getUTCHours(),C<<=6,C|=H.getUTCMinutes(),C<<=5,C|=H.getUTCSeconds()/2,k=H.getUTCFullYear()-1980,k<<=4,k|=H.getUTCMonth()+1,k<<=5,k|=H.getUTCDate(),F&&(tt=i(1,1)+i(c(I),4)+j,W+="up"+i(tt.length,2)+tt),y&&(X=i(1,1)+i(c($),4)+S,W+="uc"+i(X.length,2)+X);var Q="";return Q+=`
\0`,Q+=i(R,2),Q+=P.magic,Q+=i(C,2),Q+=i(k,2),Q+=i(it.crc32,4),Q+=i(it.compressedSize,4),Q+=i(it.uncompressedSize,4),Q+=i(I.length,2),Q+=i(W.length,2),{fileRecord:u.LOCAL_FILE_HEADER+Q+I+W,dirRecord:u.CENTRAL_FILE_HEADER+i(ot,2)+Q+i($.length,2)+"\0\0\0\0"+i(L,4)+i(v,4)+I+W+$}}var o=e("../utils"),a=e("../stream/GenericWorker"),l=e("../utf8"),c=e("../crc32"),u=e("../signature");function f(d,m,p,v){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=v,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(f,a),f.prototype.push=function(d){var m=d.meta.percent||0,p=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,a.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-v-1))/p:100}}))},f.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var m=this.streamFiles&&!d.file.dir;if(m){var p=n(d,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(d){this.accumulate=!1;var m=this.streamFiles&&!d.file.dir,p=n(d,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:function(v){return u.DATA_DESCRIPTOR+i(v.crc32,4)+i(v.compressedSize,4)+i(v.uncompressedSize,4)}(d),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var d=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-d,v=function(_,b,C,k,T){var P=o.transformTo("string",T(k));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(_,2)+i(_,2)+i(b,4)+i(C,4)+i(P.length,2)+P}(this.dirRecords.length,p,d,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(d){this._sources.push(d);var m=this;return d.on("data",function(p){m.processChunk(p)}),d.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),d.on("error",function(p){m.error(p)}),this},f.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(d){var m=this._sources;if(!a.prototype.error.call(this,d))return!1;for(var p=0;p<m.length;p++)try{m[p].error(d)}catch{}return!0},f.prototype.lock=function(){a.prototype.lock.call(this);for(var d=this._sources,m=0;m<d.length;m++)d[m].lock()},r.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,r,s){var i=e("../compressions"),n=e("./ZipFileWorker");s.generateWorker=function(o,a,l){var c=new n(a.streamFiles,l,a.platform,a.encodeFileName),u=0;try{o.forEach(function(f,d){u++;var m=function(b,C){var k=b||C,T=i[k];if(!T)throw new Error(k+" is not a valid compression method !");return T}(d.options.compression,a.compression),p=d.options.compressionOptions||a.compressionOptions||{},v=d.dir,_=d.date;d._compressWorker(m,p).withStreamInfo("file",{name:f,dir:v,date:_,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(c)}),c.entriesCount=u}catch(f){c.error(f)}return c}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,r,s){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var n=new i;for(var o in this)typeof this[o]!="function"&&(n[o]=this[o]);return n}}(i.prototype=e("./object")).loadAsync=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.version="3.10.1",i.loadAsync=function(n,o){return new i().loadAsync(n,o)},i.external=e("./external"),r.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,r,s){var i=e("./utils"),n=e("./external"),o=e("./utf8"),a=e("./zipEntries"),l=e("./stream/Crc32Probe"),c=e("./nodejsUtils");function u(f){return new n.Promise(function(d,m){var p=f.decompressed.getContentWorker().pipe(new l);p.on("error",function(v){m(v)}).on("end",function(){p.streamInfo.crc32!==f.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}r.exports=function(f,d){var m=this;return d=i.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),c.isNode&&c.isStream(f)?n.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",f,!0,d.optimizedBinaryString,d.base64).then(function(p){var v=new a(d);return v.load(p),v}).then(function(p){var v=[n.Promise.resolve(p)],_=p.files;if(d.checkCRC32)for(var b=0;b<_.length;b++)v.push(u(_[b]));return n.Promise.all(v)}).then(function(p){for(var v=p.shift(),_=v.files,b=0;b<_.length;b++){var C=_[b],k=C.fileNameStr,T=i.resolve(C.fileNameStr);m.file(T,C.decompressed,{binary:!0,optimizedBinaryString:!0,date:C.date,dir:C.dir,comment:C.fileCommentStr.length?C.fileCommentStr:null,unixPermissions:C.unixPermissions,dosPermissions:C.dosPermissions,createFolders:d.createFolders}),C.dir||(m.file(T).unsafeOriginalName=k)}return v.zipComment.length&&(m.comment=v.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,r,s){var i=e("../utils"),n=e("../stream/GenericWorker");function o(a,l){n.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(l)}i.inherits(o,n),o.prototype._bindStream=function(a){var l=this;(this._stream=a).pause(),a.on("data",function(c){l.push({data:c,meta:{percent:0}})}).on("error",function(c){l.isPaused?this.generatedError=c:l.error(c)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},o.prototype.pause=function(){return!!n.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,r,s){var i=e("readable-stream").Readable;function n(o,a,l){i.call(this,a),this._helper=o;var c=this;o.on("data",function(u,f){c.push(u)||c._helper.pause(),l&&l(f)}).on("error",function(u){c.emit("error",u)}).on("end",function(){c.push(null)})}e("../utils").inherits(n,i),n.prototype._read=function(){this._helper.resume()},r.exports=n},{"../utils":32,"readable-stream":16}],14:[function(e,r,s){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,n){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,n);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,n)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var n=new Buffer(i);return n.fill(0),n},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(e,r,s){function i(T,P,A){var I,j=o.getTypeOf(P),U=o.extend(A||{},c);U.date=U.date||new Date,U.compression!==null&&(U.compression=U.compression.toUpperCase()),typeof U.unixPermissions=="string"&&(U.unixPermissions=parseInt(U.unixPermissions,8)),U.unixPermissions&&16384&U.unixPermissions&&(U.dir=!0),U.dosPermissions&&16&U.dosPermissions&&(U.dir=!0),U.dir&&(T=_(T)),U.createFolders&&(I=v(T))&&b.call(this,I,!0);var $=j==="string"&&U.binary===!1&&U.base64===!1;A&&A.binary!==void 0||(U.binary=!$),(P instanceof u&&P.uncompressedSize===0||U.dir||!P||P.length===0)&&(U.base64=!1,U.binary=!0,P="",U.compression="STORE",j="string");var S=null;S=P instanceof u||P instanceof a?P:m.isNode&&m.isStream(P)?new p(T,P):o.prepareContent(T,P,U.binary,U.optimizedBinaryString,U.base64);var F=new f(T,S,U);this.files[T]=F}var n=e("./utf8"),o=e("./utils"),a=e("./stream/GenericWorker"),l=e("./stream/StreamHelper"),c=e("./defaults"),u=e("./compressedObject"),f=e("./zipObject"),d=e("./generate"),m=e("./nodejsUtils"),p=e("./nodejs/NodejsStreamInputAdapter"),v=function(T){T.slice(-1)==="/"&&(T=T.substring(0,T.length-1));var P=T.lastIndexOf("/");return 0<P?T.substring(0,P):""},_=function(T){return T.slice(-1)!=="/"&&(T+="/"),T},b=function(T,P){return P=P!==void 0?P:c.createFolders,T=_(T),this.files[T]||i.call(this,T,null,{dir:!0,createFolders:P}),this.files[T]};function C(T){return Object.prototype.toString.call(T)==="[object RegExp]"}var k={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(T){var P,A,I;for(P in this.files)I=this.files[P],(A=P.slice(this.root.length,P.length))&&P.slice(0,this.root.length)===this.root&&T(A,I)},filter:function(T){var P=[];return this.forEach(function(A,I){T(A,I)&&P.push(I)}),P},file:function(T,P,A){if(arguments.length!==1)return T=this.root+T,i.call(this,T,P,A),this;if(C(T)){var I=T;return this.filter(function(U,$){return!$.dir&&I.test(U)})}var j=this.files[this.root+T];return j&&!j.dir?j:null},folder:function(T){if(!T)return this;if(C(T))return this.filter(function(j,U){return U.dir&&T.test(j)});var P=this.root+T,A=b.call(this,P),I=this.clone();return I.root=A.name,I},remove:function(T){T=this.root+T;var P=this.files[T];if(P||(T.slice(-1)!=="/"&&(T+="/"),P=this.files[T]),P&&!P.dir)delete this.files[T];else for(var A=this.filter(function(j,U){return U.name.slice(0,T.length)===T}),I=0;I<A.length;I++)delete this.files[A[I].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(T){var P,A={};try{if((A=o.extend(T||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:n.utf8encode})).type=A.type.toLowerCase(),A.compression=A.compression.toUpperCase(),A.type==="binarystring"&&(A.type="string"),!A.type)throw new Error("No output type specified.");o.checkSupport(A.type),A.platform!=="darwin"&&A.platform!=="freebsd"&&A.platform!=="linux"&&A.platform!=="sunos"||(A.platform="UNIX"),A.platform==="win32"&&(A.platform="DOS");var I=A.comment||this.comment||"";P=d.generateWorker(this,A,I)}catch(j){(P=new a("error")).error(j)}return new l(P,A.type||"string",A.mimeType)},generateAsync:function(T,P){return this.generateInternalStream(T).accumulate(P)},generateNodeStream:function(T,P){return(T=T||{}).type||(T.type="nodebuffer"),this.generateInternalStream(T).toNodejsStream(P)}};r.exports=k},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,r,s){r.exports=e("stream")},{stream:void 0}],17:[function(e,r,s){var i=e("./DataReader");function n(o){i.call(this,o);for(var a=0;a<this.data.length;a++)o[a]=255&o[a]}e("../utils").inherits(n,i),n.prototype.byteAt=function(o){return this.data[this.zero+o]},n.prototype.lastIndexOfSignature=function(o){for(var a=o.charCodeAt(0),l=o.charCodeAt(1),c=o.charCodeAt(2),u=o.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===a&&this.data[f+1]===l&&this.data[f+2]===c&&this.data[f+3]===u)return f-this.zero;return-1},n.prototype.readAndCheckSignature=function(o){var a=o.charCodeAt(0),l=o.charCodeAt(1),c=o.charCodeAt(2),u=o.charCodeAt(3),f=this.readData(4);return a===f[0]&&l===f[1]&&c===f[2]&&u===f[3]},n.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},r.exports=n},{"../utils":32,"./DataReader":18}],18:[function(e,r,s){var i=e("../utils");function n(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}n.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var a,l=0;for(this.checkOffset(o),a=this.index+o-1;a>=this.index;a--)l=(l<<8)+this.byteAt(a);return this.index+=o,l},readString:function(o){return i.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},r.exports=n},{"../utils":32}],19:[function(e,r,s){var i=e("./Uint8ArrayReader");function n(o){i.call(this,o)}e("../utils").inherits(n,i),n.prototype.readData=function(o){this.checkOffset(o);var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},r.exports=n},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,r,s){var i=e("./DataReader");function n(o){i.call(this,o)}e("../utils").inherits(n,i),n.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},n.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},n.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},n.prototype.readData=function(o){this.checkOffset(o);var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},r.exports=n},{"../utils":32,"./DataReader":18}],21:[function(e,r,s){var i=e("./ArrayReader");function n(o){i.call(this,o)}e("../utils").inherits(n,i),n.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var a=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},r.exports=n},{"../utils":32,"./ArrayReader":17}],22:[function(e,r,s){var i=e("../utils"),n=e("../support"),o=e("./ArrayReader"),a=e("./StringReader"),l=e("./NodeBufferReader"),c=e("./Uint8ArrayReader");r.exports=function(u){var f=i.getTypeOf(u);return i.checkSupport(f),f!=="string"||n.uint8array?f==="nodebuffer"?new l(u):n.uint8array?new c(i.transformTo("uint8array",u)):new o(i.transformTo("array",u)):new a(u)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,r,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,r,s){var i=e("./GenericWorker"),n=e("../utils");function o(a){i.call(this,"ConvertWorker to "+a),this.destType=a}n.inherits(o,i),o.prototype.processChunk=function(a){this.push({data:n.transformTo(this.destType,a.data),meta:a.meta})},r.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,r,s){var i=e("./GenericWorker"),n=e("../crc32");function o(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,i),o.prototype.processChunk=function(a){this.streamInfo.crc32=n(a.data,this.streamInfo.crc32||0),this.push(a)},r.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,r,s){var i=e("../utils"),n=e("./GenericWorker");function o(a){n.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}i.inherits(o,n),o.prototype.processChunk=function(a){if(a){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+a.data.length}n.prototype.processChunk.call(this,a)},r.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,r,s){var i=e("../utils"),n=e("./GenericWorker");function o(a){n.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(c){l.dataIsReady=!0,l.data=c,l.max=c&&c.length||0,l.type=i.getTypeOf(c),l.isPaused||l._tickAndRepeat()},function(c){l.error(c)})}i.inherits(o,n),o.prototype.cleanUp=function(){n.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":a=this.data.substring(this.index,l);break;case"uint8array":a=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":a=this.data.slice(this.index,l)}return this.index=l,this.push({data:a,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,r,s){function i(n){this.name=n||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(n){this.emit("data",n)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(n){this.emit("error",n)}return!0},error:function(n){return!this.isFinished&&(this.isPaused?this.generatedError=n:(this.isFinished=!0,this.emit("error",n),this.previous&&this.previous.error(n),this.cleanUp()),!0)},on:function(n,o){return this._listeners[n].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(n,o){if(this._listeners[n])for(var a=0;a<this._listeners[n].length;a++)this._listeners[n][a].call(this,o)},pipe:function(n){return n.registerPrevious(this)},registerPrevious:function(n){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=n.streamInfo,this.mergeStreamInfo(),this.previous=n;var o=this;return n.on("data",function(a){o.processChunk(a)}),n.on("end",function(){o.end()}),n.on("error",function(a){o.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var n=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),n=!0),this.previous&&this.previous.resume(),!n},flush:function(){},processChunk:function(n){this.push(n)},withStreamInfo:function(n,o){return this.extraStreamInfo[n]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var n in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,n)&&(this.streamInfo[n]=this.extraStreamInfo[n])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var n="Worker "+this.name;return this.previous?this.previous+" -> "+n:n}},r.exports=i},{}],29:[function(e,r,s){var i=e("../utils"),n=e("./ConvertWorker"),o=e("./GenericWorker"),a=e("../base64"),l=e("../support"),c=e("../external"),u=null;if(l.nodestream)try{u=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(m,p){return new c.Promise(function(v,_){var b=[],C=m._internalType,k=m._outputType,T=m._mimeType;m.on("data",function(P,A){b.push(P),p&&p(A)}).on("error",function(P){b=[],_(P)}).on("end",function(){try{var P=function(A,I,j){switch(A){case"blob":return i.newBlob(i.transformTo("arraybuffer",I),j);case"base64":return a.encode(I);default:return i.transformTo(A,I)}}(k,function(A,I){var j,U=0,$=null,S=0;for(j=0;j<I.length;j++)S+=I[j].length;switch(A){case"string":return I.join("");case"array":return Array.prototype.concat.apply([],I);case"uint8array":for($=new Uint8Array(S),j=0;j<I.length;j++)$.set(I[j],U),U+=I[j].length;return $;case"nodebuffer":return Buffer.concat(I);default:throw new Error("concat : unsupported type '"+A+"'")}}(C,b),T);v(P)}catch(A){_(A)}b=[]}).resume()})}function d(m,p,v){var _=p;switch(p){case"blob":case"arraybuffer":_="uint8array";break;case"base64":_="string"}try{this._internalType=_,this._outputType=p,this._mimeType=v,i.checkSupport(_),this._worker=m.pipe(new n(_)),m.lock()}catch(b){this._worker=new o("error"),this._worker.error(b)}}d.prototype={accumulate:function(m){return f(this,m)},on:function(m,p){var v=this;return m==="data"?this._worker.on(m,function(_){p.call(v,_.data,_.meta)}):this._worker.on(m,function(){i.delay(p,arguments,v)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:this._outputType!=="nodebuffer"},m)}},r.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,r,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",s.nodebuffer=typeof Buffer<"u",s.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")s.blob=!1;else{var i=new ArrayBuffer(0);try{s.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);n.append(i),s.blob=n.getBlob("application/zip").size===0}catch{s.blob=!1}}}try{s.nodestream=!!e("readable-stream").Readable}catch{s.nodestream=!1}},{"readable-stream":16}],31:[function(e,r,s){for(var i=e("./utils"),n=e("./support"),o=e("./nodejsUtils"),a=e("./stream/GenericWorker"),l=new Array(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;l[254]=l[254]=1;function u(){a.call(this,"utf-8 decode"),this.leftOver=null}function f(){a.call(this,"utf-8 encode")}s.utf8encode=function(d){return n.nodebuffer?o.newBufferFrom(d,"utf-8"):function(m){var p,v,_,b,C,k=m.length,T=0;for(b=0;b<k;b++)(64512&(v=m.charCodeAt(b)))==55296&&b+1<k&&(64512&(_=m.charCodeAt(b+1)))==56320&&(v=65536+(v-55296<<10)+(_-56320),b++),T+=v<128?1:v<2048?2:v<65536?3:4;for(p=n.uint8array?new Uint8Array(T):new Array(T),b=C=0;C<T;b++)(64512&(v=m.charCodeAt(b)))==55296&&b+1<k&&(64512&(_=m.charCodeAt(b+1)))==56320&&(v=65536+(v-55296<<10)+(_-56320),b++),v<128?p[C++]=v:(v<2048?p[C++]=192|v>>>6:(v<65536?p[C++]=224|v>>>12:(p[C++]=240|v>>>18,p[C++]=128|v>>>12&63),p[C++]=128|v>>>6&63),p[C++]=128|63&v);return p}(d)},s.utf8decode=function(d){return n.nodebuffer?i.transformTo("nodebuffer",d).toString("utf-8"):function(m){var p,v,_,b,C=m.length,k=new Array(2*C);for(p=v=0;p<C;)if((_=m[p++])<128)k[v++]=_;else if(4<(b=l[_]))k[v++]=65533,p+=b-1;else{for(_&=b===2?31:b===3?15:7;1<b&&p<C;)_=_<<6|63&m[p++],b--;1<b?k[v++]=65533:_<65536?k[v++]=_:(_-=65536,k[v++]=55296|_>>10&1023,k[v++]=56320|1023&_)}return k.length!==v&&(k.subarray?k=k.subarray(0,v):k.length=v),i.applyFromCharCode(k)}(d=i.transformTo(n.uint8array?"uint8array":"array",d))},i.inherits(u,a),u.prototype.processChunk=function(d){var m=i.transformTo(n.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(n.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var v=function(b,C){var k;for((C=C||b.length)>b.length&&(C=b.length),k=C-1;0<=k&&(192&b[k])==128;)k--;return k<0||k===0?C:k+l[b[k]]>C?k:C}(m),_=m;v!==m.length&&(n.uint8array?(_=m.subarray(0,v),this.leftOver=m.subarray(v,m.length)):(_=m.slice(0,v),this.leftOver=m.slice(v,m.length))),this.push({data:s.utf8decode(_),meta:d.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=u,i.inherits(f,a),f.prototype.processChunk=function(d){this.push({data:s.utf8encode(d.data),meta:d.meta})},s.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,r,s){var i=e("./support"),n=e("./base64"),o=e("./nodejsUtils"),a=e("./external");function l(p){return p}function c(p,v){for(var _=0;_<p.length;++_)v[_]=255&p.charCodeAt(_);return v}e("setimmediate"),s.newBlob=function(p,v){s.checkSupport("blob");try{return new Blob([p],{type:v})}catch{try{var _=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return _.append(p),_.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(p,v,_){var b=[],C=0,k=p.length;if(k<=_)return String.fromCharCode.apply(null,p);for(;C<k;)v==="array"||v==="nodebuffer"?b.push(String.fromCharCode.apply(null,p.slice(C,Math.min(C+_,k)))):b.push(String.fromCharCode.apply(null,p.subarray(C,Math.min(C+_,k)))),C+=_;return b.join("")},stringifyByChar:function(p){for(var v="",_=0;_<p.length;_++)v+=String.fromCharCode(p[_]);return v},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function f(p){var v=65536,_=s.getTypeOf(p),b=!0;if(_==="uint8array"?b=u.applyCanBeUsed.uint8array:_==="nodebuffer"&&(b=u.applyCanBeUsed.nodebuffer),b)for(;1<v;)try{return u.stringifyByChunk(p,_,v)}catch{v=Math.floor(v/2)}return u.stringifyByChar(p)}function d(p,v){for(var _=0;_<p.length;_++)v[_]=p[_];return v}s.applyFromCharCode=f;var m={};m.string={string:l,array:function(p){return c(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return c(p,new Uint8Array(p.length))},nodebuffer:function(p){return c(p,o.allocBuffer(p.length))}},m.array={string:f,array:l,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(p)}},m.arraybuffer={string:function(p){return f(new Uint8Array(p))},array:function(p){return d(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:l,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:f,array:function(p){return d(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:l,nodebuffer:function(p){return o.newBufferFrom(p)}},m.nodebuffer={string:f,array:function(p){return d(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return d(p,new Uint8Array(p.length))},nodebuffer:l},s.transformTo=function(p,v){if(v=v||"",!p)return v;s.checkSupport(p);var _=s.getTypeOf(v);return m[_][p](v)},s.resolve=function(p){for(var v=p.split("/"),_=[],b=0;b<v.length;b++){var C=v[b];C==="."||C===""&&b!==0&&b!==v.length-1||(C===".."?_.pop():_.push(C))}return _.join("/")},s.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":i.nodebuffer&&o.isBuffer(p)?"nodebuffer":i.uint8array&&p instanceof Uint8Array?"uint8array":i.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(p){if(!i[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(p){var v,_,b="";for(_=0;_<(p||"").length;_++)b+="\\x"+((v=p.charCodeAt(_))<16?"0":"")+v.toString(16).toUpperCase();return b},s.delay=function(p,v,_){setImmediate(function(){p.apply(_||null,v||[])})},s.inherits=function(p,v){function _(){}_.prototype=v.prototype,p.prototype=new _},s.extend=function(){var p,v,_={};for(p=0;p<arguments.length;p++)for(v in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],v)&&_[v]===void 0&&(_[v]=arguments[p][v]);return _},s.prepareContent=function(p,v,_,b,C){return a.Promise.resolve(v).then(function(k){return i.blob&&(k instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(k))!==-1)&&typeof FileReader<"u"?new a.Promise(function(T,P){var A=new FileReader;A.onload=function(I){T(I.target.result)},A.onerror=function(I){P(I.target.error)},A.readAsArrayBuffer(k)}):k}).then(function(k){var T=s.getTypeOf(k);return T?(T==="arraybuffer"?k=s.transformTo("uint8array",k):T==="string"&&(C?k=n.decode(k):_&&b!==!0&&(k=function(P){return c(P,i.uint8array?new Uint8Array(P.length):new Array(P.length))}(k))),k):a.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,r,s){var i=e("./reader/readerFor"),n=e("./utils"),o=e("./signature"),a=e("./zipEntry"),l=e("./support");function c(u){this.files=[],this.loadOptions=u}c.prototype={checkSignature:function(u){if(!this.reader.readAndCheckSignature(u)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+n.pretty(f)+", expected "+n.pretty(u)+")")}},isSignature:function(u,f){var d=this.reader.index;this.reader.setIndex(u);var m=this.reader.readString(4)===f;return this.reader.setIndex(d),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var u=this.reader.readData(this.zipCommentLength),f=l.uint8array?"uint8array":"array",d=n.transformTo(f,u);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var u,f,d,m=this.zip64EndOfCentralSize-44;0<m;)u=this.reader.readInt(2),f=this.reader.readInt(4),d=this.reader.readData(f),this.zip64ExtensibleData[u]={id:u,length:f,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var u,f;for(u=0;u<this.files.length;u++)f=this.files[u],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var u;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(u=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(u);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var u=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(u<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(u);var f=u;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===n.MAX_VALUE_16BITS||this.diskWithCentralDirStart===n.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===n.MAX_VALUE_16BITS||this.centralDirRecords===n.MAX_VALUE_16BITS||this.centralDirSize===n.MAX_VALUE_32BITS||this.centralDirOffset===n.MAX_VALUE_32BITS){if(this.zip64=!0,(u=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(u),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var m=f-d;if(0<m)this.isSignature(f,o.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(u){this.reader=i(u)},load:function(u){this.prepareReader(u),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,r,s){var i=e("./reader/readerFor"),n=e("./utils"),o=e("./compressedObject"),a=e("./crc32"),l=e("./utf8"),c=e("./compressions"),u=e("./support");function f(d,m){this.options=d,this.loadOptions=m}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var m,p;if(d.skip(22),this.fileNameLength=d.readInt(2),p=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(v){for(var _ in c)if(Object.prototype.hasOwnProperty.call(c,_)&&c[_].magic===v)return c[_];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+n.pretty(this.compressionMethod)+" unknown (inner file : "+n.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,m,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var m=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(m),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=i(this.extraFields[1].value);this.uncompressedSize===n.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===n.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===n.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===n.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var m,p,v,_=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<_;)m=d.readInt(2),p=d.readInt(2),v=d.readData(p),this.extraFields[m]={id:m,length:p,value:v};d.setIndex(_)},handleUTF8:function(){var d=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=n.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var _=n.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(_)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var m=i(d.value);return m.readInt(1)!==1||a(this.fileName)!==m.readInt(4)?null:l.utf8decode(m.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var m=i(d.value);return m.readInt(1)!==1||a(this.fileComment)!==m.readInt(4)?null:l.utf8decode(m.readData(d.length-5))}return null}},r.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,r,s){function i(m,p,v){this.name=m,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=p,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}var n=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),a=e("./utf8"),l=e("./compressedObject"),c=e("./stream/GenericWorker");i.prototype={internalStream:function(m){var p=null,v="string";try{if(!m)throw new Error("No output type specified.");var _=(v=m.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),p=this._decompressWorker();var b=!this._dataBinary;b&&!_&&(p=p.pipe(new a.Utf8EncodeWorker)),!b&&_&&(p=p.pipe(new a.Utf8DecodeWorker))}catch(C){(p=new c("error")).error(C)}return new n(p,v,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof l&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new a.Utf8EncodeWorker)),l.createWorkerFrom(v,m,p)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof c?this._data:new o(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<u.length;d++)i.prototype[u[d]]=f;r.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,r,s){(function(i){var n,o,a=i.MutationObserver||i.WebKitMutationObserver;if(a){var l=0,c=new a(m),u=i.document.createTextNode("");c.observe(u,{characterData:!0}),n=function(){u.data=l=++l%2}}else if(i.setImmediate||i.MessageChannel===void 0)n="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var p=i.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},i.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var f=new i.MessageChannel;f.port1.onmessage=m,n=function(){f.port2.postMessage(0)}}var d=[];function m(){var p,v;o=!0;for(var _=d.length;_;){for(v=d,d=[],p=-1;++p<_;)v[p]();_=d.length}o=!1}r.exports=function(p){d.push(p)!==1||o||n()}}).call(this,typeof Ps<"u"?Ps:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,r,s){var i=e("immediate");function n(){}var o={},a=["REJECTED"],l=["FULFILLED"],c=["PENDING"];function u(_){if(typeof _!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,_!==n&&p(this,_)}function f(_,b,C){this.promise=_,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof C=="function"&&(this.onRejected=C,this.callRejected=this.otherCallRejected)}function d(_,b,C){i(function(){var k;try{k=b(C)}catch(T){return o.reject(_,T)}k===_?o.reject(_,new TypeError("Cannot resolve promise with itself")):o.resolve(_,k)})}function m(_){var b=_&&_.then;if(_&&(typeof _=="object"||typeof _=="function")&&typeof b=="function")return function(){b.apply(_,arguments)}}function p(_,b){var C=!1;function k(A){C||(C=!0,o.reject(_,A))}function T(A){C||(C=!0,o.resolve(_,A))}var P=v(function(){b(T,k)});P.status==="error"&&k(P.value)}function v(_,b){var C={};try{C.value=_(b),C.status="success"}catch(k){C.status="error",C.value=k}return C}(r.exports=u).prototype.finally=function(_){if(typeof _!="function")return this;var b=this.constructor;return this.then(function(C){return b.resolve(_()).then(function(){return C})},function(C){return b.resolve(_()).then(function(){throw C})})},u.prototype.catch=function(_){return this.then(null,_)},u.prototype.then=function(_,b){if(typeof _!="function"&&this.state===l||typeof b!="function"&&this.state===a)return this;var C=new this.constructor(n);return this.state!==c?d(C,this.state===l?_:b,this.outcome):this.queue.push(new f(C,_,b)),C},f.prototype.callFulfilled=function(_){o.resolve(this.promise,_)},f.prototype.otherCallFulfilled=function(_){d(this.promise,this.onFulfilled,_)},f.prototype.callRejected=function(_){o.reject(this.promise,_)},f.prototype.otherCallRejected=function(_){d(this.promise,this.onRejected,_)},o.resolve=function(_,b){var C=v(m,b);if(C.status==="error")return o.reject(_,C.value);var k=C.value;if(k)p(_,k);else{_.state=l,_.outcome=b;for(var T=-1,P=_.queue.length;++T<P;)_.queue[T].callFulfilled(b)}return _},o.reject=function(_,b){_.state=a,_.outcome=b;for(var C=-1,k=_.queue.length;++C<k;)_.queue[C].callRejected(b);return _},u.resolve=function(_){return _ instanceof this?_:o.resolve(new this(n),_)},u.reject=function(_){var b=new this(n);return o.reject(b,_)},u.all=function(_){var b=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=_.length,k=!1;if(!C)return this.resolve([]);for(var T=new Array(C),P=0,A=-1,I=new this(n);++A<C;)j(_[A],A);return I;function j(U,$){b.resolve(U).then(function(S){T[$]=S,++P!==C||k||(k=!0,o.resolve(I,T))},function(S){k||(k=!0,o.reject(I,S))})}},u.race=function(_){var b=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=_.length,k=!1;if(!C)return this.resolve([]);for(var T=-1,P=new this(n);++T<C;)A=_[T],b.resolve(A).then(function(I){k||(k=!0,o.resolve(P,I))},function(I){k||(k=!0,o.reject(P,I))});var A;return P}},{immediate:36}],38:[function(e,r,s){var i={};(0,e("./lib/utils/common").assign)(i,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),r.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,r,s){var i=e("./zlib/deflate"),n=e("./utils/common"),o=e("./utils/strings"),a=e("./zlib/messages"),l=e("./zlib/zstream"),c=Object.prototype.toString,u=0,f=-1,d=0,m=8;function p(_){if(!(this instanceof p))return new p(_);this.options=n.assign({level:f,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},_||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var C=i.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(C!==u)throw new Error(a[C]);if(b.header&&i.deflateSetHeader(this.strm,b.header),b.dictionary){var k;if(k=typeof b.dictionary=="string"?o.string2buf(b.dictionary):c.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(C=i.deflateSetDictionary(this.strm,k))!==u)throw new Error(a[C]);this._dict_set=!0}}function v(_,b){var C=new p(b);if(C.push(_,!0),C.err)throw C.msg||a[C.err];return C.result}p.prototype.push=function(_,b){var C,k,T=this.strm,P=this.options.chunkSize;if(this.ended)return!1;k=b===~~b?b:b===!0?4:0,typeof _=="string"?T.input=o.string2buf(_):c.call(_)==="[object ArrayBuffer]"?T.input=new Uint8Array(_):T.input=_,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new n.Buf8(P),T.next_out=0,T.avail_out=P),(C=i.deflate(T,k))!==1&&C!==u)return this.onEnd(C),!(this.ended=!0);T.avail_out!==0&&(T.avail_in!==0||k!==4&&k!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(n.shrinkBuf(T.output,T.next_out))):this.onData(n.shrinkBuf(T.output,T.next_out)))}while((0<T.avail_in||T.avail_out===0)&&C!==1);return k===4?(C=i.deflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===u):k!==2||(this.onEnd(u),!(T.avail_out=0))},p.prototype.onData=function(_){this.chunks.push(_)},p.prototype.onEnd=function(_){_===u&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},s.Deflate=p,s.deflate=v,s.deflateRaw=function(_,b){return(b=b||{}).raw=!0,v(_,b)},s.gzip=function(_,b){return(b=b||{}).gzip=!0,v(_,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,r,s){var i=e("./zlib/inflate"),n=e("./utils/common"),o=e("./utils/strings"),a=e("./zlib/constants"),l=e("./zlib/messages"),c=e("./zlib/zstream"),u=e("./zlib/gzheader"),f=Object.prototype.toString;function d(p){if(!(this instanceof d))return new d(p);this.options=n.assign({chunkSize:16384,windowBits:0,to:""},p||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||p&&p.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&!(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var _=i.inflateInit2(this.strm,v.windowBits);if(_!==a.Z_OK)throw new Error(l[_]);this.header=new u,i.inflateGetHeader(this.strm,this.header)}function m(p,v){var _=new d(v);if(_.push(p,!0),_.err)throw _.msg||l[_.err];return _.result}d.prototype.push=function(p,v){var _,b,C,k,T,P,A=this.strm,I=this.options.chunkSize,j=this.options.dictionary,U=!1;if(this.ended)return!1;b=v===~~v?v:v===!0?a.Z_FINISH:a.Z_NO_FLUSH,typeof p=="string"?A.input=o.binstring2buf(p):f.call(p)==="[object ArrayBuffer]"?A.input=new Uint8Array(p):A.input=p,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new n.Buf8(I),A.next_out=0,A.avail_out=I),(_=i.inflate(A,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&j&&(P=typeof j=="string"?o.string2buf(j):f.call(j)==="[object ArrayBuffer]"?new Uint8Array(j):j,_=i.inflateSetDictionary(this.strm,P)),_===a.Z_BUF_ERROR&&U===!0&&(_=a.Z_OK,U=!1),_!==a.Z_STREAM_END&&_!==a.Z_OK)return this.onEnd(_),!(this.ended=!0);A.next_out&&(A.avail_out!==0&&_!==a.Z_STREAM_END&&(A.avail_in!==0||b!==a.Z_FINISH&&b!==a.Z_SYNC_FLUSH)||(this.options.to==="string"?(C=o.utf8border(A.output,A.next_out),k=A.next_out-C,T=o.buf2string(A.output,C),A.next_out=k,A.avail_out=I-k,k&&n.arraySet(A.output,A.output,C,k,0),this.onData(T)):this.onData(n.shrinkBuf(A.output,A.next_out)))),A.avail_in===0&&A.avail_out===0&&(U=!0)}while((0<A.avail_in||A.avail_out===0)&&_!==a.Z_STREAM_END);return _===a.Z_STREAM_END&&(b=a.Z_FINISH),b===a.Z_FINISH?(_=i.inflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===a.Z_OK):b!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(A.avail_out=0))},d.prototype.onData=function(p){this.chunks.push(p)},d.prototype.onEnd=function(p){p===a.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},s.Inflate=d,s.inflate=m,s.inflateRaw=function(p,v){return(v=v||{}).raw=!0,m(p,v)},s.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,r,s){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(a){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var c=l.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var u in c)c.hasOwnProperty(u)&&(a[u]=c[u])}}return a},s.shrinkBuf=function(a,l){return a.length===l?a:a.subarray?a.subarray(0,l):(a.length=l,a)};var n={arraySet:function(a,l,c,u,f){if(l.subarray&&a.subarray)a.set(l.subarray(c,c+u),f);else for(var d=0;d<u;d++)a[f+d]=l[c+d]},flattenChunks:function(a){var l,c,u,f,d,m;for(l=u=0,c=a.length;l<c;l++)u+=a[l].length;for(m=new Uint8Array(u),l=f=0,c=a.length;l<c;l++)d=a[l],m.set(d,f),f+=d.length;return m}},o={arraySet:function(a,l,c,u,f){for(var d=0;d<u;d++)a[f+d]=l[c+d]},flattenChunks:function(a){return[].concat.apply([],a)}};s.setTyped=function(a){a?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,n)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,o))},s.setTyped(i)},{}],42:[function(e,r,s){var i=e("./common"),n=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var a=new i.Buf8(256),l=0;l<256;l++)a[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function c(u,f){if(f<65537&&(u.subarray&&o||!u.subarray&&n))return String.fromCharCode.apply(null,i.shrinkBuf(u,f));for(var d="",m=0;m<f;m++)d+=String.fromCharCode(u[m]);return d}a[254]=a[254]=1,s.string2buf=function(u){var f,d,m,p,v,_=u.length,b=0;for(p=0;p<_;p++)(64512&(d=u.charCodeAt(p)))==55296&&p+1<_&&(64512&(m=u.charCodeAt(p+1)))==56320&&(d=65536+(d-55296<<10)+(m-56320),p++),b+=d<128?1:d<2048?2:d<65536?3:4;for(f=new i.Buf8(b),p=v=0;v<b;p++)(64512&(d=u.charCodeAt(p)))==55296&&p+1<_&&(64512&(m=u.charCodeAt(p+1)))==56320&&(d=65536+(d-55296<<10)+(m-56320),p++),d<128?f[v++]=d:(d<2048?f[v++]=192|d>>>6:(d<65536?f[v++]=224|d>>>12:(f[v++]=240|d>>>18,f[v++]=128|d>>>12&63),f[v++]=128|d>>>6&63),f[v++]=128|63&d);return f},s.buf2binstring=function(u){return c(u,u.length)},s.binstring2buf=function(u){for(var f=new i.Buf8(u.length),d=0,m=f.length;d<m;d++)f[d]=u.charCodeAt(d);return f},s.buf2string=function(u,f){var d,m,p,v,_=f||u.length,b=new Array(2*_);for(d=m=0;d<_;)if((p=u[d++])<128)b[m++]=p;else if(4<(v=a[p]))b[m++]=65533,d+=v-1;else{for(p&=v===2?31:v===3?15:7;1<v&&d<_;)p=p<<6|63&u[d++],v--;1<v?b[m++]=65533:p<65536?b[m++]=p:(p-=65536,b[m++]=55296|p>>10&1023,b[m++]=56320|1023&p)}return c(b,m)},s.utf8border=function(u,f){var d;for((f=f||u.length)>u.length&&(f=u.length),d=f-1;0<=d&&(192&u[d])==128;)d--;return d<0||d===0?f:d+a[u[d]]>f?d:f}},{"./common":41}],43:[function(e,r,s){r.exports=function(i,n,o,a){for(var l=65535&i|0,c=i>>>16&65535|0,u=0;o!==0;){for(o-=u=2e3<o?2e3:o;c=c+(l=l+n[a++]|0)|0,--u;);l%=65521,c%=65521}return l|c<<16|0}},{}],44:[function(e,r,s){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,r,s){var i=function(){for(var n,o=[],a=0;a<256;a++){n=a;for(var l=0;l<8;l++)n=1&n?3988292384^n>>>1:n>>>1;o[a]=n}return o}();r.exports=function(n,o,a,l){var c=i,u=l+a;n^=-1;for(var f=l;f<u;f++)n=n>>>8^c[255&(n^o[f])];return-1^n}},{}],46:[function(e,r,s){var i,n=e("../utils/common"),o=e("./trees"),a=e("./adler32"),l=e("./crc32"),c=e("./messages"),u=0,f=4,d=0,m=-2,p=-1,v=4,_=2,b=8,C=9,k=286,T=30,P=19,A=2*k+1,I=15,j=3,U=258,$=U+j+1,S=42,F=113,y=1,W=2,tt=3,X=4;function st(g,N){return g.msg=c[N],N}function H(g){return(g<<1)-(4<g?9:0)}function it(g){for(var N=g.length;0<=--N;)g[N]=0}function R(g){var N=g.state,B=N.pending;B>g.avail_out&&(B=g.avail_out),B!==0&&(n.arraySet(g.output,N.pending_buf,N.pending_out,B,g.next_out),g.next_out+=B,N.pending_out+=B,g.total_out+=B,g.avail_out-=B,N.pending-=B,N.pending===0&&(N.pending_out=0))}function L(g,N){o._tr_flush_block(g,0<=g.block_start?g.block_start:-1,g.strstart-g.block_start,N),g.block_start=g.strstart,R(g.strm)}function ot(g,N){g.pending_buf[g.pending++]=N}function Q(g,N){g.pending_buf[g.pending++]=N>>>8&255,g.pending_buf[g.pending++]=255&N}function G(g,N){var B,w,x=g.max_chain_length,E=g.strstart,Y=g.prev_length,V=g.nice_match,M=g.strstart>g.w_size-$?g.strstart-(g.w_size-$):0,Z=g.window,et=g.w_mask,q=g.prev,lt=g.strstart+U,Tt=Z[E+Y-1],dt=Z[E+Y];g.prev_length>=g.good_match&&(x>>=2),V>g.lookahead&&(V=g.lookahead);do if(Z[(B=N)+Y]===dt&&Z[B+Y-1]===Tt&&Z[B]===Z[E]&&Z[++B]===Z[E+1]){E+=2,B++;do;while(Z[++E]===Z[++B]&&Z[++E]===Z[++B]&&Z[++E]===Z[++B]&&Z[++E]===Z[++B]&&Z[++E]===Z[++B]&&Z[++E]===Z[++B]&&Z[++E]===Z[++B]&&Z[++E]===Z[++B]&&E<lt);if(w=U-(lt-E),E=lt-U,Y<w){if(g.match_start=N,V<=(Y=w))break;Tt=Z[E+Y-1],dt=Z[E+Y]}}while((N=q[N&et])>M&&--x!=0);return Y<=g.lookahead?Y:g.lookahead}function _t(g){var N,B,w,x,E,Y,V,M,Z,et,q=g.w_size;do{if(x=g.window_size-g.lookahead-g.strstart,g.strstart>=q+(q-$)){for(n.arraySet(g.window,g.window,q,q,0),g.match_start-=q,g.strstart-=q,g.block_start-=q,N=B=g.hash_size;w=g.head[--N],g.head[N]=q<=w?w-q:0,--B;);for(N=B=q;w=g.prev[--N],g.prev[N]=q<=w?w-q:0,--B;);x+=q}if(g.strm.avail_in===0)break;if(Y=g.strm,V=g.window,M=g.strstart+g.lookahead,Z=x,et=void 0,et=Y.avail_in,Z<et&&(et=Z),B=et===0?0:(Y.avail_in-=et,n.arraySet(V,Y.input,Y.next_in,et,M),Y.state.wrap===1?Y.adler=a(Y.adler,V,et,M):Y.state.wrap===2&&(Y.adler=l(Y.adler,V,et,M)),Y.next_in+=et,Y.total_in+=et,et),g.lookahead+=B,g.lookahead+g.insert>=j)for(E=g.strstart-g.insert,g.ins_h=g.window[E],g.ins_h=(g.ins_h<<g.hash_shift^g.window[E+1])&g.hash_mask;g.insert&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[E+j-1])&g.hash_mask,g.prev[E&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=E,E++,g.insert--,!(g.lookahead+g.insert<j)););}while(g.lookahead<$&&g.strm.avail_in!==0)}function wt(g,N){for(var B,w;;){if(g.lookahead<$){if(_t(g),g.lookahead<$&&N===u)return y;if(g.lookahead===0)break}if(B=0,g.lookahead>=j&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+j-1])&g.hash_mask,B=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),B!==0&&g.strstart-B<=g.w_size-$&&(g.match_length=G(g,B)),g.match_length>=j)if(w=o._tr_tally(g,g.strstart-g.match_start,g.match_length-j),g.lookahead-=g.match_length,g.match_length<=g.max_lazy_match&&g.lookahead>=j){for(g.match_length--;g.strstart++,g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+j-1])&g.hash_mask,B=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart,--g.match_length!=0;);g.strstart++}else g.strstart+=g.match_length,g.match_length=0,g.ins_h=g.window[g.strstart],g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+1])&g.hash_mask;else w=o._tr_tally(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++;if(w&&(L(g,!1),g.strm.avail_out===0))return y}return g.insert=g.strstart<j-1?g.strstart:j-1,N===f?(L(g,!0),g.strm.avail_out===0?tt:X):g.last_lit&&(L(g,!1),g.strm.avail_out===0)?y:W}function mt(g,N){for(var B,w,x;;){if(g.lookahead<$){if(_t(g),g.lookahead<$&&N===u)return y;if(g.lookahead===0)break}if(B=0,g.lookahead>=j&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+j-1])&g.hash_mask,B=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),g.prev_length=g.match_length,g.prev_match=g.match_start,g.match_length=j-1,B!==0&&g.prev_length<g.max_lazy_match&&g.strstart-B<=g.w_size-$&&(g.match_length=G(g,B),g.match_length<=5&&(g.strategy===1||g.match_length===j&&4096<g.strstart-g.match_start)&&(g.match_length=j-1)),g.prev_length>=j&&g.match_length<=g.prev_length){for(x=g.strstart+g.lookahead-j,w=o._tr_tally(g,g.strstart-1-g.prev_match,g.prev_length-j),g.lookahead-=g.prev_length-1,g.prev_length-=2;++g.strstart<=x&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+j-1])&g.hash_mask,B=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),--g.prev_length!=0;);if(g.match_available=0,g.match_length=j-1,g.strstart++,w&&(L(g,!1),g.strm.avail_out===0))return y}else if(g.match_available){if((w=o._tr_tally(g,0,g.window[g.strstart-1]))&&L(g,!1),g.strstart++,g.lookahead--,g.strm.avail_out===0)return y}else g.match_available=1,g.strstart++,g.lookahead--}return g.match_available&&(w=o._tr_tally(g,0,g.window[g.strstart-1]),g.match_available=0),g.insert=g.strstart<j-1?g.strstart:j-1,N===f?(L(g,!0),g.strm.avail_out===0?tt:X):g.last_lit&&(L(g,!1),g.strm.avail_out===0)?y:W}function vt(g,N,B,w,x){this.good_length=g,this.max_lazy=N,this.nice_length=B,this.max_chain=w,this.func=x}function K(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new n.Buf16(2*A),this.dyn_dtree=new n.Buf16(2*(2*T+1)),this.bl_tree=new n.Buf16(2*(2*P+1)),it(this.dyn_ltree),it(this.dyn_dtree),it(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new n.Buf16(I+1),this.heap=new n.Buf16(2*k+1),it(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new n.Buf16(2*k+1),it(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ct(g){var N;return g&&g.state?(g.total_in=g.total_out=0,g.data_type=_,(N=g.state).pending=0,N.pending_out=0,N.wrap<0&&(N.wrap=-N.wrap),N.status=N.wrap?S:F,g.adler=N.wrap===2?0:1,N.last_flush=u,o._tr_init(N),d):st(g,m)}function ut(g){var N=ct(g);return N===d&&function(B){B.window_size=2*B.w_size,it(B.head),B.max_lazy_match=i[B.level].max_lazy,B.good_match=i[B.level].good_length,B.nice_match=i[B.level].nice_length,B.max_chain_length=i[B.level].max_chain,B.strstart=0,B.block_start=0,B.lookahead=0,B.insert=0,B.match_length=B.prev_length=j-1,B.match_available=0,B.ins_h=0}(g.state),N}function Ct(g,N,B,w,x,E){if(!g)return m;var Y=1;if(N===p&&(N=6),w<0?(Y=0,w=-w):15<w&&(Y=2,w-=16),x<1||C<x||B!==b||w<8||15<w||N<0||9<N||E<0||v<E)return st(g,m);w===8&&(w=9);var V=new K;return(g.state=V).strm=g,V.wrap=Y,V.gzhead=null,V.w_bits=w,V.w_size=1<<V.w_bits,V.w_mask=V.w_size-1,V.hash_bits=x+7,V.hash_size=1<<V.hash_bits,V.hash_mask=V.hash_size-1,V.hash_shift=~~((V.hash_bits+j-1)/j),V.window=new n.Buf8(2*V.w_size),V.head=new n.Buf16(V.hash_size),V.prev=new n.Buf16(V.w_size),V.lit_bufsize=1<<x+6,V.pending_buf_size=4*V.lit_bufsize,V.pending_buf=new n.Buf8(V.pending_buf_size),V.d_buf=1*V.lit_bufsize,V.l_buf=3*V.lit_bufsize,V.level=N,V.strategy=E,V.method=B,ut(g)}i=[new vt(0,0,0,0,function(g,N){var B=65535;for(B>g.pending_buf_size-5&&(B=g.pending_buf_size-5);;){if(g.lookahead<=1){if(_t(g),g.lookahead===0&&N===u)return y;if(g.lookahead===0)break}g.strstart+=g.lookahead,g.lookahead=0;var w=g.block_start+B;if((g.strstart===0||g.strstart>=w)&&(g.lookahead=g.strstart-w,g.strstart=w,L(g,!1),g.strm.avail_out===0)||g.strstart-g.block_start>=g.w_size-$&&(L(g,!1),g.strm.avail_out===0))return y}return g.insert=0,N===f?(L(g,!0),g.strm.avail_out===0?tt:X):(g.strstart>g.block_start&&(L(g,!1),g.strm.avail_out),y)}),new vt(4,4,8,4,wt),new vt(4,5,16,8,wt),new vt(4,6,32,32,wt),new vt(4,4,16,16,mt),new vt(8,16,32,32,mt),new vt(8,16,128,128,mt),new vt(8,32,128,256,mt),new vt(32,128,258,1024,mt),new vt(32,258,258,4096,mt)],s.deflateInit=function(g,N){return Ct(g,N,b,15,8,0)},s.deflateInit2=Ct,s.deflateReset=ut,s.deflateResetKeep=ct,s.deflateSetHeader=function(g,N){return g&&g.state?g.state.wrap!==2?m:(g.state.gzhead=N,d):m},s.deflate=function(g,N){var B,w,x,E;if(!g||!g.state||5<N||N<0)return g?st(g,m):m;if(w=g.state,!g.output||!g.input&&g.avail_in!==0||w.status===666&&N!==f)return st(g,g.avail_out===0?-5:m);if(w.strm=g,B=w.last_flush,w.last_flush=N,w.status===S)if(w.wrap===2)g.adler=0,ot(w,31),ot(w,139),ot(w,8),w.gzhead?(ot(w,(w.gzhead.text?1:0)+(w.gzhead.hcrc?2:0)+(w.gzhead.extra?4:0)+(w.gzhead.name?8:0)+(w.gzhead.comment?16:0)),ot(w,255&w.gzhead.time),ot(w,w.gzhead.time>>8&255),ot(w,w.gzhead.time>>16&255),ot(w,w.gzhead.time>>24&255),ot(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),ot(w,255&w.gzhead.os),w.gzhead.extra&&w.gzhead.extra.length&&(ot(w,255&w.gzhead.extra.length),ot(w,w.gzhead.extra.length>>8&255)),w.gzhead.hcrc&&(g.adler=l(g.adler,w.pending_buf,w.pending,0)),w.gzindex=0,w.status=69):(ot(w,0),ot(w,0),ot(w,0),ot(w,0),ot(w,0),ot(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),ot(w,3),w.status=F);else{var Y=b+(w.w_bits-8<<4)<<8;Y|=(2<=w.strategy||w.level<2?0:w.level<6?1:w.level===6?2:3)<<6,w.strstart!==0&&(Y|=32),Y+=31-Y%31,w.status=F,Q(w,Y),w.strstart!==0&&(Q(w,g.adler>>>16),Q(w,65535&g.adler)),g.adler=1}if(w.status===69)if(w.gzhead.extra){for(x=w.pending;w.gzindex<(65535&w.gzhead.extra.length)&&(w.pending!==w.pending_buf_size||(w.gzhead.hcrc&&w.pending>x&&(g.adler=l(g.adler,w.pending_buf,w.pending-x,x)),R(g),x=w.pending,w.pending!==w.pending_buf_size));)ot(w,255&w.gzhead.extra[w.gzindex]),w.gzindex++;w.gzhead.hcrc&&w.pending>x&&(g.adler=l(g.adler,w.pending_buf,w.pending-x,x)),w.gzindex===w.gzhead.extra.length&&(w.gzindex=0,w.status=73)}else w.status=73;if(w.status===73)if(w.gzhead.name){x=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>x&&(g.adler=l(g.adler,w.pending_buf,w.pending-x,x)),R(g),x=w.pending,w.pending===w.pending_buf_size)){E=1;break}E=w.gzindex<w.gzhead.name.length?255&w.gzhead.name.charCodeAt(w.gzindex++):0,ot(w,E)}while(E!==0);w.gzhead.hcrc&&w.pending>x&&(g.adler=l(g.adler,w.pending_buf,w.pending-x,x)),E===0&&(w.gzindex=0,w.status=91)}else w.status=91;if(w.status===91)if(w.gzhead.comment){x=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>x&&(g.adler=l(g.adler,w.pending_buf,w.pending-x,x)),R(g),x=w.pending,w.pending===w.pending_buf_size)){E=1;break}E=w.gzindex<w.gzhead.comment.length?255&w.gzhead.comment.charCodeAt(w.gzindex++):0,ot(w,E)}while(E!==0);w.gzhead.hcrc&&w.pending>x&&(g.adler=l(g.adler,w.pending_buf,w.pending-x,x)),E===0&&(w.status=103)}else w.status=103;if(w.status===103&&(w.gzhead.hcrc?(w.pending+2>w.pending_buf_size&&R(g),w.pending+2<=w.pending_buf_size&&(ot(w,255&g.adler),ot(w,g.adler>>8&255),g.adler=0,w.status=F)):w.status=F),w.pending!==0){if(R(g),g.avail_out===0)return w.last_flush=-1,d}else if(g.avail_in===0&&H(N)<=H(B)&&N!==f)return st(g,-5);if(w.status===666&&g.avail_in!==0)return st(g,-5);if(g.avail_in!==0||w.lookahead!==0||N!==u&&w.status!==666){var V=w.strategy===2?function(M,Z){for(var et;;){if(M.lookahead===0&&(_t(M),M.lookahead===0)){if(Z===u)return y;break}if(M.match_length=0,et=o._tr_tally(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++,et&&(L(M,!1),M.strm.avail_out===0))return y}return M.insert=0,Z===f?(L(M,!0),M.strm.avail_out===0?tt:X):M.last_lit&&(L(M,!1),M.strm.avail_out===0)?y:W}(w,N):w.strategy===3?function(M,Z){for(var et,q,lt,Tt,dt=M.window;;){if(M.lookahead<=U){if(_t(M),M.lookahead<=U&&Z===u)return y;if(M.lookahead===0)break}if(M.match_length=0,M.lookahead>=j&&0<M.strstart&&(q=dt[lt=M.strstart-1])===dt[++lt]&&q===dt[++lt]&&q===dt[++lt]){Tt=M.strstart+U;do;while(q===dt[++lt]&&q===dt[++lt]&&q===dt[++lt]&&q===dt[++lt]&&q===dt[++lt]&&q===dt[++lt]&&q===dt[++lt]&&q===dt[++lt]&&lt<Tt);M.match_length=U-(Tt-lt),M.match_length>M.lookahead&&(M.match_length=M.lookahead)}if(M.match_length>=j?(et=o._tr_tally(M,1,M.match_length-j),M.lookahead-=M.match_length,M.strstart+=M.match_length,M.match_length=0):(et=o._tr_tally(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++),et&&(L(M,!1),M.strm.avail_out===0))return y}return M.insert=0,Z===f?(L(M,!0),M.strm.avail_out===0?tt:X):M.last_lit&&(L(M,!1),M.strm.avail_out===0)?y:W}(w,N):i[w.level].func(w,N);if(V!==tt&&V!==X||(w.status=666),V===y||V===tt)return g.avail_out===0&&(w.last_flush=-1),d;if(V===W&&(N===1?o._tr_align(w):N!==5&&(o._tr_stored_block(w,0,0,!1),N===3&&(it(w.head),w.lookahead===0&&(w.strstart=0,w.block_start=0,w.insert=0))),R(g),g.avail_out===0))return w.last_flush=-1,d}return N!==f?d:w.wrap<=0?1:(w.wrap===2?(ot(w,255&g.adler),ot(w,g.adler>>8&255),ot(w,g.adler>>16&255),ot(w,g.adler>>24&255),ot(w,255&g.total_in),ot(w,g.total_in>>8&255),ot(w,g.total_in>>16&255),ot(w,g.total_in>>24&255)):(Q(w,g.adler>>>16),Q(w,65535&g.adler)),R(g),0<w.wrap&&(w.wrap=-w.wrap),w.pending!==0?d:1)},s.deflateEnd=function(g){var N;return g&&g.state?(N=g.state.status)!==S&&N!==69&&N!==73&&N!==91&&N!==103&&N!==F&&N!==666?st(g,m):(g.state=null,N===F?st(g,-3):d):m},s.deflateSetDictionary=function(g,N){var B,w,x,E,Y,V,M,Z,et=N.length;if(!g||!g.state||(E=(B=g.state).wrap)===2||E===1&&B.status!==S||B.lookahead)return m;for(E===1&&(g.adler=a(g.adler,N,et,0)),B.wrap=0,et>=B.w_size&&(E===0&&(it(B.head),B.strstart=0,B.block_start=0,B.insert=0),Z=new n.Buf8(B.w_size),n.arraySet(Z,N,et-B.w_size,B.w_size,0),N=Z,et=B.w_size),Y=g.avail_in,V=g.next_in,M=g.input,g.avail_in=et,g.next_in=0,g.input=N,_t(B);B.lookahead>=j;){for(w=B.strstart,x=B.lookahead-(j-1);B.ins_h=(B.ins_h<<B.hash_shift^B.window[w+j-1])&B.hash_mask,B.prev[w&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=w,w++,--x;);B.strstart=w,B.lookahead=j-1,_t(B)}return B.strstart+=B.lookahead,B.block_start=B.strstart,B.insert=B.lookahead,B.lookahead=0,B.match_length=B.prev_length=j-1,B.match_available=0,g.next_in=V,g.input=M,g.avail_in=Y,B.wrap=E,d},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,r,s){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,r,s){r.exports=function(i,n){var o,a,l,c,u,f,d,m,p,v,_,b,C,k,T,P,A,I,j,U,$,S,F,y,W;o=i.state,a=i.next_in,y=i.input,l=a+(i.avail_in-5),c=i.next_out,W=i.output,u=c-(n-i.avail_out),f=c+(i.avail_out-257),d=o.dmax,m=o.wsize,p=o.whave,v=o.wnext,_=o.window,b=o.hold,C=o.bits,k=o.lencode,T=o.distcode,P=(1<<o.lenbits)-1,A=(1<<o.distbits)-1;t:do{C<15&&(b+=y[a++]<<C,C+=8,b+=y[a++]<<C,C+=8),I=k[b&P];e:for(;;){if(b>>>=j=I>>>24,C-=j,(j=I>>>16&255)===0)W[c++]=65535&I;else{if(!(16&j)){if(!(64&j)){I=k[(65535&I)+(b&(1<<j)-1)];continue e}if(32&j){o.mode=12;break t}i.msg="invalid literal/length code",o.mode=30;break t}U=65535&I,(j&=15)&&(C<j&&(b+=y[a++]<<C,C+=8),U+=b&(1<<j)-1,b>>>=j,C-=j),C<15&&(b+=y[a++]<<C,C+=8,b+=y[a++]<<C,C+=8),I=T[b&A];r:for(;;){if(b>>>=j=I>>>24,C-=j,!(16&(j=I>>>16&255))){if(!(64&j)){I=T[(65535&I)+(b&(1<<j)-1)];continue r}i.msg="invalid distance code",o.mode=30;break t}if($=65535&I,C<(j&=15)&&(b+=y[a++]<<C,(C+=8)<j&&(b+=y[a++]<<C,C+=8)),d<($+=b&(1<<j)-1)){i.msg="invalid distance too far back",o.mode=30;break t}if(b>>>=j,C-=j,(j=c-u)<$){if(p<(j=$-j)&&o.sane){i.msg="invalid distance too far back",o.mode=30;break t}if(F=_,(S=0)===v){if(S+=m-j,j<U){for(U-=j;W[c++]=_[S++],--j;);S=c-$,F=W}}else if(v<j){if(S+=m+v-j,(j-=v)<U){for(U-=j;W[c++]=_[S++],--j;);if(S=0,v<U){for(U-=j=v;W[c++]=_[S++],--j;);S=c-$,F=W}}}else if(S+=v-j,j<U){for(U-=j;W[c++]=_[S++],--j;);S=c-$,F=W}for(;2<U;)W[c++]=F[S++],W[c++]=F[S++],W[c++]=F[S++],U-=3;U&&(W[c++]=F[S++],1<U&&(W[c++]=F[S++]))}else{for(S=c-$;W[c++]=W[S++],W[c++]=W[S++],W[c++]=W[S++],2<(U-=3););U&&(W[c++]=W[S++],1<U&&(W[c++]=W[S++]))}break}}break}}while(a<l&&c<f);a-=U=C>>3,b&=(1<<(C-=U<<3))-1,i.next_in=a,i.next_out=c,i.avail_in=a<l?l-a+5:5-(a-l),i.avail_out=c<f?f-c+257:257-(c-f),o.hold=b,o.bits=C}},{}],49:[function(e,r,s){var i=e("../utils/common"),n=e("./adler32"),o=e("./crc32"),a=e("./inffast"),l=e("./inftrees"),c=1,u=2,f=0,d=-2,m=1,p=852,v=592;function _(S){return(S>>>24&255)+(S>>>8&65280)+((65280&S)<<8)+((255&S)<<24)}function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function C(S){var F;return S&&S.state?(F=S.state,S.total_in=S.total_out=F.total=0,S.msg="",F.wrap&&(S.adler=1&F.wrap),F.mode=m,F.last=0,F.havedict=0,F.dmax=32768,F.head=null,F.hold=0,F.bits=0,F.lencode=F.lendyn=new i.Buf32(p),F.distcode=F.distdyn=new i.Buf32(v),F.sane=1,F.back=-1,f):d}function k(S){var F;return S&&S.state?((F=S.state).wsize=0,F.whave=0,F.wnext=0,C(S)):d}function T(S,F){var y,W;return S&&S.state?(W=S.state,F<0?(y=0,F=-F):(y=1+(F>>4),F<48&&(F&=15)),F&&(F<8||15<F)?d:(W.window!==null&&W.wbits!==F&&(W.window=null),W.wrap=y,W.wbits=F,k(S))):d}function P(S,F){var y,W;return S?(W=new b,(S.state=W).window=null,(y=T(S,F))!==f&&(S.state=null),y):d}var A,I,j=!0;function U(S){if(j){var F;for(A=new i.Buf32(512),I=new i.Buf32(32),F=0;F<144;)S.lens[F++]=8;for(;F<256;)S.lens[F++]=9;for(;F<280;)S.lens[F++]=7;for(;F<288;)S.lens[F++]=8;for(l(c,S.lens,0,288,A,0,S.work,{bits:9}),F=0;F<32;)S.lens[F++]=5;l(u,S.lens,0,32,I,0,S.work,{bits:5}),j=!1}S.lencode=A,S.lenbits=9,S.distcode=I,S.distbits=5}function $(S,F,y,W){var tt,X=S.state;return X.window===null&&(X.wsize=1<<X.wbits,X.wnext=0,X.whave=0,X.window=new i.Buf8(X.wsize)),W>=X.wsize?(i.arraySet(X.window,F,y-X.wsize,X.wsize,0),X.wnext=0,X.whave=X.wsize):(W<(tt=X.wsize-X.wnext)&&(tt=W),i.arraySet(X.window,F,y-W,tt,X.wnext),(W-=tt)?(i.arraySet(X.window,F,y-W,W,0),X.wnext=W,X.whave=X.wsize):(X.wnext+=tt,X.wnext===X.wsize&&(X.wnext=0),X.whave<X.wsize&&(X.whave+=tt))),0}s.inflateReset=k,s.inflateReset2=T,s.inflateResetKeep=C,s.inflateInit=function(S){return P(S,15)},s.inflateInit2=P,s.inflate=function(S,F){var y,W,tt,X,st,H,it,R,L,ot,Q,G,_t,wt,mt,vt,K,ct,ut,Ct,g,N,B,w,x=0,E=new i.Buf8(4),Y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!S||!S.state||!S.output||!S.input&&S.avail_in!==0)return d;(y=S.state).mode===12&&(y.mode=13),st=S.next_out,tt=S.output,it=S.avail_out,X=S.next_in,W=S.input,H=S.avail_in,R=y.hold,L=y.bits,ot=H,Q=it,N=f;t:for(;;)switch(y.mode){case m:if(y.wrap===0){y.mode=13;break}for(;L<16;){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}if(2&y.wrap&&R===35615){E[y.check=0]=255&R,E[1]=R>>>8&255,y.check=o(y.check,E,2,0),L=R=0,y.mode=2;break}if(y.flags=0,y.head&&(y.head.done=!1),!(1&y.wrap)||(((255&R)<<8)+(R>>8))%31){S.msg="incorrect header check",y.mode=30;break}if((15&R)!=8){S.msg="unknown compression method",y.mode=30;break}if(L-=4,g=8+(15&(R>>>=4)),y.wbits===0)y.wbits=g;else if(g>y.wbits){S.msg="invalid window size",y.mode=30;break}y.dmax=1<<g,S.adler=y.check=1,y.mode=512&R?10:12,L=R=0;break;case 2:for(;L<16;){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}if(y.flags=R,(255&y.flags)!=8){S.msg="unknown compression method",y.mode=30;break}if(57344&y.flags){S.msg="unknown header flags set",y.mode=30;break}y.head&&(y.head.text=R>>8&1),512&y.flags&&(E[0]=255&R,E[1]=R>>>8&255,y.check=o(y.check,E,2,0)),L=R=0,y.mode=3;case 3:for(;L<32;){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}y.head&&(y.head.time=R),512&y.flags&&(E[0]=255&R,E[1]=R>>>8&255,E[2]=R>>>16&255,E[3]=R>>>24&255,y.check=o(y.check,E,4,0)),L=R=0,y.mode=4;case 4:for(;L<16;){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}y.head&&(y.head.xflags=255&R,y.head.os=R>>8),512&y.flags&&(E[0]=255&R,E[1]=R>>>8&255,y.check=o(y.check,E,2,0)),L=R=0,y.mode=5;case 5:if(1024&y.flags){for(;L<16;){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}y.length=R,y.head&&(y.head.extra_len=R),512&y.flags&&(E[0]=255&R,E[1]=R>>>8&255,y.check=o(y.check,E,2,0)),L=R=0}else y.head&&(y.head.extra=null);y.mode=6;case 6:if(1024&y.flags&&(H<(G=y.length)&&(G=H),G&&(y.head&&(g=y.head.extra_len-y.length,y.head.extra||(y.head.extra=new Array(y.head.extra_len)),i.arraySet(y.head.extra,W,X,G,g)),512&y.flags&&(y.check=o(y.check,W,G,X)),H-=G,X+=G,y.length-=G),y.length))break t;y.length=0,y.mode=7;case 7:if(2048&y.flags){if(H===0)break t;for(G=0;g=W[X+G++],y.head&&g&&y.length<65536&&(y.head.name+=String.fromCharCode(g)),g&&G<H;);if(512&y.flags&&(y.check=o(y.check,W,G,X)),H-=G,X+=G,g)break t}else y.head&&(y.head.name=null);y.length=0,y.mode=8;case 8:if(4096&y.flags){if(H===0)break t;for(G=0;g=W[X+G++],y.head&&g&&y.length<65536&&(y.head.comment+=String.fromCharCode(g)),g&&G<H;);if(512&y.flags&&(y.check=o(y.check,W,G,X)),H-=G,X+=G,g)break t}else y.head&&(y.head.comment=null);y.mode=9;case 9:if(512&y.flags){for(;L<16;){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}if(R!==(65535&y.check)){S.msg="header crc mismatch",y.mode=30;break}L=R=0}y.head&&(y.head.hcrc=y.flags>>9&1,y.head.done=!0),S.adler=y.check=0,y.mode=12;break;case 10:for(;L<32;){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}S.adler=y.check=_(R),L=R=0,y.mode=11;case 11:if(y.havedict===0)return S.next_out=st,S.avail_out=it,S.next_in=X,S.avail_in=H,y.hold=R,y.bits=L,2;S.adler=y.check=1,y.mode=12;case 12:if(F===5||F===6)break t;case 13:if(y.last){R>>>=7&L,L-=7&L,y.mode=27;break}for(;L<3;){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}switch(y.last=1&R,L-=1,3&(R>>>=1)){case 0:y.mode=14;break;case 1:if(U(y),y.mode=20,F!==6)break;R>>>=2,L-=2;break t;case 2:y.mode=17;break;case 3:S.msg="invalid block type",y.mode=30}R>>>=2,L-=2;break;case 14:for(R>>>=7&L,L-=7&L;L<32;){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}if((65535&R)!=(R>>>16^65535)){S.msg="invalid stored block lengths",y.mode=30;break}if(y.length=65535&R,L=R=0,y.mode=15,F===6)break t;case 15:y.mode=16;case 16:if(G=y.length){if(H<G&&(G=H),it<G&&(G=it),G===0)break t;i.arraySet(tt,W,X,G,st),H-=G,X+=G,it-=G,st+=G,y.length-=G;break}y.mode=12;break;case 17:for(;L<14;){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}if(y.nlen=257+(31&R),R>>>=5,L-=5,y.ndist=1+(31&R),R>>>=5,L-=5,y.ncode=4+(15&R),R>>>=4,L-=4,286<y.nlen||30<y.ndist){S.msg="too many length or distance symbols",y.mode=30;break}y.have=0,y.mode=18;case 18:for(;y.have<y.ncode;){for(;L<3;){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}y.lens[Y[y.have++]]=7&R,R>>>=3,L-=3}for(;y.have<19;)y.lens[Y[y.have++]]=0;if(y.lencode=y.lendyn,y.lenbits=7,B={bits:y.lenbits},N=l(0,y.lens,0,19,y.lencode,0,y.work,B),y.lenbits=B.bits,N){S.msg="invalid code lengths set",y.mode=30;break}y.have=0,y.mode=19;case 19:for(;y.have<y.nlen+y.ndist;){for(;vt=(x=y.lencode[R&(1<<y.lenbits)-1])>>>16&255,K=65535&x,!((mt=x>>>24)<=L);){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}if(K<16)R>>>=mt,L-=mt,y.lens[y.have++]=K;else{if(K===16){for(w=mt+2;L<w;){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}if(R>>>=mt,L-=mt,y.have===0){S.msg="invalid bit length repeat",y.mode=30;break}g=y.lens[y.have-1],G=3+(3&R),R>>>=2,L-=2}else if(K===17){for(w=mt+3;L<w;){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}L-=mt,g=0,G=3+(7&(R>>>=mt)),R>>>=3,L-=3}else{for(w=mt+7;L<w;){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}L-=mt,g=0,G=11+(127&(R>>>=mt)),R>>>=7,L-=7}if(y.have+G>y.nlen+y.ndist){S.msg="invalid bit length repeat",y.mode=30;break}for(;G--;)y.lens[y.have++]=g}}if(y.mode===30)break;if(y.lens[256]===0){S.msg="invalid code -- missing end-of-block",y.mode=30;break}if(y.lenbits=9,B={bits:y.lenbits},N=l(c,y.lens,0,y.nlen,y.lencode,0,y.work,B),y.lenbits=B.bits,N){S.msg="invalid literal/lengths set",y.mode=30;break}if(y.distbits=6,y.distcode=y.distdyn,B={bits:y.distbits},N=l(u,y.lens,y.nlen,y.ndist,y.distcode,0,y.work,B),y.distbits=B.bits,N){S.msg="invalid distances set",y.mode=30;break}if(y.mode=20,F===6)break t;case 20:y.mode=21;case 21:if(6<=H&&258<=it){S.next_out=st,S.avail_out=it,S.next_in=X,S.avail_in=H,y.hold=R,y.bits=L,a(S,Q),st=S.next_out,tt=S.output,it=S.avail_out,X=S.next_in,W=S.input,H=S.avail_in,R=y.hold,L=y.bits,y.mode===12&&(y.back=-1);break}for(y.back=0;vt=(x=y.lencode[R&(1<<y.lenbits)-1])>>>16&255,K=65535&x,!((mt=x>>>24)<=L);){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}if(vt&&!(240&vt)){for(ct=mt,ut=vt,Ct=K;vt=(x=y.lencode[Ct+((R&(1<<ct+ut)-1)>>ct)])>>>16&255,K=65535&x,!(ct+(mt=x>>>24)<=L);){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}R>>>=ct,L-=ct,y.back+=ct}if(R>>>=mt,L-=mt,y.back+=mt,y.length=K,vt===0){y.mode=26;break}if(32&vt){y.back=-1,y.mode=12;break}if(64&vt){S.msg="invalid literal/length code",y.mode=30;break}y.extra=15&vt,y.mode=22;case 22:if(y.extra){for(w=y.extra;L<w;){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}y.length+=R&(1<<y.extra)-1,R>>>=y.extra,L-=y.extra,y.back+=y.extra}y.was=y.length,y.mode=23;case 23:for(;vt=(x=y.distcode[R&(1<<y.distbits)-1])>>>16&255,K=65535&x,!((mt=x>>>24)<=L);){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}if(!(240&vt)){for(ct=mt,ut=vt,Ct=K;vt=(x=y.distcode[Ct+((R&(1<<ct+ut)-1)>>ct)])>>>16&255,K=65535&x,!(ct+(mt=x>>>24)<=L);){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}R>>>=ct,L-=ct,y.back+=ct}if(R>>>=mt,L-=mt,y.back+=mt,64&vt){S.msg="invalid distance code",y.mode=30;break}y.offset=K,y.extra=15&vt,y.mode=24;case 24:if(y.extra){for(w=y.extra;L<w;){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}y.offset+=R&(1<<y.extra)-1,R>>>=y.extra,L-=y.extra,y.back+=y.extra}if(y.offset>y.dmax){S.msg="invalid distance too far back",y.mode=30;break}y.mode=25;case 25:if(it===0)break t;if(G=Q-it,y.offset>G){if((G=y.offset-G)>y.whave&&y.sane){S.msg="invalid distance too far back",y.mode=30;break}_t=G>y.wnext?(G-=y.wnext,y.wsize-G):y.wnext-G,G>y.length&&(G=y.length),wt=y.window}else wt=tt,_t=st-y.offset,G=y.length;for(it<G&&(G=it),it-=G,y.length-=G;tt[st++]=wt[_t++],--G;);y.length===0&&(y.mode=21);break;case 26:if(it===0)break t;tt[st++]=y.length,it--,y.mode=21;break;case 27:if(y.wrap){for(;L<32;){if(H===0)break t;H--,R|=W[X++]<<L,L+=8}if(Q-=it,S.total_out+=Q,y.total+=Q,Q&&(S.adler=y.check=y.flags?o(y.check,tt,Q,st-Q):n(y.check,tt,Q,st-Q)),Q=it,(y.flags?R:_(R))!==y.check){S.msg="incorrect data check",y.mode=30;break}L=R=0}y.mode=28;case 28:if(y.wrap&&y.flags){for(;L<32;){if(H===0)break t;H--,R+=W[X++]<<L,L+=8}if(R!==(4294967295&y.total)){S.msg="incorrect length check",y.mode=30;break}L=R=0}y.mode=29;case 29:N=1;break t;case 30:N=-3;break t;case 31:return-4;case 32:default:return d}return S.next_out=st,S.avail_out=it,S.next_in=X,S.avail_in=H,y.hold=R,y.bits=L,(y.wsize||Q!==S.avail_out&&y.mode<30&&(y.mode<27||F!==4))&&$(S,S.output,S.next_out,Q-S.avail_out)?(y.mode=31,-4):(ot-=S.avail_in,Q-=S.avail_out,S.total_in+=ot,S.total_out+=Q,y.total+=Q,y.wrap&&Q&&(S.adler=y.check=y.flags?o(y.check,tt,Q,S.next_out-Q):n(y.check,tt,Q,S.next_out-Q)),S.data_type=y.bits+(y.last?64:0)+(y.mode===12?128:0)+(y.mode===20||y.mode===15?256:0),(ot==0&&Q===0||F===4)&&N===f&&(N=-5),N)},s.inflateEnd=function(S){if(!S||!S.state)return d;var F=S.state;return F.window&&(F.window=null),S.state=null,f},s.inflateGetHeader=function(S,F){var y;return S&&S.state&&2&(y=S.state).wrap?((y.head=F).done=!1,f):d},s.inflateSetDictionary=function(S,F){var y,W=F.length;return S&&S.state?(y=S.state).wrap!==0&&y.mode!==11?d:y.mode===11&&n(1,F,W,0)!==y.check?-3:$(S,F,W,W)?(y.mode=31,-4):(y.havedict=1,f):d},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,r,s){var i=e("../utils/common"),n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(c,u,f,d,m,p,v,_){var b,C,k,T,P,A,I,j,U,$=_.bits,S=0,F=0,y=0,W=0,tt=0,X=0,st=0,H=0,it=0,R=0,L=null,ot=0,Q=new i.Buf16(16),G=new i.Buf16(16),_t=null,wt=0;for(S=0;S<=15;S++)Q[S]=0;for(F=0;F<d;F++)Q[u[f+F]]++;for(tt=$,W=15;1<=W&&Q[W]===0;W--);if(W<tt&&(tt=W),W===0)return m[p++]=20971520,m[p++]=20971520,_.bits=1,0;for(y=1;y<W&&Q[y]===0;y++);for(tt<y&&(tt=y),S=H=1;S<=15;S++)if(H<<=1,(H-=Q[S])<0)return-1;if(0<H&&(c===0||W!==1))return-1;for(G[1]=0,S=1;S<15;S++)G[S+1]=G[S]+Q[S];for(F=0;F<d;F++)u[f+F]!==0&&(v[G[u[f+F]]++]=F);if(A=c===0?(L=_t=v,19):c===1?(L=n,ot-=257,_t=o,wt-=257,256):(L=a,_t=l,-1),S=y,P=p,st=F=R=0,k=-1,T=(it=1<<(X=tt))-1,c===1&&852<it||c===2&&592<it)return 1;for(;;){for(I=S-st,U=v[F]<A?(j=0,v[F]):v[F]>A?(j=_t[wt+v[F]],L[ot+v[F]]):(j=96,0),b=1<<S-st,y=C=1<<X;m[P+(R>>st)+(C-=b)]=I<<24|j<<16|U|0,C!==0;);for(b=1<<S-1;R&b;)b>>=1;if(b!==0?(R&=b-1,R+=b):R=0,F++,--Q[S]==0){if(S===W)break;S=u[f+v[F]]}if(tt<S&&(R&T)!==k){for(st===0&&(st=tt),P+=y,H=1<<(X=S-st);X+st<W&&!((H-=Q[X+st])<=0);)X++,H<<=1;if(it+=1<<X,c===1&&852<it||c===2&&592<it)return 1;m[k=R&T]=tt<<24|X<<16|P-p|0}}return R!==0&&(m[P+R]=S-st<<24|64<<16|0),_.bits=tt,0}},{"../utils/common":41}],51:[function(e,r,s){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,r,s){var i=e("../utils/common"),n=0,o=1;function a(x){for(var E=x.length;0<=--E;)x[E]=0}var l=0,c=29,u=256,f=u+1+c,d=30,m=19,p=2*f+1,v=15,_=16,b=7,C=256,k=16,T=17,P=18,A=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],I=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$=new Array(2*(f+2));a($);var S=new Array(2*d);a(S);var F=new Array(512);a(F);var y=new Array(256);a(y);var W=new Array(c);a(W);var tt,X,st,H=new Array(d);function it(x,E,Y,V,M){this.static_tree=x,this.extra_bits=E,this.extra_base=Y,this.elems=V,this.max_length=M,this.has_stree=x&&x.length}function R(x,E){this.dyn_tree=x,this.max_code=0,this.stat_desc=E}function L(x){return x<256?F[x]:F[256+(x>>>7)]}function ot(x,E){x.pending_buf[x.pending++]=255&E,x.pending_buf[x.pending++]=E>>>8&255}function Q(x,E,Y){x.bi_valid>_-Y?(x.bi_buf|=E<<x.bi_valid&65535,ot(x,x.bi_buf),x.bi_buf=E>>_-x.bi_valid,x.bi_valid+=Y-_):(x.bi_buf|=E<<x.bi_valid&65535,x.bi_valid+=Y)}function G(x,E,Y){Q(x,Y[2*E],Y[2*E+1])}function _t(x,E){for(var Y=0;Y|=1&x,x>>>=1,Y<<=1,0<--E;);return Y>>>1}function wt(x,E,Y){var V,M,Z=new Array(v+1),et=0;for(V=1;V<=v;V++)Z[V]=et=et+Y[V-1]<<1;for(M=0;M<=E;M++){var q=x[2*M+1];q!==0&&(x[2*M]=_t(Z[q]++,q))}}function mt(x){var E;for(E=0;E<f;E++)x.dyn_ltree[2*E]=0;for(E=0;E<d;E++)x.dyn_dtree[2*E]=0;for(E=0;E<m;E++)x.bl_tree[2*E]=0;x.dyn_ltree[2*C]=1,x.opt_len=x.static_len=0,x.last_lit=x.matches=0}function vt(x){8<x.bi_valid?ot(x,x.bi_buf):0<x.bi_valid&&(x.pending_buf[x.pending++]=x.bi_buf),x.bi_buf=0,x.bi_valid=0}function K(x,E,Y,V){var M=2*E,Z=2*Y;return x[M]<x[Z]||x[M]===x[Z]&&V[E]<=V[Y]}function ct(x,E,Y){for(var V=x.heap[Y],M=Y<<1;M<=x.heap_len&&(M<x.heap_len&&K(E,x.heap[M+1],x.heap[M],x.depth)&&M++,!K(E,V,x.heap[M],x.depth));)x.heap[Y]=x.heap[M],Y=M,M<<=1;x.heap[Y]=V}function ut(x,E,Y){var V,M,Z,et,q=0;if(x.last_lit!==0)for(;V=x.pending_buf[x.d_buf+2*q]<<8|x.pending_buf[x.d_buf+2*q+1],M=x.pending_buf[x.l_buf+q],q++,V===0?G(x,M,E):(G(x,(Z=y[M])+u+1,E),(et=A[Z])!==0&&Q(x,M-=W[Z],et),G(x,Z=L(--V),Y),(et=I[Z])!==0&&Q(x,V-=H[Z],et)),q<x.last_lit;);G(x,C,E)}function Ct(x,E){var Y,V,M,Z=E.dyn_tree,et=E.stat_desc.static_tree,q=E.stat_desc.has_stree,lt=E.stat_desc.elems,Tt=-1;for(x.heap_len=0,x.heap_max=p,Y=0;Y<lt;Y++)Z[2*Y]!==0?(x.heap[++x.heap_len]=Tt=Y,x.depth[Y]=0):Z[2*Y+1]=0;for(;x.heap_len<2;)Z[2*(M=x.heap[++x.heap_len]=Tt<2?++Tt:0)]=1,x.depth[M]=0,x.opt_len--,q&&(x.static_len-=et[2*M+1]);for(E.max_code=Tt,Y=x.heap_len>>1;1<=Y;Y--)ct(x,Z,Y);for(M=lt;Y=x.heap[1],x.heap[1]=x.heap[x.heap_len--],ct(x,Z,1),V=x.heap[1],x.heap[--x.heap_max]=Y,x.heap[--x.heap_max]=V,Z[2*M]=Z[2*Y]+Z[2*V],x.depth[M]=(x.depth[Y]>=x.depth[V]?x.depth[Y]:x.depth[V])+1,Z[2*Y+1]=Z[2*V+1]=M,x.heap[1]=M++,ct(x,Z,1),2<=x.heap_len;);x.heap[--x.heap_max]=x.heap[1],function(dt,jt){var Re,Jt,se,St,Be,oe,ae=jt.dyn_tree,ur=jt.max_code,qt=jt.stat_desc.static_tree,Rr=jt.stat_desc.has_stree,ke=jt.stat_desc.extra_bits,de=jt.stat_desc.extra_base,ze=jt.stat_desc.max_length,We=0;for(St=0;St<=v;St++)dt.bl_count[St]=0;for(ae[2*dt.heap[dt.heap_max]+1]=0,Re=dt.heap_max+1;Re<p;Re++)ze<(St=ae[2*ae[2*(Jt=dt.heap[Re])+1]+1]+1)&&(St=ze,We++),ae[2*Jt+1]=St,ur<Jt||(dt.bl_count[St]++,Be=0,de<=Jt&&(Be=ke[Jt-de]),oe=ae[2*Jt],dt.opt_len+=oe*(St+Be),Rr&&(dt.static_len+=oe*(qt[2*Jt+1]+Be)));if(We!==0){do{for(St=ze-1;dt.bl_count[St]===0;)St--;dt.bl_count[St]--,dt.bl_count[St+1]+=2,dt.bl_count[ze]--,We-=2}while(0<We);for(St=ze;St!==0;St--)for(Jt=dt.bl_count[St];Jt!==0;)ur<(se=dt.heap[--Re])||(ae[2*se+1]!==St&&(dt.opt_len+=(St-ae[2*se+1])*ae[2*se],ae[2*se+1]=St),Jt--)}}(x,E),wt(Z,Tt,x.bl_count)}function g(x,E,Y){var V,M,Z=-1,et=E[1],q=0,lt=7,Tt=4;for(et===0&&(lt=138,Tt=3),E[2*(Y+1)+1]=65535,V=0;V<=Y;V++)M=et,et=E[2*(V+1)+1],++q<lt&&M===et||(q<Tt?x.bl_tree[2*M]+=q:M!==0?(M!==Z&&x.bl_tree[2*M]++,x.bl_tree[2*k]++):q<=10?x.bl_tree[2*T]++:x.bl_tree[2*P]++,Z=M,Tt=(q=0)===et?(lt=138,3):M===et?(lt=6,3):(lt=7,4))}function N(x,E,Y){var V,M,Z=-1,et=E[1],q=0,lt=7,Tt=4;for(et===0&&(lt=138,Tt=3),V=0;V<=Y;V++)if(M=et,et=E[2*(V+1)+1],!(++q<lt&&M===et)){if(q<Tt)for(;G(x,M,x.bl_tree),--q!=0;);else M!==0?(M!==Z&&(G(x,M,x.bl_tree),q--),G(x,k,x.bl_tree),Q(x,q-3,2)):q<=10?(G(x,T,x.bl_tree),Q(x,q-3,3)):(G(x,P,x.bl_tree),Q(x,q-11,7));Z=M,Tt=(q=0)===et?(lt=138,3):M===et?(lt=6,3):(lt=7,4)}}a(H);var B=!1;function w(x,E,Y,V){Q(x,(l<<1)+(V?1:0),3),function(M,Z,et,q){vt(M),ot(M,et),ot(M,~et),i.arraySet(M.pending_buf,M.window,Z,et,M.pending),M.pending+=et}(x,E,Y)}s._tr_init=function(x){B||(function(){var E,Y,V,M,Z,et=new Array(v+1);for(M=V=0;M<c-1;M++)for(W[M]=V,E=0;E<1<<A[M];E++)y[V++]=M;for(y[V-1]=M,M=Z=0;M<16;M++)for(H[M]=Z,E=0;E<1<<I[M];E++)F[Z++]=M;for(Z>>=7;M<d;M++)for(H[M]=Z<<7,E=0;E<1<<I[M]-7;E++)F[256+Z++]=M;for(Y=0;Y<=v;Y++)et[Y]=0;for(E=0;E<=143;)$[2*E+1]=8,E++,et[8]++;for(;E<=255;)$[2*E+1]=9,E++,et[9]++;for(;E<=279;)$[2*E+1]=7,E++,et[7]++;for(;E<=287;)$[2*E+1]=8,E++,et[8]++;for(wt($,f+1,et),E=0;E<d;E++)S[2*E+1]=5,S[2*E]=_t(E,5);tt=new it($,A,u+1,f,v),X=new it(S,I,0,d,v),st=new it(new Array(0),j,0,m,b)}(),B=!0),x.l_desc=new R(x.dyn_ltree,tt),x.d_desc=new R(x.dyn_dtree,X),x.bl_desc=new R(x.bl_tree,st),x.bi_buf=0,x.bi_valid=0,mt(x)},s._tr_stored_block=w,s._tr_flush_block=function(x,E,Y,V){var M,Z,et=0;0<x.level?(x.strm.data_type===2&&(x.strm.data_type=function(q){var lt,Tt=4093624447;for(lt=0;lt<=31;lt++,Tt>>>=1)if(1&Tt&&q.dyn_ltree[2*lt]!==0)return n;if(q.dyn_ltree[18]!==0||q.dyn_ltree[20]!==0||q.dyn_ltree[26]!==0)return o;for(lt=32;lt<u;lt++)if(q.dyn_ltree[2*lt]!==0)return o;return n}(x)),Ct(x,x.l_desc),Ct(x,x.d_desc),et=function(q){var lt;for(g(q,q.dyn_ltree,q.l_desc.max_code),g(q,q.dyn_dtree,q.d_desc.max_code),Ct(q,q.bl_desc),lt=m-1;3<=lt&&q.bl_tree[2*U[lt]+1]===0;lt--);return q.opt_len+=3*(lt+1)+5+5+4,lt}(x),M=x.opt_len+3+7>>>3,(Z=x.static_len+3+7>>>3)<=M&&(M=Z)):M=Z=Y+5,Y+4<=M&&E!==-1?w(x,E,Y,V):x.strategy===4||Z===M?(Q(x,2+(V?1:0),3),ut(x,$,S)):(Q(x,4+(V?1:0),3),function(q,lt,Tt,dt){var jt;for(Q(q,lt-257,5),Q(q,Tt-1,5),Q(q,dt-4,4),jt=0;jt<dt;jt++)Q(q,q.bl_tree[2*U[jt]+1],3);N(q,q.dyn_ltree,lt-1),N(q,q.dyn_dtree,Tt-1)}(x,x.l_desc.max_code+1,x.d_desc.max_code+1,et+1),ut(x,x.dyn_ltree,x.dyn_dtree)),mt(x),V&&vt(x)},s._tr_tally=function(x,E,Y){return x.pending_buf[x.d_buf+2*x.last_lit]=E>>>8&255,x.pending_buf[x.d_buf+2*x.last_lit+1]=255&E,x.pending_buf[x.l_buf+x.last_lit]=255&Y,x.last_lit++,E===0?x.dyn_ltree[2*Y]++:(x.matches++,E--,x.dyn_ltree[2*(y[Y]+u+1)]++,x.dyn_dtree[2*L(E)]++),x.last_lit===x.lit_bufsize-1},s._tr_align=function(x){Q(x,2,3),G(x,C,$),function(E){E.bi_valid===16?(ot(E,E.bi_buf),E.bi_buf=0,E.bi_valid=0):8<=E.bi_valid&&(E.pending_buf[E.pending++]=255&E.bi_buf,E.bi_buf>>=8,E.bi_valid-=8)}(x)}},{"../utils/common":41}],53:[function(e,r,s){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,r,s){(function(i){(function(n,o){if(!n.setImmediate){var a,l,c,u,f=1,d={},m=!1,p=n.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(n);v=v&&v.setTimeout?v:n,a={}.toString.call(n.process)==="[object process]"?function(k){process.nextTick(function(){b(k)})}:function(){if(n.postMessage&&!n.importScripts){var k=!0,T=n.onmessage;return n.onmessage=function(){k=!1},n.postMessage("","*"),n.onmessage=T,k}}()?(u="setImmediate$"+Math.random()+"$",n.addEventListener?n.addEventListener("message",C,!1):n.attachEvent("onmessage",C),function(k){n.postMessage(u+k,"*")}):n.MessageChannel?((c=new MessageChannel).port1.onmessage=function(k){b(k.data)},function(k){c.port2.postMessage(k)}):p&&"onreadystatechange"in p.createElement("script")?(l=p.documentElement,function(k){var T=p.createElement("script");T.onreadystatechange=function(){b(k),T.onreadystatechange=null,l.removeChild(T),T=null},l.appendChild(T)}):function(k){setTimeout(b,0,k)},v.setImmediate=function(k){typeof k!="function"&&(k=new Function(""+k));for(var T=new Array(arguments.length-1),P=0;P<T.length;P++)T[P]=arguments[P+1];var A={callback:k,args:T};return d[f]=A,a(f),f++},v.clearImmediate=_}function _(k){delete d[k]}function b(k){if(m)setTimeout(b,0,k);else{var T=d[k];if(T){m=!0;try{(function(P){var A=P.callback,I=P.args;switch(I.length){case 0:A();break;case 1:A(I[0]);break;case 2:A(I[0],I[1]);break;case 3:A(I[0],I[1],I[2]);break;default:A.apply(o,I)}})(T)}finally{_(k),m=!1}}}}function C(k){k.source===n&&typeof k.data=="string"&&k.data.indexOf(u)===0&&b(+k.data.slice(u.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof Ps<"u"?Ps:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Ca);var xc=Ca.exports;const wc=bc(xc);function mo(h,t,e){const r=h.slice();return r[45]=t[e],r[46]=t,r[47]=e,r}function _o(h,t,e){const r=h.slice();return r[48]=t[e],r}function vo(h){let t,e=h[48]+"",r;return{c(){t=at("option"),r=zs(e),this.h()},l(s){t=ht(s,"OPTION",{});var i=bt(t);r=Ws(i,e),i.forEach(pt),this.h()},h(){t.__value=h[48],$e(t,t.__value)},m(s,i){tr(s,t,i),J(t,r)},p:Ei,d(s){s&&pt(t)}}}function yo(h){let t,e,r,s,i,n,o,a,l,c="Export",u,f,d;function m(){h[34].call(r,h[46],h[47])}function p(){return h[35](h[45])}return{c(){t=at("div"),e=at("label"),r=at("input"),s=zs(`
							Sync`),i=Dt(),n=at("canvas"),a=Dt(),l=at("button"),l.textContent=c,u=Dt(),this.h()},l(v){t=ht(v,"DIV",{class:!0});var _=bt(t);e=ht(_,"LABEL",{class:!0});var b=bt(e);r=ht(b,"INPUT",{type:!0}),s=Ws(b,`
							Sync`),b.forEach(pt),i=Et(_),n=ht(_,"CANVAS",{class:!0,id:!0}),bt(n).forEach(pt),a=Et(_),l=ht(_,"BUTTON",{class:!0,"data-svelte-h":!0}),Xt(l)!=="svelte-56e6wr"&&(l.textContent=c),u=Et(_),_.forEach(pt),this.h()},h(){nt(r,"type","checkbox"),nt(e,"class","checkbox"),nt(n,"class","canvas"),nt(n,"id",o=h[45].id),nt(l,"class","button is-link"),nt(t,"class","box")},m(v,_){tr(v,t,_),J(t,e),J(e,r),r.checked=h[45].sync,J(e,s),J(t,i),J(t,n),J(t,a),J(t,l),J(t,u),f||(d=[Yt(r,"change",m),Yt(l,"click",p)],f=!0)},p(v,_){h=v,_[0]&1&&(r.checked=h[45].sync),_[0]&1&&o!==(o=h[45].id)&&nt(n,"id",o)},d(v){v&&pt(t),f=!1,bo(d)}}}function Cc(h){let t,e,r,s="Docx Image Batch Editor",i,n,o="Batch apply watermarks, add text, etc. to images in a docx file.",a,l,c,u,f,d,m,p='<span class="file-label">Choose a docx file</span>',v,_,b=(h[3]?h[3].name:"No file chosen")+"",C,k,T,P,A,I="Apply Changes",j,U,$="Download Watermarked Docx",S,F,y,W,tt,X='<canvas id="mainFabricCanvas" class="main-canvas svelte-1aze6wa"></canvas>',st,H,it,R,L,ot='<p class="card-header-title">Canvas Controls</p>',Q,G,_t,wt,mt="Add Rectangle",vt,K,ct="Add Circle",ut,Ct,g,N="Delete",B,w,x,E="Add Text",Y,V,M,Z,et,q,lt="Add Text",Tt,dt,jt,Re="Pick Color",Jt,se,St,Be,oe,ae="Set Opacity:",ur,qt,Rr,ke,de,ze="Font family:",We,dr,he,ci,qe,fr,cn="Advanced",ui,Br,gr,Ze,di,fi,ts,Ke,pr,mr,Je,gi,un,_r=os(h[11]),Nt=[];for(let ft=0;ft<_r.length;ft+=1)Nt[ft]=vo(_o(h,_r,ft));let vr=os(h[0]),Ut=[];for(let ft=0;ft<vr.length;ft+=1)Ut[ft]=yo(mo(h,vr,ft));return{c(){t=at("section"),e=at("div"),r=at("h1"),r.textContent=s,i=Dt(),n=at("h2"),n.textContent=o,a=Dt(),l=at("div"),c=at("div"),u=at("label"),f=at("input"),d=Dt(),m=at("span"),m.innerHTML=p,v=Dt(),_=at("span"),C=zs(b),k=Dt(),T=at("div"),P=at("div"),A=at("button"),A.textContent=I,j=Dt(),U=at("a"),U.textContent=$,S=Dt(),F=at("section"),y=at("div"),W=at("div"),tt=at("div"),tt.innerHTML=X,H=Dt(),it=at("div"),R=at("div"),L=at("header"),L.innerHTML=ot,Q=Dt(),G=at("div"),_t=at("div"),wt=at("button"),wt.textContent=mt,vt=Dt(),K=at("button"),K.textContent=ct,ut=Dt(),Ct=at("div"),g=at("button"),g.textContent=N,B=Dt(),w=at("div"),x=at("label"),x.textContent=E,Y=Dt(),V=at("div"),M=at("input"),Z=Dt(),et=at("div"),q=at("button"),q.textContent=lt,Tt=Dt(),dt=at("div"),jt=at("label"),jt.textContent=Re,Jt=Dt(),se=at("div"),St=at("input"),Be=Dt(),oe=at("label"),oe.textContent=ae,ur=Dt(),qt=at("input"),Rr=Dt(),ke=at("div"),de=at("label"),de.textContent=ze,We=Dt(),dr=at("div"),he=at("select");for(let ft=0;ft<Nt.length;ft+=1)Nt[ft].c();ci=Dt(),qe=at("details"),fr=at("summary"),fr.textContent=cn,ui=Dt(),Br=at("div"),gr=at("label"),Ze=at("input"),di=zs(`
									Enable Debouncing (improved perf)`),fi=Dt(),ts=Dt(),Ke=at("section"),pr=at("div"),mr=at("div"),Je=at("div");for(let ft=0;ft<Ut.length;ft+=1)Ut[ft].c();this.h()},l(ft){t=ht(ft,"SECTION",{class:!0});var Bt=bt(t);e=ht(Bt,"DIV",{class:!0});var gt=bt(e);r=ht(gt,"H1",{class:!0,"data-svelte-h":!0}),Xt(r)!=="svelte-99vwxv"&&(r.textContent=s),i=Et(gt),n=ht(gt,"H2",{class:!0,"data-svelte-h":!0}),Xt(n)!=="svelte-14ifi1z"&&(n.textContent=o),a=Et(gt),l=ht(gt,"DIV",{class:!0});var Ne=bt(l);c=ht(Ne,"DIV",{class:!0});var dn=bt(c);u=ht(dn,"LABEL",{class:!0});var yr=bt(u);f=ht(yr,"INPUT",{class:!0,type:!0,name:!0,accept:!0}),d=Et(yr),m=ht(yr,"SPAN",{class:!0,"data-svelte-h":!0}),Xt(m)!=="svelte-1xc7gn4"&&(m.innerHTML=p),v=Et(yr),_=ht(yr,"SPAN",{class:!0});var fn=bt(_);C=Ws(fn,b),fn.forEach(pt),yr.forEach(pt),dn.forEach(pt),Ne.forEach(pt),k=Et(gt),T=ht(gt,"DIV",{class:!0});var gn=bt(T);P=ht(gn,"DIV",{class:!0});var pn=bt(P);A=ht(pn,"BUTTON",{class:!0,"data-svelte-h":!0}),Xt(A)!=="svelte-1nw9uyj"&&(A.textContent=I),pn.forEach(pt),gn.forEach(pt),j=Et(gt),U=ht(gt,"A",{id:!0,style:!0,"data-svelte-h":!0}),Xt(U)!=="svelte-1mge7py"&&(U.textContent=$),gt.forEach(pt),Bt.forEach(pt),S=Et(ft),F=ht(ft,"SECTION",{class:!0});var mn=bt(F);y=ht(mn,"DIV",{class:!0});var _n=bt(y);W=ht(_n,"DIV",{class:!0});var es=bt(W);tt=ht(es,"DIV",{class:!0,"data-svelte-h":!0}),Xt(tt)!=="svelte-40n5z6"&&(tt.innerHTML=X),H=Et(es),it=ht(es,"DIV",{class:!0});var vn=bt(it);R=ht(vn,"DIV",{class:!0});var rs=bt(R);L=ht(rs,"HEADER",{class:!0,"data-svelte-h":!0}),Xt(L)!=="svelte-eov3tf"&&(L.innerHTML=ot),Q=Et(rs),G=ht(rs,"DIV",{class:!0});var fe=bt(G);_t=ht(fe,"DIV",{class:!0});var ss=bt(_t);wt=ht(ss,"BUTTON",{class:!0,"data-svelte-h":!0}),Xt(wt)!=="svelte-1uxz5ac"&&(wt.textContent=mt),vt=Et(ss),K=ht(ss,"BUTTON",{class:!0,"data-svelte-h":!0}),Xt(K)!=="svelte-nptn87"&&(K.textContent=ct),ss.forEach(pt),ut=Et(fe),Ct=ht(fe,"DIV",{});var yn=bt(Ct);g=ht(yn,"BUTTON",{class:!0,"data-svelte-h":!0}),Xt(g)!=="svelte-1kur5y8"&&(g.textContent=N),yn.forEach(pt),B=Et(fe),w=ht(fe,"DIV",{class:!0});var br=bt(w);x=ht(br,"LABEL",{class:!0,"data-svelte-h":!0}),Xt(x)!=="svelte-gteak1"&&(x.textContent=E),Y=Et(br),V=ht(br,"DIV",{class:!0});var bn=bt(V);M=ht(bn,"INPUT",{class:!0,placeholder:!0}),bn.forEach(pt),Z=Et(br),et=ht(br,"DIV",{class:!0});var xn=bt(et);q=ht(xn,"BUTTON",{class:!0,"data-svelte-h":!0}),Xt(q)!=="svelte-j9szn8"&&(q.textContent=lt),xn.forEach(pt),br.forEach(pt),Tt=Et(fe),dt=ht(fe,"DIV",{});var xe=bt(dt);jt=ht(xe,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),Xt(jt)!=="svelte-afo6sm"&&(jt.textContent=Re),Jt=Et(xe),se=ht(xe,"DIV",{name:!0,class:!0});var wn=bt(se);St=ht(wn,"INPUT",{type:!0,class:!0}),wn.forEach(pt),Be=Et(xe),oe=ht(xe,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),Xt(oe)!=="svelte-12lf3or"&&(oe.textContent=ae),ur=Et(xe),qt=ht(xe,"INPUT",{id:!0,type:!0,min:!0,max:!0,step:!0}),Rr=Et(xe),ke=ht(xe,"DIV",{});var is=bt(ke);de=ht(is,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),Xt(de)!=="svelte-1jlkrid"&&(de.textContent=ze),We=Et(is),dr=ht(is,"DIV",{class:!0});var Cn=bt(dr);he=ht(Cn,"SELECT",{class:!0});var Sn=bt(he);for(let Qe=0;Qe<Nt.length;Qe+=1)Nt[Qe].l(Sn);Sn.forEach(pt),Cn.forEach(pt),is.forEach(pt),xe.forEach(pt),ci=Et(fe),qe=ht(fe,"DETAILS",{});var ns=bt(qe);fr=ht(ns,"SUMMARY",{"data-svelte-h":!0}),Xt(fr)!=="svelte-1ag3tz6"&&(fr.textContent=cn),ui=Et(ns),Br=ht(ns,"DIV",{});var Tn=bt(Br);gr=ht(Tn,"LABEL",{});var pi=bt(gr);Ze=ht(pi,"INPUT",{type:!0}),di=Ws(pi,`
									Enable Debouncing (improved perf)`),pi.forEach(pt),Tn.forEach(pt),ns.forEach(pt),fi=Et(fe),fe.forEach(pt),rs.forEach(pt),vn.forEach(pt),es.forEach(pt),_n.forEach(pt),mn.forEach(pt),ts=Et(ft),Ke=ht(ft,"SECTION",{class:!0});var kn=bt(Ke);pr=ht(kn,"DIV",{class:!0});var On=bt(pr);mr=ht(On,"DIV",{class:!0});var Dn=bt(mr);Je=ht(Dn,"DIV",{class:!0});var En=bt(Je);for(let Qe=0;Qe<Ut.length;Qe+=1)Ut[Qe].l(En);En.forEach(pt),Dn.forEach(pt),On.forEach(pt),kn.forEach(pt),this.h()},h(){nt(r,"class","title"),nt(n,"class","subtitle"),nt(f,"class","file-input"),nt(f,"type","file"),nt(f,"name","resume"),nt(f,"accept",".docx"),nt(m,"class","file-cta"),nt(_,"class","file-name"),nt(u,"class","file-label"),nt(c,"class","file has-name is-fullwidth"),nt(l,"class","field"),nt(A,"class","button is-primary"),nt(P,"class","control"),nt(T,"class","field"),nt(U,"id","downloadLink"),Ea(U,"display","none"),nt(e,"class","container"),nt(t,"class","section"),nt(tt,"class","column is-two-thirds"),An(()=>h[24].call(tt)),nt(L,"class","card-header"),nt(wt,"class","button is-link is-fullwidth"),nt(K,"class","button is-primary is-fullwidth"),nt(_t,"class","buttons"),nt(g,"class","button is-danger is-fullwidth"),nt(x,"class","label"),nt(M,"class","input"),nt(M,"placeholder","Type text"),nt(V,"class","control"),nt(q,"class","button is-link is-fullwidth"),nt(et,"class","control"),nt(w,"class","field"),nt(jt,"for","color"),nt(jt,"class","label"),nt(St,"type","color"),nt(St,"class","input"),nt(se,"name","color"),nt(se,"class","control"),nt(oe,"for","opacity-slider"),nt(oe,"class","label"),nt(qt,"id","opacity-slider"),nt(qt,"type","range"),nt(qt,"min","0"),nt(qt,"max","1"),nt(qt,"step","0.01"),nt(de,"for","font"),nt(de,"class","label"),nt(he,"class","select"),h[7]===void 0&&An(()=>h[30].call(he)),nt(dr,"class","select is-link"),nt(Ze,"type","checkbox"),nt(G,"class","card-content"),nt(R,"class","card"),nt(it,"class","column is-one-third"),nt(W,"class","columns"),nt(y,"class","container"),nt(F,"class","section"),nt(Je,"class","column is-half"),nt(mr,"class","columns"),nt(pr,"class","container"),nt(Ke,"class","section")},m(ft,Bt){tr(ft,t,Bt),J(t,e),J(e,r),J(e,i),J(e,n),J(e,a),J(e,l),J(l,c),J(c,u),J(u,f),h[23](f),J(u,d),J(u,m),J(u,v),J(u,_),J(_,C),J(e,k),J(e,T),J(T,P),J(P,A),J(e,j),J(e,U),tr(ft,S,Bt),tr(ft,F,Bt),J(F,y),J(y,W),J(W,tt),st=Aa(tt,h[24].bind(tt)),J(W,H),J(W,it),J(it,R),J(R,L),J(R,Q),J(R,G),J(G,_t),J(_t,wt),J(_t,vt),J(_t,K),J(G,ut),J(G,Ct),J(Ct,g),J(G,B),J(G,w),J(w,x),J(w,Y),J(w,V),J(V,M),$e(M,h[1]),J(w,Z),J(w,et),J(et,q),J(G,Tt),J(G,dt),J(dt,jt),J(dt,Jt),J(dt,se),J(se,St),$e(St,h[8]),J(dt,Be),J(dt,oe),J(dt,ur),J(dt,qt),$e(qt,h[9]),J(dt,Rr),J(dt,ke),J(ke,de),J(ke,We),J(ke,dr),J(dr,he);for(let gt=0;gt<Nt.length;gt+=1)Nt[gt]&&Nt[gt].m(he,null);Mn(he,h[7],!0),J(G,ci),J(G,qe),J(qe,fr),J(qe,ui),J(qe,Br),J(Br,gr),J(gr,Ze),Ze.checked=h[4],J(gr,di),J(G,fi),tr(ft,ts,Bt),tr(ft,Ke,Bt),J(Ke,pr),J(pr,mr),J(mr,Je);for(let gt=0;gt<Ut.length;gt+=1)Ut[gt]&&Ut[gt].m(Je,null);gi||(un=[Yt(f,"change",h[12]),Yt(A,"click",h[13]),Yt(wt,"click",h[14]),Yt(K,"click",h[15]),Yt(g,"click",h[20]),Yt(M,"input",h[25]),Yt(q,"click",h[16]),Yt(St,"input",h[26]),Yt(St,"input",h[27]),Yt(qt,"change",h[28]),Yt(qt,"input",h[28]),Yt(qt,"input",h[29]),Yt(he,"change",h[30]),Yt(he,"change",h[31]),Yt(Ze,"change",h[32])],gi=!0)},p(ft,Bt){if(Bt[0]&8&&b!==(b=(ft[3]?ft[3].name:"No file chosen")+"")&&Ma(C,b),Bt[0]&2&&M.value!==ft[1]&&$e(M,ft[1]),Bt[0]&256&&$e(St,ft[8]),Bt[0]&512&&$e(qt,ft[9]),Bt[0]&2048){_r=os(ft[11]);let gt;for(gt=0;gt<_r.length;gt+=1){const Ne=_o(ft,_r,gt);Nt[gt]?Nt[gt].p(Ne,Bt):(Nt[gt]=vo(Ne),Nt[gt].c(),Nt[gt].m(he,null))}for(;gt<Nt.length;gt+=1)Nt[gt].d(1);Nt.length=_r.length}if(Bt[0]&2176&&Mn(he,ft[7]),Bt[0]&16&&(Ze.checked=ft[4]),Bt[0]&2097153){vr=os(ft[0]);let gt;for(gt=0;gt<vr.length;gt+=1){const Ne=mo(ft,vr,gt);Ut[gt]?Ut[gt].p(Ne,Bt):(Ut[gt]=yo(Ne),Ut[gt].c(),Ut[gt].m(Je,null))}for(;gt<Ut.length;gt+=1)Ut[gt].d(1);Ut.length=vr.length}},i:Ei,o:Ei,d(ft){ft&&(pt(t),pt(S),pt(F),pt(ts),pt(Ke)),h[23](null),st(),Pn(Nt,ft),Pn(Ut,ft),gi=!1,bo(un)}}}function Sc(h,t){let e;return function(...r){clearTimeout(e),e=setTimeout(()=>h.apply(this,r),t)}}function Tc(h,t,e){let r,s=[],i="",n=null,o=null,a=null,l=!0,c,u,f=["Arial","Courier New","Georgia","Times New Roman","Verdana"],d="Arial",m="red",p=1;Ta(()=>{r=new Qs("mainFabricCanvas",{width:c-10,height:u-10}),k(),r.on("after:render",()=>{l?W():tt()})});let v;function _(K){e(3,o=K.target.files[0]),o&&o.name.endsWith(".docx")?C():alert("Please upload a valid .docx file")}async function b(){console.log("exporting"),s.forEach(ut=>{if(ut.imageName!==void 0){console.log(ut.imageName);const Ct=ut.fabriccanvas.toDataURL({format:"png",quality:1,multiplier:1}),g=atob(Ct.replace(/^data:image\/png;base64,/,"")),N=new Uint8Array(g.length);for(let B=0;B<g.length;B++)N[B]=g.charCodeAt(B);a.file(ut.imageName,N,{binary:!0})}});const K=await a.generateAsync({type:"blob"}),ct=document.createElement("a");ct.href=URL.createObjectURL(K),ct.download="watermarked_docx.docx",ct.click()}async function C(){console.log("extracting images");const K=new FileReader;K.onload=async function(ct){const ut=ct.target.result;a=new wc,await a.loadAsync(ut);const Ct=Object.keys(a.files).filter(g=>g.includes("media/"));console.log(Ct);for(let g=0;g<Ct.length;g++){const B=await a.files[Ct[g]].async("blob");y(URL.createObjectURL(B),Ct[g])}tt()},K.readAsArrayBuffer(o)}function k(){const K=new _e({left:100,top:100,fill:m,width:50,height:50});r.add(K)}function T(){const K=new we({radius:20,fill:m,left:100,top:100});r.add(K)}function P(){const K=new Ht(i,{left:100,top:100,fontFamily:d,fill:"black"});r.add(K)}function A(K){const ct=r.getActiveObject();console.log({selectedColor:m}),ct&&(ct.set("fill",K),r.requestRenderAll())}function I(K){const ct=r.getActiveObject();console.log({selectedColor:m}),ct&&(ct.set("opacity",K),r.requestRenderAll())}function j(K){const ct=r.getActiveObject();ct&&ct.type==="text"&&(ct.set("fontFamily",K),r.requestRenderAll())}function U(){r.remove(r.getActiveObject())}const $=K=>s.find(ct=>ct.id===K),S=K=>{const ct=K.toDataURL({format:"png",quality:1,multiplier:1}),ut=document.createElement("a");ut.href=ct,ut.download="exported-image.png",document.body.appendChild(ut),ut.click(),document.body.removeChild(ut)};function F(){if(n){const K=new FileReader;K.onload=function(ct){y(ct.target.result)},console.log(n),K.readAsDataURL(n)}}function y(K,ct=void 0){const ut=new Image;ut.src=K,console.log({imgElement:ut}),ut.onload=function(){const Ct=`canvas${s.length+1}`,g=window.screen.width/ut.width*(2/3);console.log(g),e(0,s=[...s,{id:Ct,sync:!0,transformedStyleRatio:g,imageName:ct}]),setTimeout(()=>{const N=new ne(ut),B=new Qs(Ct,{width:ut.width,height:ut.height});B.set({backgroundImage:N}),B.requestRenderAll(),B.canvasBGImage=N,$(Ct).fabriccanvas=B},0)}}const W=Sc(tt,100);function tt(){const K=r.toJSON();console.log(K),s.forEach(ct=>{let ut=ct.fabriccanvas;if(ut!==r&&ct.sync){ut.loadFromJSON(K,g=>{ut.requestRenderAll()}),ut.width/r.width,ut.height/r.height;const Ct=Math.min(ut.height/r.height);setTimeout(()=>{ut.set({backgroundImage:ut.canvasBGImage}),ut.getObjects().forEach(g=>{const N=(ut.width-g.width*g.scaleX*Ct)/(r.width-g.width*g.scaleX),B=(ut.height-g.height*g.scaleY*Ct)/(r.height-g.height*g.scaleY);g.set({left:g.left*N,top:g.top*B,scaleX:g.scaleX*Ct,scaleY:g.scaleY*Ct}),g.setCoords()}),ut.requestRenderAll()},0)}})}function X(K){ka[K?"unshift":"push"](()=>{v=K,e(10,v)})}function st(){c=this.clientWidth,u=this.clientHeight,e(5,c),e(6,u)}function H(){i=this.value,e(1,i)}function it(){m=this.value,e(8,m)}const R=K=>A(K.target.value);function L(){p=Pa(this.value),e(9,p)}const ot=K=>I(K.target.value);function Q(){d=ja(this),e(7,d),e(11,f)}const G=K=>j(K.target.value);function _t(){l=this.checked,e(4,l)}const wt=K=>e(2,n=K.target.files[0]);function mt(K,ct){K[ct].sync=this.checked,e(0,s)}return[s,i,n,o,l,c,u,d,m,p,v,f,_,b,k,T,P,A,I,j,U,S,F,X,st,H,it,R,L,ot,Q,G,_t,wt,mt,K=>S(K.fabriccanvas)]}class Dc extends Oa{constructor(t){super(),Da(this,t,Tc,Cc,Sa,{},null,[-1,-1])}}export{Dc as component};
